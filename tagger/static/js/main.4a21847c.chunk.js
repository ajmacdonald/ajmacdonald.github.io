(this.webpackJsonpspotifytagger=this.webpackJsonpspotifytagger||[]).push([[0],{239:function(e,t){},256:function(e,t){},266:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(17),s=n.n(c),i=n(9),o=n(343),l=n(78),u=n(156),b=n(339),d=n(341),h=n(342),j=n(337),f=n(328),p=n(83),g=n(135),m=n(344),L=n(329),O=n(351),x=n(87),y=n(14),v=n(85),w=n(184),k=n(3),C=["tagColor","barColor"],T=function(e){var t=e.tagColor,n=void 0===t?"#1de9b6":t,a=e.barColor,r=void 0===a?"#303030":a,c=Object(v.a)(e,C);return Object(k.jsxs)(w.a,Object(y.a)(Object(y.a)({},c),{},{viewBox:"0 0 400 400",children:[Object(k.jsx)("path",{stroke:"null",fill:n,d:"m310.75011,69.83626c-7.60697,-10.77654 -20.28526,-17.7496 -34.44268,-17.7496l-232.43525,0.21131c-23.24352,0 -42.26096,18.80613 -42.26096,42.04965l0,211.30478c0,23.24352 19.01743,42.04965 42.26096,42.04965l232.43525,0.21131c14.15742,0 26.83571,-6.97306 34.44268,-17.7496l83.67669,-117.90806c5.28262,-7.39567 5.28262,-17.11569 0,-24.51136l-83.67669,-117.90806l0,-0.00001z"}),Object(k.jsx)("path",{stroke:"null",fill:r,d:"M266.54 244.56L267.29 244.64L268.04 244.75L268.78 244.88L269.51 245.04L270.22 245.24L270.93 245.46L271.62 245.7L272.3 245.97L272.96 246.27L273.62 246.59L274.25 246.94L274.88 247.31L275.48 247.7L276.07 248.12L276.65 248.55L277.2 249.01L277.74 249.49L278.26 249.99L278.76 250.51L279.24 251.05L279.7 251.6L280.13 252.18L280.55 252.77L280.94 253.37L281.31 254L281.66 254.63L281.98 255.29L282.28 255.95L282.55 256.63L282.79 257.32L283.01 258.03L283.21 258.74L283.37 259.47L283.5 260.21L283.61 260.96L283.69 261.71L283.73 262.48L283.75 263.25L283.73 264.02L283.69 264.79L283.61 265.54L283.5 266.29L283.37 267.03L283.21 267.76L283.01 268.47L282.79 269.18L282.55 269.87L282.28 270.55L281.98 271.21L281.66 271.87L281.31 272.5L280.94 273.13L280.55 273.73L280.13 274.32L279.7 274.9L279.24 275.45L278.76 275.99L278.26 276.51L277.74 277.01L277.2 277.49L276.65 277.95L276.07 278.38L275.48 278.8L274.88 279.19L274.25 279.56L273.62 279.91L272.96 280.23L272.3 280.53L271.62 280.8L270.93 281.04L270.22 281.26L269.51 281.46L268.78 281.62L268.04 281.75L267.29 281.86L266.54 281.94L265.77 281.98L265 282L77.5 282L76.73 281.98L75.96 281.94L75.21 281.86L74.46 281.75L73.72 281.62L72.99 281.46L72.28 281.26L71.57 281.04L70.88 280.8L70.2 280.53L69.54 280.23L68.88 279.91L68.25 279.56L67.62 279.19L67.02 278.8L66.43 278.38L65.85 277.95L65.3 277.49L64.76 277.01L64.24 276.51L63.74 275.99L63.26 275.45L62.8 274.9L62.37 274.32L61.95 273.73L61.56 273.13L61.19 272.5L60.84 271.87L60.52 271.21L60.22 270.55L59.95 269.87L59.71 269.18L59.49 268.47L59.29 267.76L59.13 267.03L59 266.29L58.89 265.54L58.81 264.79L58.77 264.02L58.75 263.25L58.77 262.48L58.81 261.71L58.89 260.96L59 260.21L59.13 259.47L59.29 258.74L59.49 258.03L59.71 257.32L59.95 256.63L60.22 255.95L60.52 255.29L60.84 254.63L61.19 254L61.56 253.37L61.95 252.77L62.37 252.18L62.8 251.6L63.26 251.05L63.74 250.51L64.24 249.99L64.76 249.49L65.3 249.01L65.85 248.55L66.43 248.12L67.02 247.7L67.62 247.31L68.25 246.94L68.88 246.59L69.54 246.27L70.2 245.97L70.88 245.7L71.57 245.46L72.28 245.24L72.99 245.04L73.72 244.88L74.46 244.75L75.21 244.64L75.96 244.56L76.73 244.52L77.5 244.5L265 244.5L265.77 244.52L266.54 244.56ZM304.04 182.31L304.79 182.39L305.54 182.5L306.28 182.63L307.01 182.79L307.72 182.99L308.43 183.21L309.12 183.45L309.8 183.72L310.46 184.02L311.12 184.34L311.75 184.69L312.38 185.06L312.98 185.45L313.57 185.87L314.15 186.3L314.7 186.76L315.24 187.24L315.76 187.74L316.26 188.26L316.74 188.8L317.2 189.35L317.63 189.93L318.05 190.52L318.44 191.12L318.81 191.75L319.16 192.38L319.48 193.04L319.78 193.7L320.05 194.38L320.29 195.07L320.51 195.78L320.71 196.49L320.87 197.22L321 197.96L321.11 198.71L321.19 199.46L321.23 200.23L321.25 201L321.23 201.77L321.19 202.54L321.11 203.29L321 204.04L320.87 204.78L320.71 205.51L320.51 206.22L320.29 206.93L320.05 207.62L319.78 208.3L319.48 208.96L319.16 209.62L318.81 210.25L318.44 210.88L318.05 211.48L317.63 212.07L317.2 212.65L316.74 213.2L316.26 213.74L315.76 214.26L315.24 214.76L314.7 215.24L314.15 215.7L313.57 216.13L312.98 216.55L312.38 216.94L311.75 217.31L311.12 217.66L310.46 217.98L309.8 218.28L309.12 218.55L308.43 218.79L307.72 219.01L307.01 219.21L306.28 219.37L305.54 219.5L304.79 219.61L304.04 219.69L303.27 219.73L302.5 219.75L77.5 219.75L76.73 219.73L75.96 219.69L75.21 219.61L74.46 219.5L73.72 219.37L72.99 219.21L72.28 219.01L71.57 218.79L70.88 218.55L70.2 218.28L69.54 217.98L68.88 217.66L68.25 217.31L67.62 216.94L67.02 216.55L66.43 216.13L65.85 215.7L65.3 215.24L64.76 214.76L64.24 214.26L63.74 213.74L63.26 213.2L62.8 212.65L62.37 212.07L61.95 211.48L61.56 210.88L61.19 210.25L60.84 209.62L60.52 208.96L60.22 208.3L59.95 207.62L59.71 206.93L59.49 206.22L59.29 205.51L59.13 204.78L59 204.04L58.89 203.29L58.81 202.54L58.77 201.77L58.75 201L58.77 200.23L58.81 199.46L58.89 198.71L59 197.96L59.13 197.22L59.29 196.49L59.49 195.78L59.71 195.07L59.95 194.38L60.22 193.7L60.52 193.04L60.84 192.38L61.19 191.75L61.56 191.12L61.95 190.52L62.37 189.93L62.8 189.35L63.26 188.8L63.74 188.26L64.24 187.74L64.76 187.24L65.3 186.76L65.85 186.3L66.43 185.87L67.02 185.45L67.62 185.06L68.25 184.69L68.88 184.34L69.54 184.02L70.2 183.72L70.88 183.45L71.57 183.21L72.28 182.99L72.99 182.79L73.72 182.63L74.46 182.5L75.21 182.39L75.96 182.31L76.73 182.27L77.5 182.25L302.5 182.25L303.27 182.27L304.04 182.31ZM266.54 119.06L267.29 119.14L268.04 119.25L268.78 119.38L269.51 119.54L270.22 119.74L270.93 119.96L271.62 120.2L272.3 120.47L272.96 120.77L273.62 121.09L274.25 121.44L274.88 121.81L275.48 122.2L276.07 122.62L276.65 123.05L277.2 123.51L277.74 123.99L278.26 124.49L278.76 125.01L279.24 125.55L279.7 126.1L280.13 126.68L280.55 127.27L280.94 127.87L281.31 128.5L281.66 129.13L281.98 129.79L282.28 130.45L282.55 131.13L282.79 131.82L283.01 132.53L283.21 133.24L283.37 133.97L283.5 134.71L283.61 135.46L283.69 136.21L283.73 136.98L283.75 137.75L283.73 138.52L283.69 139.29L283.61 140.04L283.5 140.79L283.37 141.53L283.21 142.26L283.01 142.97L282.79 143.68L282.55 144.37L282.28 145.05L281.98 145.71L281.66 146.37L281.31 147L280.94 147.63L280.55 148.23L280.13 148.82L279.7 149.4L279.24 149.95L278.76 150.49L278.26 151.01L277.74 151.51L277.2 151.99L276.65 152.45L276.07 152.88L275.48 153.3L274.88 153.69L274.25 154.06L273.62 154.41L272.96 154.73L272.3 155.03L271.62 155.3L270.93 155.54L270.22 155.76L269.51 155.96L268.78 156.12L268.04 156.25L267.29 156.36L266.54 156.44L265.77 156.48L265 156.5L77.5 156.5L76.73 156.48L75.96 156.44L75.21 156.36L74.46 156.25L73.72 156.12L72.99 155.96L72.28 155.76L71.57 155.54L70.88 155.3L70.2 155.03L69.54 154.73L68.88 154.41L68.25 154.06L67.62 153.69L67.02 153.3L66.43 152.88L65.85 152.45L65.3 151.99L64.76 151.51L64.24 151.01L63.74 150.49L63.26 149.95L62.8 149.4L62.37 148.82L61.95 148.23L61.56 147.63L61.19 147L60.84 146.37L60.52 145.71L60.22 145.05L59.95 144.37L59.71 143.68L59.49 142.97L59.29 142.26L59.13 141.53L59 140.79L58.89 140.04L58.81 139.29L58.77 138.52L58.75 137.75L58.77 136.98L58.81 136.21L58.89 135.46L59 134.71L59.13 133.97L59.29 133.24L59.49 132.53L59.71 131.82L59.95 131.13L60.22 130.45L60.52 129.79L60.84 129.13L61.19 128.5L61.56 127.87L61.95 127.27L62.37 126.68L62.8 126.1L63.26 125.55L63.74 125.01L64.24 124.49L64.76 123.99L65.3 123.51L65.85 123.05L66.43 122.62L67.02 122.2L67.62 121.81L68.25 121.44L68.88 121.09L69.54 120.77L70.2 120.47L70.88 120.2L71.57 119.96L72.28 119.74L72.99 119.54L73.72 119.38L74.46 119.25L75.21 119.14L75.96 119.06L76.73 119.02L77.5 119L265 119L265.77 119.02L266.54 119.06Z"})]}))},A=n(112),S=n.n(A),P=n(16),M=n.n(P),D=n(25),N=n(268),B=n(269),F=n(324),R=n(345),z=n(323),E=n(76),I=n(347),_=n(18),W={allTags:[],currentTags:[],myAlbumsCache:{lastCached:void 0,albums:[]},albumsForCurrentTags:[],currentAlbum:void 0,currentSearch:{query:void 0,tags:[]},playingAlbum:void 0,isPlaying:!1},U=r.a.createContext([{},function(){}]),q=function(e){var t=Object(a.useState)(W),n=Object(i.a)(t,2),r=n[0],c=n[1];return Object(k.jsx)(U.Provider,{value:[r,c],children:e.children})},G=n(322),K=n(38),H=n(39),V=n(162),X=n.n(V),Z=n(113),J=n(183),Y=n(163),$=n.n(Y);Z.a.plugin(J.a),Z.a.plugin($.a);var Q=!1,ee=function(){function e(){Object(K.a)(this,e)}return Object(H.a)(e,null,[{key:"hasSpotifyToken",value:function(){return void 0!==e.spotifyApi.getAccessToken()}},{key:"setSpotifyToken",value:function(t){e.spotifyApi.setAccessToken(t)}},{key:"setDbName",value:function(t){e.pouchDB=new Z.a(t)}},{key:"fetchSavedAlbums",value:function(t,n){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Promise(function(){var c=Object(D.a)(M.a.mark((function c(s,i){var o,l,u,b,d;return M.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,e.spotifyApi.getMySavedAlbums({limit:n,offset:t});case 3:if(o=c.sent,l=o.body.total,u=o.body.items.map((function(t,n){return e._formatSpotifyAlbum(t.album)})),!a){c.next=12;break}return b=u.map((function(e){return e.id})),c.next=10,e.fetchTagsForAlbumKeys(b);case 10:d=c.sent,u.forEach((function(e){var t=d[e.id]||[];r&&t.reverse(),e.tags=t}));case 12:s([u,l]),c.next=19;break;case 15:c.prev=15,c.t0=c.catch(0),console.warn("fetchSavedAlbums",c.t0),s([[],0]);case 19:case 20:case"end":return c.stop()}}),c,null,[[0,15]])})));return function(e,t){return c.apply(this,arguments)}}())}},{key:"fetchAlbumsByKey",value:function(t){return new Promise(function(){var n=Object(D.a)(M.a.mark((function n(a,r){var c,s,i;return M.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=21;break}c=[];case 2:if(!(t.length>0)){n.next=18;break}return s=t.splice(0,20),n.prev=4,n.next=7,e.spotifyApi.getAlbums(s);case 7:i=n.sent,c=c.concat(i.body.albums.map((function(t,n){return e._formatSpotifyAlbum(t)}))),n.next=16;break;case 11:return n.prev=11,n.t0=n.catch(4),console.warn("fetchAlbumsByKey",n.t0),a([]),n.abrupt("break",18);case 16:n.next=2;break;case 18:a(c),n.next=23;break;case 21:console.warn("fetchAlbumsByKey: no keys!"),a([]);case 23:case"end":return n.stop()}}),n,null,[[4,11]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"fetchTracksForAlbum",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var a=Object(D.a)(M.a.mark((function a(r,c){var s,i;return M.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,e.spotifyApi.getAlbumTracks(t);case 3:if(s=a.sent,i=s.body.items,!n){a.next=10;break}return a.next=8,e.spotifyApi.getTracks(i.map((function(e){return e.id})));case 8:a.sent.body.tracks.forEach((function(e){i.find((function(t){return t.id===e.id})).popularity=e.popularity}));case 10:r(i),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(0),c(a.t0);case 16:case 17:case"end":return a.stop()}}),a,null,[[0,13]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"createPlaylist",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(r,c){e.spotifyApi.createPlaylist(t,{description:n,public:a}).then((function(e){r(e.body.id)}),(function(e){c(e)}))}))}},{key:"addTracksToPlaylist",value:function(t,n){return new Promise(function(){var a=Object(D.a)(M.a.mark((function a(r,c){var s,i;return M.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s="";case 1:if(!(n.length>0)){a.next=16;break}return i=n.splice(0,100),a.prev=3,a.next=6,e.spotifyApi.addTracksToPlaylist(t,i);case 6:s=a.sent,console.log(s),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(3),console.warn("addTracksToPlaylist",a.t0),c(a.t0);case 14:a.next=1;break;case 16:r(s);case 17:case"end":return a.stop()}}),a,null,[[3,10]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"_formatSpotifyAlbum",value:function(e){return{id:e.id,albumArtists:e.artists.map((function(e){return e.name})).join(", "),albumName:e.name,albumArt:e.images[2].url,year:e.release_date.split("-")[0],tags:[]}}},{key:"fetchTagsForAlbumKeys",value:function(t){return new Promise((function(n,a){e.pouchDB.allDocs({keys:t,include_docs:!0}).then((function(e){var t={};e.rows.filter((function(e){return!e.error})).forEach((function(e){e.doc?t[e.id]=e.doc.tags:console.warn("no doc for",e)})),n(t)}),(function(e){console.warn("fetchTagsForAlbumKeys",e),n({})}))}))}},{key:"fetchDocsForTags",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(a,r){var c={};c=n?{tags:{$all:t}}:{tags:{$in:t}},e.pouchDB.find({selector:c,fields:["_id","tags"]}).then((function(e){a(e.docs)}),(function(e){console.warn("fetchDocsForTags",e),a([])}))}))}},{key:"fetchAlbumsForTags",value:function(t){return new Promise(function(){var n=Object(D.a)(M.a.mark((function n(a,r){var c,s,i;return M.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.fetchDocsForTags(t);case 3:return c=n.sent,s=c.map((function(e){return e._id})),n.next=7,e.fetchAlbumsByKey(s);case 7:(i=n.sent).forEach((function(e){var t=c.find((function(t){return t._id===e.id}));t&&(e.tags=t.tags)})),a(i),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(0),console.warn("fetchAlbumsForTags",n.t0),a([]);case 16:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"fetchUniqueTags",value:function(){return new Promise((function(t,n){e.pouchDB.allDocs({include_docs:!0}).then((function(n){var a={};n.rows.forEach((function(t){t.doc.tags&&Array.isArray(t.doc.tags)?t.doc.tags.forEach((function(e){void 0===a[e]&&(a[e]=0),a[e]++})):(console.warn("doc is messed up so delete it",t),e.pouchDB.remove(t.doc))})),t(a)}),(function(e){console.warn("fetchUniqueTags",e),t({})}))}))}},{key:"fetchUniqueTagsArray",value:function(){return new Promise((function(t,n){e.fetchUniqueTags().then((function(e){for(var n=[],a=0,r=Object.entries(e);a<r.length;a++){var c=Object(i.a)(r[a],2),s=c[0],o=c[1];n.push({label:s,count:o})}t(n)}),(function(e){console.warn("fetchUniqueTagsArray",e),t([])}))}))}},{key:"updateDoc",value:function(t){return new Promise(function(){var n=Object(D.a)(M.a.mark((function n(a,r){var c;return M.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.pouchDB.upsert(t.id,(function(e){return e.tags=t.tags,e}));case 3:c=n.sent,a(c),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.warn("upsertDoc",n.t0),a(!1);case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"startDiscogsLog",value:function(){this.discogsStats.startTime=(new Date).getTime(),this.discogsStats.callTimes=[]}},{key:"getDiscogsMatchesForAlbum",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=n?2:5;return new Promise(function(){var r=Object(D.a)(M.a.mark((function r(c,s){var i,o,l,u,b,d,h,j;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:Q,i=t.albumArtists.split(",")[0],o=!1,0===i.toLowerCase().indexOf("various")&&(o=!0,i=""),l=t.albumName.replace(/LP/,"").replace(/EP/,""),u=[{release_title:l,artist:i,per_page:1},{query:"".concat(l," ").concat(i),per_page:5},{query:"".concat(l),per_page:5},{query:"".concat(l.split(/\b/)[0]," ").concat(i),per_page:5},{query:"".concat(l.split(/\b/)[0]," ").concat(i.split(/\b/)[0]),per_page:5}],b=u.shift(),d=0,h=[],j=void 0;case 10:return d++,r.prev=11,r.next=14,e._doDiscogsSearch(b,n);case 14:h=r.sent,r.next=22;break;case 17:r.prev=17,r.t0=r.catch(11),console.warn("Probably exceeding API limit!!!",r.t0),h=[],j=r.t0;case 22:b=u.shift();case 23:if(!j&&d<a&&0===h.length&&b){r.next=10;break}case 24:j?s(j):(h=e._filterDiscogsResults(t,h,o),c(h));case 25:case"end":return r.stop()}}),r,null,[[11,17]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_doDiscogsSearch",value:function(e,t){var n=this;return new Promise((function(a,r){void 0!==n.discogsStats.callTimes&&n.discogsStats.callTimes.push((new Date).getTime());var c=new URL("https://api.discogs.com/database/search"),s=Object.assign(e,{type:"release",page:0,token:"zVXJkuBoXwLyxIzfZUwoxxjMIYzCiTkUYqlsQnjR"});c.search=new URLSearchParams(s).toString();fetch(c,{method:"GET",mode:"cors",headers:{}}).then(function(){var e=Object(D.a)(M.a.mark((function e(n){var r,c,s;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t?950:0,e.next=3,n.json();case 3:c=e.sent,s=c.results.map((function(e){var t=e.title.indexOf(" - "),n=e.title.substr(0,t),a=e.title.substr(t+3);n=(n=n.replace(/\s\(\d+\)/g,"")).replace("*","");var r=[];return e.genre&&(r=r.concat(e.genre)),e.style&&(r=r.concat(e.style)),r=r.filter((function(e,t,n){return n.indexOf(e)===t})),{uri:e.uri,title:a,artists:n,genres:r,thumb:e.thumb}})),setTimeout((function(){a(s)}),r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){r(e)}))}))}},{key:"_filterDiscogsResults",value:function(e,t,n){var a=e.albumArtists.split(",").map((function(e){return e.split(/\s/)})).flat().map((function(e){return e.toLowerCase()})),r=e.albumName.split(/\s/).map((function(e){return e.replace(/\W/g,"").toLowerCase()})),c=n?0:1,s=Math.min(3,Math.ceil(r.length/2));return t.filter((function(e){var t=!0;c>0&&(t=e.artists.split(/(?:,\s)|(?:\s&\s)/).map((function(e){return e.split(/\s/)})).flat().map((function(e){return e.toLowerCase()})).filter((function(e){return-1!==a.indexOf(e)})).length>=c);var n=e.title.split(/\s/).map((function(e){return e.replace(/\W/g,"").toLowerCase()})).filter((function(e){return-1!==r.indexOf(e)}));return t&&n.length>=s}))}},{key:"titleCaseTags",value:function(){return new Promise(function(){var t=Object(D.a)(M.a.mark((function t(n,a){var r,c,s,i;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.fetchUniqueTags();case 3:return r=t.sent,Object.keys(r).forEach((function(t){var n=e.toTitleCase(t);r[t]=n})),t.next=7,e.pouchDB.allDocs({include_docs:!0});case 7:return c=t.sent,s=[],c.rows.forEach((function(e){var t=e.doc.tags.map((function(e){return r[e]}));s.push({_id:e.doc._id,_rev:e.doc._rev,tags:t})})),t.next=12,e.pouchDB.bulkDocs(s);case 12:i=t.sent,n(i),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(0),console.warn("titleCaseTags",t.t0),n(!1);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"toTitleCase",value:function(e){return e.replace(/([^\W_]+[^\s-]*) */g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}}]),e}();ee.spotifyApi=new X.a,ee.pouchDB=void 0,ee.logDiscogsStats=!1,ee.discogsStats={startTime:void 0,callTimes:void 0};var te=ee,ne=function(){var e=Object(a.useContext)(U),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(G.a)("(min-width:800px)");function s(e,t){return!1===o()?new Promise((function(a,r){var c=Object(_.a)(n.myAlbumsCache.albums),s=c.length;if(void 0!==e){var i=Math.min(s,e+t);c=c.slice(e,i)}a([c,s])})):te.fetchSavedAlbums(e,t,!0)}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36e5;if(n.myAlbumsCache.lastCached){var t=(new Date).getTime();return t-n.myAlbumsCache.lastCached>e}return!0}function l(){return u.apply(this,arguments)}function u(){return(u=Object(D.a)(M.a.mark((function e(){var t;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.fetchUniqueTagsArray();case 2:(t=e.sent).sort((function(e,t){return t.count-e.count})),r((function(e){return Object(y.a)(Object(y.a)({},e),{},{allTags:t})}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return d.apply(this,arguments)}function d(){return(d=Object(D.a)(M.a.mark((function e(t){var a,c,s;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],!1!==o()){e.next=9;break}return e.next=4,te.fetchDocsForTags(t);case 4:c=e.sent,s=c.map((function(e){return e._id})),a=n.myAlbumsCache.albums.filter((function(e){return-1!==s.indexOf(e.id)})),e.next=12;break;case 9:return e.next=11,te.fetchAlbumsForTags(t);case 11:a=e.sent;case 12:r((function(e){return Object(y.a)(Object(y.a)({},e),{},{currentTags:t,albumsForCurrentTags:a})}));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){-1===n.currentTags.indexOf(e)&&b([].concat(Object(_.a)(n.currentTags),[e]))}function j(e){b(n.currentTags.filter((function(t){return t!==e})))}return{setSpotifyToken:function(e){te.setSpotifyToken(e)},hasSpotifyToken:function(){return te.hasSpotifyToken()},setDatabaseName:function(e){te.setDbName(e),l()},persistentSideBar:function(){return c},sideBarWidth:function(){return 250},getMyAlbums:s,needsMyAlbumsCache:o,getMyAlbumsCache:function(){return n.myAlbumsCache.albums},setMyAlbumsCache:function(e){var t=(new Date).getTime();r((function(n){return Object(y.a)(Object(y.a)({},n),{},{myAlbumsCache:{albums:e,lastCached:t}})}))},getAlbumsForCurrentTags:function(e,t){return new Promise(function(){var a=Object(D.a)(M.a.mark((function a(r,c){var o,l,u,b,d;return M.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(l=0,!(n.currentTags.length>0)){a.next=6;break}l=n.albumsForCurrentTags.length,o=Object(_.a)(n.albumsForCurrentTags),a.next=12;break;case 6:return a.next=8,s(e,t);case 8:u=a.sent,b=Object(i.a)(u,2),o=b[0],l=b[1];case 12:void 0!==e&&(d=Math.min(l,e+t),o=o.slice(e,d)),r([o,l]);case 14:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())},setTagsForAlbum:function(e,t){if(!1===o()){for(var a=-1,c=0;c<n.myAlbumsCache.albums.length;c++)if(n.myAlbumsCache.albums[c].id===e){a=c;break}if(-1!==a){var s=Object.assign({},n.myAlbumsCache.albums[a],{tags:t}),i=Object(_.a)(n.myAlbumsCache.albums);i.splice(a,1,s);var u=n.myAlbumsCache.lastCached;r((function(e){return Object(y.a)(Object(y.a)({},e),{},{myAlbumsCache:{albums:i,lastCached:u}})}))}else console.warn("setTagsForAlbum: could not find cached album!")}return new Promise((function(n,a){te.updateDoc({id:e,tags:t}).then((function(e){e?l().then((function(){return n(!0)})):n(!1)}))}))},getAlbumTracks:function(e,t){return new Promise((function(n,a){te.fetchTracksForAlbum(e,t).then((function(e){n(e)}),(function(e){console.warn("could not get album tracks",e),n([])}))}))},getAllTags:function(){return n.allTags},refreshAllTags:l,getCurrentTags:function(){return n.currentTags},setCurrentTags:b,resetCurrentTags:function(){r((function(e){return Object(y.a)(Object(y.a)({},e),{},{currentTags:Object(_.a)(e.currentTags)})}))},addCurrentTag:h,removeCurrentTag:j,toggleCurrentTag:function(e){-1===n.currentTags.indexOf(e)?h(e):j(e)},getCurrentAlbum:function(){return n.currentAlbum},setCurrentAlbum:function(e){r((function(t){return Object(y.a)(Object(y.a)({},t),{},{currentAlbum:e})}))},getPlayingAlbum:function(){return n.playingAlbum},playAlbum:function(e){n.playingAlbum!==e?r((function(t){return Object(y.a)(Object(y.a)({},t),{},{playingAlbum:e,isPlaying:!0})})):!1===n.isPlaying&&r((function(e){return Object(y.a)(Object(y.a)({},e),{},{isPlaying:!0})}))},stopPlaying:function(){r((function(e){return Object(y.a)(Object(y.a)({},e),{},{isPlaying:!1})}))},isPlaying:n.isPlaying,searchDiscogsForAlbum:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,a){te.getDiscogsMatchesForAlbum(e,t).then((function(e){e.length>0?n(e[0]):n(void 0)}),(function(e){a(e)}))}))},createPlaylistForTracks:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(function(){var r=Object(D.a)(M.a.mark((function r(c,s){var i;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,te.createPlaylist(e,t,a);case 3:return i=r.sent,r.next=6,te.addTracksToPlaylist(i,n);case 6:r.sent,c(i),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),s(r.t0);case 13:case"end":return r.stop()}}),r,null,[[0,10]])})));return function(e,t){return r.apply(this,arguments)}}())}}},ae=["handleTagClick","persistent"],re=Object(u.a)((function(e){return{root:{"&":{height:"100%",display:"flex",flexDirection:"column"},"& h6":{padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px 0 ").concat(e.spacing(2),"px")},"& .MuiBox-root":{padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px"),borderBottom:"1px solid ".concat(e.palette.grey[700])},"& .MuiBox-root > .MuiTypography-button":{padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px ").concat(e.spacing(1),"px 0")},"& .MuiList-root::-webkit-scrollbar":{width:e.scrollBar.width},"& .MuiList-root::-webkit-scrollbar-track":e.scrollBar.track,"& .MuiList-root::-webkit-scrollbar-thumb":e.scrollBar.thumb,"& .MuiList-root":{flexGrow:1,overflowY:"scroll"}}}})),ce=function(e,t){return e.sort((function(e,n){if(-1===e.index&&-1===n.index){if("count"===t){var a=n.count-e.count;return 0===a?-1===e.index?1:-1===n.index?-1:e.index-n.index:a}return e.label<n.label?-1:e.label>n.label?1:0}return-1===e.index?1:-1===n.index||e.index<n.index?-1:1}))},se=function(e){e.handleTagClick;var t=e.persistent,n=Object(v.a)(e,ae),r=ne(),c=r.getAllTags,s=r.getCurrentTags,o=r.getAlbumsForCurrentTags,l=r.toggleCurrentTag,u=r.sideBarWidth,b=Object(a.useState)([]),d=Object(i.a)(b,2),h=d[0],j=d[1],f=Object(a.useState)("count"),g=Object(i.a)(f,2),m=g[0],L=g[1],O=Object(a.useRef)(null),x=function(){var e=Object(D.a)(M.a.mark((function e(){var t,n,a,r,l,u,b,d,h,f,p,g;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!((n=s()).length>0)){e.next=14;break}return a={},e.next=6,o();case 6:for(r=e.sent,l=Object(i.a)(r,2),u=l[0],l[1],u.forEach((function(e){e.tags.find((function(e){return-1!==n.indexOf(e)}))&&e.tags.forEach((function(e){void 0===a[e]&&(a[e]=0),a[e]++}))})),b=0,d=Object.entries(a);b<d.length;b++)h=Object(i.a)(d[b],2),f=h[0],p=h[1],g=n.indexOf(f),t.push({label:f,count:p,index:g});e.next=15;break;case 14:t=c().map((function(e){return Object(y.a)(Object(y.a)({},e),{},{index:-1})}));case 15:j(ce(t,m));case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){O.current.scrollTop=0}),[s()]),Object(a.useEffect)((function(){x()}),[c(),s(),m]);var w=re();return Object(k.jsxs)(R.a,Object(y.a)(Object(y.a)({},n),{},{className:w.root,style:{width:"".concat(u(),"px")},children:[!t&&Object(k.jsx)(p.a,{variant:"h6",children:"Tags"}),Object(k.jsxs)(R.a,{children:[Object(k.jsx)(p.a,{variant:"button",children:"Sort"}),Object(k.jsxs)(z.a,{children:[Object(k.jsx)(E.a,{onClick:function(){return L("label")},size:"small",variant:"label"===m?"contained":"outlined",children:"Label"}),Object(k.jsx)(E.a,{onClick:function(){return L("count")},size:"small",variant:"count"===m?"contained":"outlined",children:"Count"})]})]}),Object(k.jsxs)(N.a,{dense:t,ref:O,children:[0===h.length&&Object(k.jsx)(B.a,{children:Object(k.jsx)(F.a,{children:"Add some tags to get started"})}),h.map((function(e,t){return Object(k.jsxs)(B.a,{button:!0,disableRipple:!0,disableTouchRipple:!0,selected:-1!==s().indexOf(e.label),onClick:function(){return l(e.label)},children:[Object(k.jsx)(F.a,{children:e.label}),Object(k.jsx)(I.a,{size:"small",disabled:!0,variant:"outlined",label:e.count})]},t)}))]})]}))},ie=n(42),oe=n(12),le=n(65),ue=n(47),be=n(46),de=n(1),he=n(4),je=[{name:"VirtualTable"}],fe="albumArtColumnType";var pe=function(e){Object(ue.a)(n,e);var t=Object(be.a)(n);function n(){return Object(K.a)(this,n),t.apply(this,arguments)}return Object(H.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.width;return Object(k.jsxs)(de.g,{name:"AlbumArtColumn",dependencies:je,children:[Object(k.jsx)(de.f,{name:"tableColumns",computed:function(e){return function(e,t){return[{key:fe,type:fe,width:t}].concat(Object(_.a)(e))}(e.tableColumns,n)}}),Object(k.jsx)(de.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type===he.q&&t.type===fe}(e.tableRow,e.tableColumn)},children:Object(k.jsx)(ie.c.Cell,{})}),Object(k.jsx)(de.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type!==he.q&&e.type!==he.u&&t.type===fe}(e.tableRow,e.tableColumn)},children:function(e){return Object(k.jsx)(ie.c.Cell,Object(y.a)(Object(y.a)({},e),{},{row:e.tableRow.row,style:{textOverflow:"clip"},children:e.tableRow.row&&Object(k.jsx)(E.a,{variant:"text",style:{padding:"4px"},onClick:function(){return t(e.tableRow.row.id)},children:Object(k.jsx)("img",{src:e.tableRow.row.albumArt,width:"64",height:"64"})})}))}})]})}}]),n}(r.a.PureComponent);pe.defaultProps={width:96};var ge=n(172),me=n.n(ge),Le=[{name:"EditingState"},{name:"VirtualTable"}],Oe="editColumnType";var xe=function(e){Object(ue.a)(n,e);var t=Object(be.a)(n);function n(){return Object(K.a)(this,n),t.apply(this,arguments)}return Object(H.a)(n,[{key:"render",value:function(){var e=this.props.width;return Object(k.jsxs)(de.g,{name:"EditColumn",dependencies:Le,children:[Object(k.jsx)(de.f,{name:"tableColumns",computed:function(t){return function(e,t){return[].concat(Object(_.a)(e),[{key:Oe,type:Oe,width:t}])}(t.tableColumns,e)}}),Object(k.jsx)(de.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type===he.q&&t.type===Oe}(e.tableRow,e.tableColumn)},children:Object(k.jsx)(ie.c.Cell,{children:" "})}),Object(k.jsx)(de.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type!==he.q&&e.type!==he.u&&t.type===Oe}(e.tableRow,e.tableColumn)},children:function(e){return Object(k.jsx)(de.l,{children:function(t,n){t.editingRowIds;var a=n.startEditRows;return Object(k.jsx)(ie.c.Cell,Object(y.a)(Object(y.a)({},e),{},{row:e.tableRow.row,style:{textOverflow:"clip"},children:Object(k.jsx)(x.a,{size:"small",onClick:function(){a({rowIds:[e.tableRow.row.id]})},children:Object(k.jsx)(me.a,{})})}))}})}})]})}}]),n}(r.a.PureComponent);xe.defaultProps={width:60};var ye=["tags","onClick"],ve=function(e){var t=e.album;return Object(k.jsxs)(r.a.Fragment,{children:[Object(k.jsx)(p.a,{variant:"h6",noWrap:!0,style:{fontSize:"1rem",fontWeight:400},children:t.albumName}),Object(k.jsx)(p.a,{variant:"body1",noWrap:!0,style:{fontSize:".85rem",fontWeight:300},children:t.albumArtists})]})},we=function(e){var t=e.tags,n=e.onClick,r=void 0===n?void 0:n,c=Object(v.a)(e,ye);return void 0!==r?t.map((function(e,t){return Object(a.createElement)(I.a,Object(y.a)(Object(y.a)({},c),{},{size:"small",label:e,key:t,style:{margin:".125rem .25rem .125rem 0"},onClick:function(){return r(e)}}))})):t.map((function(e,t){return Object(a.createElement)(I.a,Object(y.a)(Object(y.a)({},c),{},{size:"small",label:e,key:t,style:{margin:".125rem .25rem .125rem 0"}}))}))},ke=[{name:"VirtualTable"}],Ce="tagsColumnType";var Te=function(e){Object(ue.a)(n,e);var t=Object(be.a)(n);function n(){return Object(K.a)(this,n),t.apply(this,arguments)}return Object(H.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.width,a=e.maxHeight;return Object(k.jsxs)(de.g,{name:"TagsColumn",dependencies:ke,children:[Object(k.jsx)(de.f,{name:"tableColumns",computed:function(e){return function(e,t){return[].concat(Object(_.a)(e),[{key:Ce,type:Ce,width:t}])}(e.tableColumns,n)}}),Object(k.jsx)(de.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type===he.q&&t.type===Ce}(e.tableRow,e.tableColumn)},children:Object(k.jsx)(ie.c.Cell,{children:"Tags"})}),Object(k.jsx)(de.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type!==he.q&&e.type!==he.u&&t.type===Ce}(e.tableRow,e.tableColumn)},children:function(e){return Object(k.jsx)(ie.c.Cell,Object(y.a)(Object(y.a)({},e),{},{row:e.tableRow.row,style:{whiteSpace:"normal"},children:e.tableRow.row&&Object(k.jsx)("div",{style:{maxHeight:"".concat(a,"px"),overflow:"hidden"},children:Object(k.jsx)(we,{tags:e.tableRow.row.tags,onClick:t})})}))}})]})}}]),n}(r.a.PureComponent);Te.defaultProps={width:96,maxHeight:84};var Ae=n(139),Se=n(333),Pe=n(334),Me=n(335),De=n(336),Ne=n(349),Be=n(330),Fe=n(331),Re=n(273),ze=n(189),Ee=n(173),Ie=n.n(Ee),_e=n(174),We=n.n(_e),Ue=n(332),qe=Object(u.a)((function(e){return{results:{"&.MuiList-root .MuiListItemAvatar-root":{marginRight:e.spacing(1)}},genres:{"&.MuiList-root":{paddingTop:e.spacing(0),paddingBottom:e.spacing(0)},"&.MuiList-root .MuiListItem-root":{paddingTop:e.spacing(0),paddingBottom:e.spacing(0)}},large:{width:e.spacing(10),height:e.spacing(10)}}})),Ge=function(e){var t=e.album,n=e.onChange,r=Object(a.useState)(!1),c=Object(i.a)(r,2),s=c[0],o=c[1],l=Object(a.useState)(!1),u=Object(i.a)(l,2),b=u[0],d=u[1],h=Object(a.useState)(void 0),j=Object(i.a)(h,2),f=j[0],m=j[1],O=Object(a.useState)([]),x=Object(i.a)(O,2),y=x[0],v=x[1],w=qe();return Object(k.jsxs)(L.a,{container:!0,direction:"column",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[Object(k.jsxs)(L.a,{item:!0,children:[!b&&!s&&Object(k.jsx)(E.a,{variant:"outlined",onClick:function(){v([]),o(!0),te.getDiscogsMatchesForAlbum(t).then((function(e){var n=e[0];m(n),void 0!==n&&v(n.genres.filter((function(e){return-1!==t.tags.indexOf(e)}))),setTimeout((function(){o(!1),d(!0)}),700)}),(function(e){o(!1),d(!0)}))},startIcon:Object(k.jsx)(Ie.a,{}),disabled:s,children:"Search Discogs"}),b&&void 0===f&&Object(k.jsx)(R.a,{children:Object(k.jsxs)(p.a,{variant:"body1",style:{marginTop:"30px"},children:["No match ",Object(k.jsx)(We.a,{style:{verticalAlign:"middle"}})]})})]}),Object(k.jsxs)(L.a,{item:!0,container:!0,direction:"row",justifyContent:"flex-start",alignItems:"flex-start",children:[Object(k.jsxs)(L.a,{item:!0,xs:12,sm:5,children:[s&&Object(k.jsx)(N.a,{subheader:Object(k.jsx)(Be.a,{children:"Album"}),className:w.results,children:Object(k.jsxs)(B.a,{dense:!0,children:[Object(k.jsx)(Fe.a,{children:Object(k.jsx)(Ue.a,{variant:"rect",children:Object(k.jsx)(Ne.a,{variant:"square",className:w.large})})}),Object(k.jsxs)(F.a,{children:[Object(k.jsx)(Ue.a,{variant:"text"}),Object(k.jsx)(Ue.a,{variant:"text"})]})]})}),b&&f&&Object(k.jsx)(N.a,{subheader:Object(k.jsx)(Be.a,{children:"Album"}),className:w.results,children:Object(k.jsx)(g.a,{title:"View Album on Discogs",children:Object(k.jsxs)(B.a,{dense:!0,button:!0,onClick:function(){return e=f.uri,void window.open("https://discogs.com".concat(e),"discogsWindow");var e},children:[Object(k.jsx)(Fe.a,{children:Object(k.jsx)(Ne.a,{variant:"square",src:f.thumb,className:w.large})}),Object(k.jsx)(F.a,{primary:f.title,secondary:f.artists})]})})})]}),Object(k.jsxs)(L.a,{item:!0,xs:12,sm:7,children:[s&&Object(k.jsxs)(N.a,{dense:!0,subheader:Object(k.jsx)(Be.a,{children:"Genres & Styles"}),className:w.genres,children:[Object(k.jsx)(B.a,{dense:!0,children:Object(k.jsx)(F.a,{children:Object(k.jsx)(Ue.a,{variant:"text",height:34})})}),Object(k.jsx)(B.a,{dense:!0,children:Object(k.jsx)(F.a,{children:Object(k.jsx)(Ue.a,{variant:"text",height:34})})}),Object(k.jsx)(B.a,{dense:!0,children:Object(k.jsx)(F.a,{children:Object(k.jsx)(Ue.a,{variant:"text",height:34})})})]}),b&&f&&Object(k.jsx)(N.a,{dense:!0,subheader:Object(k.jsx)(Be.a,{children:"Genres & Styles"}),className:w.genres,children:f.genres.map((function(e,t){return Object(k.jsxs)(B.a,{dense:!0,button:!0,onClick:function(){return function(e){var t=y.indexOf(e),a=Object(_.a)(y);-1===t?a.push(e):a.splice(t,1),v(a),n(a)}(e)},children:[Object(k.jsx)(Re.a,{children:Object(k.jsx)(ze.a,{checked:-1!==y.indexOf(e),disableRipple:!0})}),Object(k.jsx)(F.a,{children:e})]},t)}))})]})]})]})},Ke=Object(u.a)((function(e){return{root:{"&.MuiDialog-root .MuiDialogTitle-root":{backgroundColor:e.palette.primary.main},"& .MuiDialogContent-root":{padding:e.spacing(3)}}}})),He=new RegExp("\\s*;\\s*"),Ve=r.a.memo((function(e){var t=e.popupComponent;return Object(k.jsxs)(de.g,{name:"TagsEditing",children:[Object(k.jsx)(de.k,{name:"tagsEditing",children:Object(k.jsx)(de.l,{children:function(e,n){var a=e.rows,r=e.getRowId,c=e.editingRowIds,s=e.createRowChange,o=e.rowChanges,l=n.changeRow,u=n.commitChangedRows,b=n.stopEditRows,d=n.cancelChangedRows,h=Object(i.a)(c,1)[0],j=a.filter((function(e){return r(e)===h}))[0],f=Object(y.a)(Object(y.a)({},j),o[h]),p=c,g="";f.tagsString?g=f.tagsString:f.tags&&Array.isArray(f.tags)&&(g=f.tags.join("; "));var m=c.length>0;return Object(k.jsx)(t,{open:m,row:f,tagsString:g,onChange:function(e,t,n){var a,r=[];if("tags"===e)r=(a=t).split(He);else if("discogs"===e){var c=f.tags.concat(t);r=c.filter((function(e,t){return c.indexOf(e)===t}))}var i={rowId:h,change:s(f,r,"tags")};l(i),("discogs"===e||n&&";"===n)&&(a=r.join("; "));var o={rowId:h,change:s(f,a,"tagsString")};l(o)},onApplyChanges:function(){b({rowIds:p}),u({rowIds:p})},onCancelChanges:function(){b({rowIds:p}),d({rowIds:p})}})}})}),Object(k.jsxs)(de.k,{name:"root",children:[Object(k.jsx)(de.m,{}),Object(k.jsx)(de.m,{name:"tagsEditing"})]})]})})),Xe=function(e){var t=e.row,n=e.tagsString,r=e.onChange,c=e.onApplyChanges,s=e.onCancelChanges,o=e.open,l=Object(a.useState)(),u=Object(i.a)(l,2),b=u[0],d=u[1],h=Ke();return Object(k.jsxs)(Se.a,{maxWidth:"sm",fullWidth:!0,className:h.root,open:o,onClose:s,children:[Object(k.jsx)(Pe.a,{children:"Tags Editor"}),Object(k.jsx)(Me.a,{children:Object(k.jsxs)(L.a,{container:!0,direction:"row",justifyContent:"flex-start",alignItems:"stretch",spacing:2,children:[Object(k.jsxs)(L.a,{item:!0,xs:12,children:[Object(k.jsx)(ve,{album:t}),Object(k.jsx)(Ae.a,{name:"tags",label:"Tags",color:"secondary",style:{marginTop:"16px"},variant:"outlined",fullWidth:!0,spellCheck:!1,autoComplete:"off",value:n,onKeyDown:function(e){d(e.key)},onChange:function(e){r(e.target.name,e.target.value,b)}})]}),Object(k.jsx)(L.a,{item:!0,xs:12,children:Object(k.jsx)(Ge,{album:t,onChange:function(e){return r("discogs",e)}})})]})}),Object(k.jsxs)(De.a,{children:[Object(k.jsx)(E.a,{onClick:s,color:"secondary",children:"Cancel"}),Object(k.jsx)(E.a,{onClick:c,color:"secondary",children:"Save"})]})]})},Ze=Object(u.a)((function(e){return{root:{"&":{height:"100%"},"& table:first-of-type":{backgroundColor:e.palette.primary.dark},"& .MuiTableCell-head":{padding:e.spacing(1)},"& .MuiTable-root .MuiTableBody-root .MuiTableRow-root .MuiTableCell-body":{padding:"2px 4px"},"& > div > div::-webkit-scrollbar":{width:e.scrollBar.width},"& > div > div::-webkit-scrollbar-track":e.scrollBar.track,"& > div > div::-webkit-scrollbar-thumb":e.scrollBar.thumb},chipTag:{marginRight:e.spacing(1)},paginator:{"&.MuiPagination-root .MuiPagination-ul":{justifyContent:"center"}}}})),Je=[{name:"title",title:"Title",getCellValue:function(e){return e.albumName+" - "+e.albumArtists}}],Ye=function(e,t){var n=e.toLowerCase(),a=t.toLowerCase();return n<a?-1:n>a?1:0},$e=function(e){var t=e.row;return Object(k.jsx)(ve,{album:t})},Qe=function(e){return Object(k.jsx)(oe.b,Object(y.a)({for:["title"],formatterComponent:$e},e))},et=function(e){return Object(k.jsx)(ie.a.Root,Object(y.a)(Object(y.a)({},e),{},{style:{height:"99%"}}))},tt=function(){var e=ne(),t=e.getAlbumsForCurrentTags,n=e.getCurrentTags,c=e.addCurrentTag,s=(e.toggleCurrentTag,e.needsMyAlbumsCache),o=e.resetCurrentTags,l=(e.setMyAlbumsCache,e.setTagsForAlbum),u=e.playAlbum,b=e.sideBarWidth,d=Object(a.useRef)(),h=Object(a.useState)(),j=Object(i.a)(h,2),f=j[0],p=j[1],g=Object(a.useState)(!1),m=Object(i.a)(g,2),L=(m[0],m[1]),O=Object(a.useState)([]),x=Object(i.a)(O,2),y=x[0],v=x[1],w=Object(a.useState)(),C=Object(i.a)(w,2),T=C[0],A=C[1],S=function(){var e=window.innerWidth>800,t=window.innerWidth-82-40-10;e&&(t-=b());var n=Math.round(t*(t>450?.4:.6));p(t-n),A([{columnName:"title",width:n}])},P=Object(a.useState)([{columnName:"title",compare:Ye}]),N=Object(i.a)(P,1)[0];Object(a.useEffect)((function(){S(),window.addEventListener("resize",Object(le.a)(S,250))}),[]),Object(a.useEffect)((function(){Object(D.a)(M.a.mark((function e(){var n,a,r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s()){e.next=10;break}return L(!0),e.next=4,t();case 4:n=e.sent,a=Object(i.a)(n,2),r=a[0],a[1],v(r),L(!1);case 10:case"end":return e.stop()}}),e)})))()}),[s(),n()]),Object(a.useEffect)((function(){y.length>0&&d.current.scrollToRow(y[0].id)}),[y]);var B=Ze();return Object(k.jsx)(r.a.Fragment,{children:Object(k.jsx)("div",{className:B.root,children:Object(k.jsxs)(ie.a,{rootComponent:et,rows:y,columns:Je,getRowId:function(e){return e.id},children:[Object(k.jsx)(oe.d,{onCommitChanges:function(e){e.added;var t=e.changed,n=Object.keys(t)[0];if(t[n]){var a=function(e){if(e&&Array.isArray(e)){var t=[];return e.forEach((function(e){e.trim().length>0&&t.push(e.trim())})),t}return[]}(t[n].tags);l(n,a),o()}}}),Object(k.jsx)(oe.l,{}),Object(k.jsx)(oe.i,{columnExtensions:N}),Object(k.jsx)(Qe,{}),Object(k.jsx)(ie.c,{height:"auto",estimatedRowHeight:78,columnExtensions:T,ref:d}),Object(k.jsx)(ie.b,{showSortingControls:!0}),Object(k.jsx)(pe,{onClick:u,width:82}),Object(k.jsx)(Te,{onClick:c,width:f}),Object(k.jsx)(xe,{width:40}),Object(k.jsx)(Ve,{popupComponent:Xe})]})})})};var nt="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("666253527bbe47a1b7abffd28c9dd851","&redirect_uri=").concat("https://ajmacdonald.github.io/tagger/","&scope=").concat(["streaming","user-read-email","user-read-private","user-read-currently-playing","user-read-playback-state","user-modify-playback-state","user-library-read","user-library-modify","playlist-read-private","playlist-modify-private","playlist-modify-public","playlist-read-collaborative"].join("%20"),"&response_type=token&show_dialog=false"),at=function(e){return Object(k.jsx)(E.a,Object(y.a)(Object(y.a)({},e),{},{onClick:function(){return window.location.href=nt},children:"Connect to Spotify"}))},rt=Object(u.a)((function(e){return{box:{borderTop:"2px solid ".concat(e.palette.grey[800])}}})),ct=function(e){var t=e.width,n=e.height,a=ne(),r=a.getPlayingAlbum,c=(a.playAlbum,a.stopPlaying,rt());return Object(k.jsxs)(R.a,{children:[r()&&Object(k.jsx)("iframe",{src:"https://open.spotify.com/embed/album/".concat(r()),width:t,height:n,frameBorder:"0",allowtransparency:"true",allow:"encrypted-media"}),!r()&&Object(k.jsx)(R.a,{width:t,height:n,className:c.box,children:Object(k.jsx)("img",{style:{width:"".concat(t/2,"px"),height:"".concat(n/2,"px"),opacity:.5,position:"relative",top:"50%",transform:"translate(50%, -50%)"},src:"/tagger/spotify_icons/Spotify_Icon_RGB_Black.png"})})]})},st=n(133),it=n.n(st),ot=n(179),lt=n.n(ot),ut=n(178),bt=n.n(ut),dt=n(177),ht=n.n(dt),jt=n(111),ft=n.n(jt),pt=n(92),gt=n(275),mt=n(276),Lt=n(350),Ot=n(338),xt=n(346),yt=n(180),vt=n(175),wt=n.n(vt),kt=n(176),Ct=n.n(kt),Tt=Object(u.a)((function(e){return{tagsBar:{backgroundColor:"#58319C",minHeight:"50px"},tagIcon:{color:e.palette.primary.light,marginRight:e.spacing(1)},chipTag:{marginRight:e.spacing(1),marginTop:e.spacing(1),marginBottom:e.spacing(1)}}})),At=function(e){var t=e.onDelete,n=ne().getCurrentTags,a=Tt();return Object(k.jsxs)(f.a,{className:a.tagsBar,children:[Object(k.jsx)(wt.a,{fontSize:"large",className:a.tagIcon}),Object(k.jsx)(R.a,{children:n().map((function(e,n){return t?Object(k.jsx)(I.a,{label:e,className:a.chipTag,color:"secondary",onClick:function(){return t(e)},onDelete:function(){return t(e)},deleteIcon:Object(k.jsx)(Ct.a,{})},n):Object(k.jsx)(I.a,{label:e,className:a.chipTag,color:"secondary"},n)}))})]})},St=Object(u.a)((function(e){return{title:{marginLeft:e.spacing(2),flex:1},root:{"& .MuiPaper-root.MuiDialog-paper":{backgroundColor:e.palette.background.default},"& .MuiDialogContent-root":{padding:e.spacing(3)}},controls:{"&":{display:"flex",flexFlow:"column nowrap",justifyContent:"center",alignItems:"center",padding:e.spacing(2)},"& > *":{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginLeft:e.spacing(0)}},summary:{marginBottom:e.spacing(2)},albums:{"&.MuiDataGrid-root .MuiDataGrid-cell:focus, &.MuiDataGrid-root .MuiDataGrid-cell:focus-within":{outline:"none"},"& .custom-header":{},"& .custom-cell":{textAlign:"center"}},chart:{"&.MuiGrid-root":{height:"100%"},"&.MuiGrid-root .MuiGrid-item":{backgroundColor:e.palette.secondary.main,margin:"0 2px 0 0"}}}})),Pt=[{field:"id",headerName:"ID",hide:!0,filterable:!1,sortable:!1},{field:"albumArt",headerName:" ",width:90,filterable:!1,sortable:!1,renderCell:function(e){return r.a.createElement("img",{width:"60px",height:"60px",src:e.value})}},{field:"title",headerName:"Title",flex:1,filterable:!1,sortable:!1,headerClassName:"custom-header",renderCell:function(e){return Object(k.jsxs)(R.a,{style:{flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[Object(k.jsx)(p.a,{variant:"h6",noWrap:!0,style:{fontSize:"1rem",fontWeight:400},children:e.row.albumName}),Object(k.jsxs)(R.a,{display:"flex",style:{flexDirection:"row"},children:[Object(k.jsx)(p.a,{variant:"body1",noWrap:!0,style:{fontSize:".85rem",fontWeight:300},children:e.row.albumArtists}),Object(k.jsxs)(p.a,{variant:"body1",style:{display:"none",fontSize:".85rem",fontWeight:100},children:["\xa0\u2022\xa0",e.row.year]})]})]})}},{field:"popularityChart",headerName:"Popularity",width:200,filterable:!1,sortable:!1,headerAlign:"center",headerClassName:"custom-header",renderCell:function(e){return Object(k.jsx)(Mt,{tracks:e.row.tracks})}},{field:"tracks",headerName:"Tracks",width:90,filterable:!1,sortable:!1,headerAlign:"center",headerClassName:"custom-header",cellClassName:"custom-cell",valueFormatter:function(e){var t=e.row.tracks.length,n=e.row.tracks.filter((function(e){return e.include}));return"".concat(n.length," / ").concat(t)}}],Mt=function(e){var t=e.tracks,n=St(),a=2*t.length,r=Math.min(8,(200-a)/t.length);return Object(k.jsx)(L.a,{container:!0,direction:"row",justifyContent:"flex-start",alignItems:"flex-end",className:n.chart,children:t.map((function(e,t){return Object(k.jsx)(L.a,{item:!0,style:{height:"".concat(e.popularity,"% "),width:"".concat(r,"px"),opacity:"".concat(e.include?1:.25)}},t)}))})},Dt=function(e){var t=e.open,n=e.onClose,r=ne(),c=r.getAlbumsForCurrentTags,s=r.getAlbumTracks,o=r.createPlaylistForTracks,l=Object(a.useState)(!1),u=Object(i.a)(l,2),b=u[0],d=u[1],h=Object(a.useState)(!1),g=Object(i.a)(h,2),m=g[0],O=g[1],y=Object(a.useState)([]),v=Object(i.a)(y,2),w=v[0],C=v[1],T=Object(a.useState)(0),A=Object(i.a)(T,2),S=A[0],P=A[1],N=Object(a.useState)(0),B=Object(i.a)(N,2),F=B[0],z=B[1],I=Object(a.useState)(0),W=Object(i.a)(I,2),U=W[0],q=W[1],G=Object(a.useState)(!1),K=Object(i.a)(G,2),H=K[0],V=K[1],X=Object(a.useState)(""),Z=Object(i.a)(X,2),J=Z[0],Y=Z[1],$=Object(a.useState)(""),Q=Object(i.a)($,2),ee=Q[0],te=Q[1],ae=Object(a.useState)(!1),re=Object(i.a)(ae,2),ce=re[0],se=re[1],ie=Object(a.useState)(!1),oe=Object(i.a)(ie,2),le=oe[0],ue=oe[1],be=Object(a.useState)(void 0),de=Object(i.a)(be,2),he=de[0],je=de[1],fe=function(){var e=Object(D.a)(M.a.mark((function e(){var t,n,a,r,o,l,u,b;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:t=e.sent,n=Object(i.a)(t,2),a=n[0],r=n[1],o=0,l=0;case 8:if(!(l<a.length)){e.next=22;break}return u=a[l],e.next=12,s(u.id,!0);case 12:b=e.sent,u.tracks=b.map((function(e){return{uri:e.uri,popularity:e.popularity,include:!0}})),o+=u.tracks.length,u.averagePopularity=Math.round(pe(u)),u.maxPopularity=ge(u),u.minPopularity=me(u),u.popularityRange=Math.max(1,u.maxPopularity-u.minPopularity);case 19:l++,e.next=8;break;case 22:C(a),P(r),z(o);case 26:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pe=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return e+t}))/e.tracks.length},ge=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return t>e?t:e}),0)},me=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return t<e?t:e}),200)};Object(a.useEffect)((function(){var e=Object(_.a)(w),t=0;e.forEach((function(e){!function(e,t){var n=U/100,a=Math.abs(1-n);e.tracks.forEach((function(r){if(0===e.maxPopularity)r.include=H;else if("avg"===t){var c=r.popularity/e.maxPopularity;r.include=c>=n}else if("range"===t){var s=e.maxPopularity-r.popularity;r.include=s/e.popularityRange<=a}}))}(e,"range"),t+=e.tracks.filter((function(e){return e.include})).length})),C(e),z(t)}),[U,H]),Object(a.useEffect)((function(){t?Object(D.a)(M.a.mark((function e(){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.next=3,fe();case 3:d(!1);case 4:case"end":return e.stop()}}),e)})))():setTimeout((function(){C([]),P(0),q(0),Y(""),te(""),se(!1),ue(!1),je(void 0)}),100)}),[t]);var Le=St();return Object(k.jsxs)(Se.a,{open:t,onClose:n,fullScreen:!0,className:Le.root,children:[Object(k.jsxs)(j.a,{position:"relative",children:[Object(k.jsxs)(f.a,{children:[Object(k.jsx)(x.a,{edge:"start",color:"inherit",onClick:n,"aria-label":"close",children:Object(k.jsx)(ft.a,{})}),Object(k.jsx)(p.a,{variant:"h6",className:Le.title,children:"Playlist Creator"})]}),Object(k.jsx)(At,{})]}),Object(k.jsx)(Me.a,{children:Object(k.jsxs)(L.a,{container:!0,direction:"row",justifyContent:"center",alignItems:"flex-start",spacing:3,children:[Object(k.jsx)(L.a,{item:!0,xs:12,sm:12,md:4,lg:3,children:Object(k.jsxs)(pt.a,{className:Le.controls,children:[Object(k.jsx)(Ae.a,{variant:"outlined",color:"secondary",fullWidth:!0,spellCheck:!1,error:le,label:"Playlist Title",value:J,onChange:function(e){Y(e.target.value),ue(!1)}}),Object(k.jsx)(Ae.a,{variant:"outlined",color:"secondary",fullWidth:!0,spellCheck:!1,label:"Playlist Description",value:ee,onChange:function(e){return te(e.target.value)}}),Object(k.jsx)(gt.a,{label:"Public Playlist",labelPlacement:"start",control:Object(k.jsx)(mt.a,{checked:ce,onChange:function(e){return se(e.target.checked)},color:"secondary"})}),Object(k.jsxs)("div",{id:"popularity-slider",style:{width:"100%"},children:[Object(k.jsx)(p.a,{gutterBottom:!0,children:"Popularity Threshold"}),Object(k.jsxs)(L.a,{container:!0,spacing:2,children:[Object(k.jsx)(L.a,{item:!0,children:Object(k.jsx)(ht.a,{})}),Object(k.jsx)(L.a,{item:!0,xs:!0,children:Object(k.jsx)(Lt.a,{value:U,onChange:function(e,t){return q(t)},color:"secondary"})}),Object(k.jsx)(L.a,{item:!0,children:Object(k.jsx)(bt.a,{})})]})]}),Object(k.jsx)(gt.a,{label:"Include Albums With No Popularity Info",labelPlacement:"start",control:Object(k.jsx)(mt.a,{checked:H,onChange:function(e){return V(e.target.checked)},size:"small",color:"secondary"})}),Object(k.jsxs)(p.a,{className:Le.summary,children:[b&&"Fetching Track Info...",!b&&"Total Tracks: ".concat(F)]}),Object(k.jsx)(E.a,{variant:"contained",color:"secondary",size:"large",disabled:b,endIcon:m?Object(k.jsx)(lt.a,{}):Object(k.jsx)(it.a,{}),onClick:function(){0===J.length?ue(!0):Object(D.a)(M.a.mark((function e(){var t,n,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(!0),t=Object(_.a)(w),n=[],t.map((function(e){return e.tracks.forEach((function(e){e.include&&n.push(e.uri)}))})),e.prev=4,e.next=7,o(J,ee,n,ce);case 7:a=e.sent,je(a),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn(e.t0);case 14:O(!1);case 15:case"end":return e.stop()}}),e,null,[[4,11]])})))()},children:"Create Spotify Playlist"}),he&&Object(k.jsx)(R.a,{style:{textAlign:"center",marginTop:"16px"},children:Object(k.jsxs)(p.a,{variant:"h6",children:["Playlist ",Object(k.jsx)(Ot.a,{href:"https://open.spotify.com/playlist/".concat(he),target:"_blank",rel:"noreferrer",color:"secondary",children:J})," created!"]})})]})}),Object(k.jsx)(xt.a,{smDown:!0,children:Object(k.jsx)(L.a,{item:!0,sm:8,md:8,lg:9,style:{display:"flex",height:"calc(100vh - 170px)"},children:Object(k.jsx)("div",{style:{flexGrow:1},children:Object(k.jsx)(yt.a,{className:Le.albums,loading:b,componentsProps:{popularityThreshold:U},rows:w,columns:Pt,rowCount:S,pageSize:S,rowHeight:60,hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0})})})})]})})]})},Nt=function(e){var t=ne().getCurrentTags,n=Object(a.useState)(!1),c=Object(i.a)(n,2),s=c[0],o=c[1];return Object(k.jsxs)(r.a.Fragment,{children:[Object(k.jsx)(g.a,{title:"Create Playlist from Tags",children:Object(k.jsx)("span",{children:Object(k.jsx)(x.a,{onClick:function(){s||o(!0)},disabled:0===t().length,children:Object(k.jsx)(it.a,{})})})}),Object(k.jsx)(Dt,{open:s,onClose:function(){return o(!1)}})]})},Bt=n(181),Ft=n(82),Rt=n(340),zt=n(182),Et=n.n(zt),It=n(8),_t=function(e){Object(ue.a)(n,e);var t=Object(be.a)(n);function n(e){var a;return Object(K.a)(this,n),(a=t.call(this,e)).batchSize=1,a.state={working:!1,complete:!1,progress:0,offset:0-a.batchSize,total:-1,onlyUntagged:!0,overwriteTags:!1,currentAlbum:void 0,tagged:[],unmatched:[],skipped:[]},a.toggleWorking=a.toggleWorking.bind(Object(Ft.a)(a)),a.toggleUntagged=a.toggleUntagged.bind(Object(Ft.a)(a)),a.toggleOverwrite=a.toggleOverwrite.bind(Object(Ft.a)(a)),a.handleClose=a.handleClose.bind(Object(Ft.a)(a)),a}return Object(H.a)(n,[{key:"processBatch",value:function(){var e=Object(D.a)(M.a.mark((function e(t){var n,a,r,c,s,o,l,u,b,d,h,j,f,p=this;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.getMyAlbums(t,this.batchSize);case 3:r=e.sent,c=Object(i.a)(r,2),n=c[0],a=c[1],e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error(e.t0);case 12:s=Object(_.a)(this.state.tagged),o=Object(_.a)(this.state.unmatched),l=Object(_.a)(this.state.skipped),u=0;case 16:if(!(u<n.length)){e.next=49;break}if(b=n[u],d=!1,(!this.state.onlyUntagged||0!==b.tags.length)&&this.state.onlyUntagged){e.next=43;break}return h=void 0,e.prev=21,e.next=24,this.props.searchDiscogsForAlbum(b,!0);case 24:h=e.sent,e.next=30;break;case 27:throw e.prev=27,e.t1=e.catch(21),new Error(e.t1);case 30:if(!h){e.next=40;break}return j=h.genres,!1===this.state.overwriteTags&&b.tags.length>0&&(b.tags.concat(j),Object(Bt.a)("tags")),b.tags=j,e.next=36,this.props.setTagsForAlbum(b.id,j);case 36:e.sent&&s.push(b),e.next=41;break;case 40:o.push(b);case 41:e.next=45;break;case 43:d=!0,l.push(b);case 45:this.setState({currentAlbum:d?void 0:b,tagged:s,unmatched:o,skipped:l},(function(){return p.forceUpdate()}));case 46:u++,e.next=16;break;case 49:this.setState({tagged:s,unmatched:o,skipped:l}),(f=Math.min(a,t+this.batchSize))>=a?(this.setState({progress:100,working:!1,currentAlbum:void 0,complete:!0}),this.props.resetCurrentTags()):this.state.working&&this.setState({offset:f,total:a});case 53:case"end":return e.stop()}}),e,this,[[0,9],[21,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"toggleWorking",value:function(){var e=this;this.state.working?this.stopWorking():this.setState({working:!0,offset:this.state.offset+this.batchSize},(function(){return e.forceUpdate()}))}},{key:"stopWorking",value:function(){this.state.working&&(this.setState({working:!1,offset:this.state.offset-this.batchSize,currentAlbum:void 0}),this.props.resetCurrentTags())}},{key:"toggleUntagged",value:function(){this.setState({onlyUntagged:!this.state.onlyUntagged})}},{key:"toggleOverwrite",value:function(){this.setState({overwriteTags:!this.state.overwriteTags})}},{key:"handleClose",value:function(){this.stopWorking(),this.props.onClose()}},{key:"normalize",value:function(e,t,n){return 100*(e-t)/(n-t)}},{key:"componentDidMount",value:function(){var e=this;this.props.getMyAlbums(0,1).then((function(t){var n=Object(i.a)(t,2),a=(n[0],n[1]);e.setState({total:a})}))}},{key:"componentDidUpdate",value:function(e,t,n){if(this.state.working&&t.offset!==this.state.offset){var a=Math.round(this.normalize(this.state.offset,0,this.state.total));this.setState({progress:a}),this.state.offset<this.state.total&&this.processBatch(this.state.offset)}else this.state.complete}},{key:"render",value:function(){var e=this,t=this.props.classes;return Object(k.jsxs)(Se.a,{open:this.props.open,onClose:this.handleClose,fullScreen:!0,className:t.root,children:[Object(k.jsx)(j.a,{position:"relative",children:Object(k.jsxs)(f.a,{children:[Object(k.jsx)(x.a,{edge:"start",color:"inherit",onClick:this.handleClose,"aria-label":"close",children:Object(k.jsx)(ft.a,{})}),Object(k.jsx)(p.a,{variant:"h6",className:t.title,children:"Auto Tagger"})]})}),Object(k.jsx)(Me.a,{children:Object(k.jsxs)(L.a,{container:!0,direction:"row",justifyContent:"center",alignItems:"flex-start",spacing:3,children:[Object(k.jsx)(L.a,{item:!0,xs:12,md:4,lg:3,children:Object(k.jsxs)(pt.a,{className:t.controls,children:[Object(k.jsx)(gt.a,{label:"Only Untagged Albums",labelPlacement:"start",control:Object(k.jsx)(mt.a,{checked:this.state.onlyUntagged,onChange:function(t){return e.toggleUntagged(t.target.checked)},size:"small",color:"secondary"})}),Object(k.jsx)(gt.a,{label:"Overwrite Existing Tags",labelPlacement:"start",control:Object(k.jsx)(mt.a,{checked:this.state.overwriteTags,onChange:function(t){return e.toggleOverwrite(t.target.checked)},size:"small",color:"secondary"})}),Object(k.jsx)(E.a,{variant:"contained",color:"secondary",size:"large",endIcon:this.state.working?Object(k.jsx)(Et.a,{}):Object(k.jsx)(S.a,{}),onClick:this.toggleWorking,children:this.state.working?"Stop Tagging":"Start Tagging"})]})}),Object(k.jsxs)(L.a,{item:!0,xs:12,md:8,lg:9,children:[Object(k.jsx)(p.a,{variant:"h6",children:"Stats"}),Object(k.jsxs)(p.a,{variant:"subtitle1",children:["Tagged: ",this.state.tagged.length]}),Object(k.jsxs)(p.a,{variant:"subtitle1",children:["Unmatched: ",this.state.unmatched.length]}),Object(k.jsxs)(p.a,{variant:"subtitle1",children:["Skipped: ",this.state.skipped.length]}),Object(k.jsx)(Rt.a,{className:t.progressBar,variant:"determinate",color:"secondary",value:this.state.progress}),this.state.working&&this.state.currentAlbum&&Object(k.jsxs)(r.a.Fragment,{children:[Object(k.jsx)(ve,{album:this.state.currentAlbum}),Object(k.jsx)(we,{tags:this.state.currentAlbum.tags})]}),this.state.complete&&this.state.unmatched.length>0&&Object(k.jsxs)(r.a.Fragment,{children:[Object(k.jsx)(p.a,{variant:"h6",children:"Unmatched Albums:"}),Object(k.jsx)(R.a,{className:t.unmatchedList,children:this.state.unmatched.map((function(e,t){return Object(k.jsx)(ve,{album:e},t)}))})]})]})]})})]})}}]),n}(r.a.Component),Wt=Object(It.a)((function(e){return{title:{marginLeft:e.spacing(2),flex:1},root:{"& .MuiPaper-root.MuiDialog-paper":{backgroundColor:e.palette.background.default},"& .MuiDialogContent-root":{padding:e.spacing(3)}},controls:{"&":{display:"flex",flexFlow:"column nowrap",justifyContent:"center",alignItems:"center",padding:e.spacing(2)},"& > *":{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginLeft:e.spacing(0)}},progressBar:{marginTop:e.spacing(3),marginBottom:e.spacing(3)},unmatchedList:{"& h6":{marginTop:e.spacing(1)}}}}),{withTheme:!0})(_t),Ut=n(274),qt=n(278),Gt=function(e){Object(ue.a)(n,e);var t=Object(be.a)(n);function n(e){var a;return Object(K.a)(this,n),(a=t.call(this,e)).state={working:!1,progress:0,offset:-1,total:-1,cachedAlbums:[]},a.batchSize=20,a}return Object(H.a)(n,[{key:"processBatch",value:function(){var e=Object(D.a)(M.a.mark((function e(t){var n,a,r,c,s,o,l=this;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.getMyAlbums(t,this.batchSize);case 3:r=e.sent,c=Object(i.a)(r,2),n=c[0],a=c[1],e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error(e.t0);case 12:s=Object(_.a)(this.state.cachedAlbums).concat(n),(o=Math.min(a,t+this.batchSize))>=a?this.setState({progress:100,working:!1},(function(){l.forceUpdate(),setTimeout((function(){l.props.setMyAlbumsCache(s)}),50)})):this.setState({cachedAlbums:s,offset:o,total:a});case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"normalize",value:function(e,t,n){return 100*(e-t)/(n-t)}},{key:"componentDidMount",value:function(){var e=this.props.getMyAlbumsCache();if(null===e)this.setState({offset:0,total:1,working:!0});else{var t=Object(_.a)(e);this.props.setMyAlbumsCache(t)}}},{key:"componentDidUpdate",value:function(e,t,n){if(this.state.working&&t.offset!==this.state.offset){var a=Math.round(this.normalize(this.state.offset,0,this.state.total));this.setState({progress:a}),this.state.offset<this.state.total&&this.processBatch(this.state.offset)}}},{key:"render",value:function(){return Object(k.jsx)(Ut.a,{className:this.props.classes.backdrop,open:this.state.working,children:Object(k.jsxs)(L.a,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",spacing:3,children:[Object(k.jsx)(L.a,{item:!0,children:Object(k.jsx)(p.a,{children:"Loading Albums..."})}),Object(k.jsx)(L.a,{item:!0,children:Object(k.jsx)(Kt,{size:65,value:this.state.progress})})]})})}}]),n}(r.a.Component),Kt=function(e){return Object(k.jsxs)(R.a,{position:"relative",display:"inline-flex",children:[Object(k.jsx)(qt.a,Object(y.a)({variant:"determinate"},e)),Object(k.jsx)(R.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(k.jsx)(p.a,{variant:"caption",component:"div",color:"textSecondary",children:"".concat(e.value,"%")})})]})},Ht=Object(It.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:e.palette.grey}}}),{withTheme:!0})(Gt),Vt=250,Xt=Object(l.b)({palette:{type:"dark",primary:{main:d.a[500]},secondary:{main:h.a.A400}}});Xt.scrollBar={width:8,track:{backgroundColor:"".concat(Xt.palette.background.default)},thumb:{backgroundColor:"".concat(Xt.palette.grey[600])}};var Zt=Object(u.a)((function(e){return{root:{display:"flex",flexFlow:"column nowrap",height:"100vh"},title:{flexGrow:1},main:{flex:"1 1 auto",display:"flex",flexFlow:"row nowrap",overflow:"hidden"},sideBar:{borderRight:"2px solid ".concat(e.palette.grey[800])},content:{flex:"1 1 auto"}}})),Jt=window.location.hash.substring(1).split("&").reduce((function(e,t){if(t){var n=t.split("=");e[n[0]]=decodeURIComponent(n[1])}return e}),{});window.location.hash="";function Yt(){var e=ne(),t=e.setSpotifyToken,n=e.setDatabaseName,c=e.hasSpotifyToken,s=e.persistentSideBar,l=e.sideBarWidth,u=e.getMyAlbums,d=e.searchDiscogsForAlbum,h=e.setTagsForAlbum,y=(e.getCurrentTags,e.removeCurrentTag),v=e.resetCurrentTags,w=e.getMyAlbumsCache,C=e.setMyAlbumsCache,A=e.needsMyAlbumsCache,P=e.isPlaying,M=e.stopPlaying,D=Object(a.useState)(!1),N=Object(i.a)(D,2),B=N[0],F=N[1],R=Object(a.useState)(!1),z=Object(i.a)(R,2),E=z[0],I=z[1],_=function(){F(!B)},W=Zt(Xt);return Object(a.useEffect)((function(){t(Jt.access_token),n("albumTags")}),[]),Object(k.jsxs)(b.a,{theme:Xt,children:[Object(k.jsx)(o.a,{}),Object(k.jsxs)("div",{className:W.root,children:[Object(k.jsxs)(j.a,{position:"static",children:[Object(k.jsxs)(f.a,{children:[Object(k.jsx)(x.a,{edge:"start",disabled:!c()||s(),onClick:_,children:Object(k.jsx)(T,{fontSize:"large"})}),Object(k.jsx)(p.a,{variant:"h6",className:W.title,children:"Tagger for Spotify"}),Object(k.jsx)(g.a,{title:"Auto Tag Albums",children:Object(k.jsx)("span",{children:Object(k.jsx)(x.a,{onClick:function(){return I(!0)},disabled:!1===c(),children:Object(k.jsx)(S.a,{})})})}),Object(k.jsx)(Nt,{})]}),Object(k.jsx)(At,{onDelete:y})]}),Object(k.jsxs)("main",{className:W.main,children:[!c()&&Object(k.jsx)(m.a,{style:{marginTop:"100px",textAlign:"center"},children:Object(k.jsx)(at,{variant:"contained",color:"secondary"})}),c()&&Object(k.jsxs)(r.a.Fragment,{children:[s()&&Object(k.jsxs)(L.a,{container:!0,direction:"column",justifyContent:"flex-start",alignItems:"stretch",className:W.sideBar,style:{flex:"0 0 ".concat(l()+2,"px")},children:[Object(k.jsx)(L.a,{item:!0,style:{height:"calc(100% - ".concat(Vt,"px)")},children:Object(k.jsx)(se,{persistent:!0})}),Object(k.jsx)(L.a,{item:!0,style:{height:"".concat(Vt,"px")},children:Object(k.jsx)(ct,{albumId:"0oGzSazidykcL5XNTEuS9z",width:l(),height:Vt})})]}),!s()&&Object(k.jsxs)(r.a.Fragment,{children:[Object(k.jsx)(O.a,{variant:"temporary",open:B,onClose:_,ModalProps:{keepMounted:!0},children:Object(k.jsx)(se,{persistent:!1})}),Object(k.jsx)(O.a,{variant:"temporary",anchor:"bottom",open:P,onClose:M,ModalProps:{keepMounted:!0},children:Object(k.jsx)(ct,{albumId:"0oGzSazidykcL5XNTEuS9z",width:"100%",height:Vt})})]}),Object(k.jsx)("div",{className:W.content,children:Object(k.jsx)(tt,{})}),A()&&Object(k.jsx)(Ht,{getMyAlbums:u,getMyAlbumsCache:w,setMyAlbumsCache:C}),Object(k.jsx)(Wt,{open:E,onClose:function(){return I(!1)},getMyAlbums:u,searchDiscogsForAlbum:d,setTagsForAlbum:h,resetCurrentTags:v})]})]})]})]})}s.a.render(Object(k.jsx)(q,{children:Object(k.jsx)(Yt,{})}),document.getElementById("root"))}},[[266,1,2]]]);