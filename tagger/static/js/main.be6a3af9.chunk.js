(this.webpackJsonpspotifytagger=this.webpackJsonpspotifytagger||[]).push([[0],{239:function(e,t){},256:function(e,t){},266:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(17),s=n.n(c),i=n(9),o=n(344),l=n(79),u=n(160),b=n(336),d=n(342),h=n(343),f=n(338),p=n(328),j=n(84),g=n(139),m=n(339),x=n(337),O=n(352),y=n(87),v=n(16),k=n(115),w=n(184),C=n(3),T=["tagColor","barColor"],A=function(e){var t=e.tagColor,n=void 0===t?"#1de9b6":t,a=e.barColor,r=void 0===a?"#303030":a,c=Object(k.a)(e,T);return Object(C.jsxs)(w.a,Object(v.a)(Object(v.a)({},c),{},{viewBox:"0 0 400 400",children:[Object(C.jsx)("path",{stroke:"null",fill:n,d:"m310.75011,69.83626c-7.60697,-10.77654 -20.28526,-17.7496 -34.44268,-17.7496l-232.43525,0.21131c-23.24352,0 -42.26096,18.80613 -42.26096,42.04965l0,211.30478c0,23.24352 19.01743,42.04965 42.26096,42.04965l232.43525,0.21131c14.15742,0 26.83571,-6.97306 34.44268,-17.7496l83.67669,-117.90806c5.28262,-7.39567 5.28262,-17.11569 0,-24.51136l-83.67669,-117.90806l0,-0.00001z"}),Object(C.jsx)("path",{stroke:"null",fill:r,d:"M275.75 137.75C275.75 137.75 275.75 137.75 275.75 137.75C275.75 148.11 267.36 156.5 257 156.5C215.75 156.5 110.75 156.5 69.5 156.5C59.14 156.5 50.75 148.11 50.75 137.75C50.75 137.75 50.75 137.75 50.75 137.75C50.75 137.75 50.75 137.75 50.75 137.75C50.75 127.39 59.14 119 69.5 119C110.75 119 215.75 119 257 119C267.36 119 275.75 127.39 275.75 137.75C275.75 137.75 275.75 137.75 275.75 137.75Z"}),Object(C.jsx)("path",{stroke:"null",fill:r,d:"M313.25 201C313.25 201 313.25 201 313.25 201C313.25 211.36 304.86 219.75 294.5 219.75C245.75 219.75 118.25 219.75 69.5 219.75C59.14 219.75 50.75 211.36 50.75 201C50.75 201 50.75 201 50.75 201C50.75 201 50.75 201 50.75 201C50.75 190.64 59.14 182.25 69.5 182.25C118.25 182.25 245.75 182.25 294.5 182.25C304.86 182.25 313.25 190.64 313.25 201C313.25 201 313.25 201 313.25 201Z"}),Object(C.jsx)("path",{stroke:"null",fill:r,d:"M275.75 263.25C275.75 263.25 275.75 263.25 275.75 263.25C275.75 273.61 267.36 282 257 282C215.75 282 110.75 282 69.5 282C59.14 282 50.75 273.61 50.75 263.25C50.75 263.25 50.75 263.25 50.75 263.25C50.75 263.25 50.75 263.25 50.75 263.25C50.75 252.89 59.14 244.5 69.5 244.5C110.75 244.5 215.75 244.5 257 244.5C267.36 244.5 275.75 252.89 275.75 263.25C275.75 263.25 275.75 263.25 275.75 263.25Z"})]}))},S=n(114),M=n.n(S),P=n(15),D=n.n(P),N=n(25),B=n(268),F=n(269),z=n(324),_=n(345),R=n(323),E=n(77),I=n(348),L=n(18),W={allTags:[],currentTags:[],myAlbumsCache:{lastCached:void 0,albums:[]},albumsForCurrentTags:[],currentAlbum:void 0,currentSearch:{query:void 0,tags:[]},playingAlbum:void 0,isPlaying:!1},U=r.a.createContext([{},function(){}]),G=function(e){var t=Object(a.useState)(W),n=Object(i.a)(t,2),r=n[0],c=n[1];return Object(C.jsx)(U.Provider,{value:[r,c],children:e.children})},q=n(322),K=n(41),J=n(42),V=n(165),X=n.n(V),Z=n(116),H=n(183),Y=n(166),$=n.n(Y);Z.a.plugin(H.a),Z.a.plugin($.a);var Q=!1,ee=function(){function e(){Object(K.a)(this,e)}return Object(J.a)(e,null,[{key:"hasSpotifyToken",value:function(){return void 0!==e.spotifyApi.getAccessToken()}},{key:"setSpotifyToken",value:function(t){e.spotifyApi.setAccessToken(t)}},{key:"setDbName",value:function(t){e.pouchDB=new Z.a(t)}},{key:"fetchSavedAlbums",value:function(t,n){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise(function(){var r=Object(N.a)(D.a.mark((function r(c,s){var i,o,l,u,b;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.spotifyApi.getMySavedAlbums({limit:n,offset:t});case 3:if(i=r.sent,o=i.body.total,l=i.body.items.map((function(t,n){return e._formatSpotifyAlbum(t.album)})),!a){r.next=12;break}return u=l.map((function(e){return e.id})),r.next=10,e.fetchTagsForAlbumKeys(u);case 10:b=r.sent,l.forEach((function(e){e.tags=b[e.id]||[]}));case 12:c([l,o]),r.next=19;break;case 15:r.prev=15,r.t0=r.catch(0),console.warn("fetchSavedAlbums",r.t0),c([[],0]);case 19:case 20:case"end":return r.stop()}}),r,null,[[0,15]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"fetchAlbumsByKey",value:function(t){return new Promise(function(){var n=Object(N.a)(D.a.mark((function n(a,r){var c,s,i;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=21;break}c=[];case 2:if(!(t.length>0)){n.next=18;break}return s=t.splice(0,20),n.prev=4,n.next=7,e.spotifyApi.getAlbums(s);case 7:i=n.sent,c=c.concat(i.body.albums.map((function(t,n){return e._formatSpotifyAlbum(t)}))),n.next=16;break;case 11:return n.prev=11,n.t0=n.catch(4),console.warn("fetchAlbumsByKey",n.t0),a([]),n.abrupt("break",18);case 16:n.next=2;break;case 18:a(c),n.next=23;break;case 21:console.warn("fetchAlbumsByKey: no keys!"),a([]);case 23:case"end":return n.stop()}}),n,null,[[4,11]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"fetchTracksForAlbum",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var a=Object(N.a)(D.a.mark((function a(r,c){var s,i;return D.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,e.spotifyApi.getAlbumTracks(t);case 3:if(s=a.sent,i=s.body.items,!n){a.next=10;break}return a.next=8,e.spotifyApi.getTracks(i.map((function(e){return e.id})));case 8:a.sent.body.tracks.forEach((function(e){i.find((function(t){return t.id===e.id})).popularity=e.popularity}));case 10:r(i),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(0),c(a.t0);case 16:case 17:case"end":return a.stop()}}),a,null,[[0,13]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"createPlaylist",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(r,c){e.spotifyApi.createPlaylist(t,{description:n,public:a}).then((function(e){r(e.body.id)}),(function(e){c(e)}))}))}},{key:"addTracksToPlaylist",value:function(t,n){return new Promise(function(){var a=Object(N.a)(D.a.mark((function a(r,c){var s,i;return D.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s="";case 1:if(!(n.length>0)){a.next=16;break}return i=n.splice(0,100),a.prev=3,a.next=6,e.spotifyApi.addTracksToPlaylist(t,i);case 6:s=a.sent,console.log(s),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(3),console.warn("addTracksToPlaylist",a.t0),c(a.t0);case 14:a.next=1;break;case 16:r(s);case 17:case"end":return a.stop()}}),a,null,[[3,10]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"_formatSpotifyAlbum",value:function(e){return{id:e.id,albumArtists:e.artists.map((function(e){return e.name})).join(", "),albumName:e.name,albumArt:e.images[2].url,year:e.release_date.split("-")[0],tags:[]}}},{key:"fetchTagsForAlbumKeys",value:function(t){return new Promise((function(n,a){e.pouchDB.allDocs({keys:t,include_docs:!0}).then((function(e){var t={};e.rows.filter((function(e){return!e.error})).forEach((function(e){e.doc?t[e.id]=e.doc.tags:console.warn("no doc for",e)})),n(t)}),(function(e){console.warn("fetchTagsForAlbumKeys",e),n({})}))}))}},{key:"fetchDocsForTags",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(a,r){var c={};c=n?{tags:{$all:t}}:{tags:{$in:t}},e.pouchDB.find({selector:c,fields:["_id","tags"]}).then((function(e){a(e.docs)}),(function(e){console.warn("fetchDocsForTags",e),a([])}))}))}},{key:"fetchAlbumsForTags",value:function(t){return new Promise(function(){var n=Object(N.a)(D.a.mark((function n(a,r){var c,s,i;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.fetchDocsForTags(t);case 3:return c=n.sent,s=c.map((function(e){return e._id})),n.next=7,e.fetchAlbumsByKey(s);case 7:(i=n.sent).forEach((function(e){var t=c.find((function(t){return t._id===e.id}));t&&(e.tags=t.tags)})),a(i),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(0),console.warn("fetchAlbumsForTags",n.t0),a([]);case 16:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"fetchUniqueTags",value:function(){return new Promise((function(t,n){e.pouchDB.allDocs({include_docs:!0}).then((function(n){var a={};n.rows.forEach((function(t){t.doc.tags&&Array.isArray(t.doc.tags)?t.doc.tags.forEach((function(e){void 0===a[e]&&(a[e]=0),a[e]++})):(console.warn("doc is messed up so delete it",t),e.pouchDB.remove(t.doc))})),t(a)}),(function(e){console.warn("fetchUniqueTags",e),t({})}))}))}},{key:"fetchUniqueTagsArray",value:function(){return new Promise((function(t,n){e.fetchUniqueTags().then((function(e){for(var n=[],a=0,r=Object.entries(e);a<r.length;a++){var c=Object(i.a)(r[a],2),s=c[0],o=c[1];n.push({label:s,count:o})}t(n)}),(function(e){console.warn("fetchUniqueTagsArray",e),t([])}))}))}},{key:"updateDoc",value:function(t){return new Promise(function(){var n=Object(N.a)(D.a.mark((function n(a,r){var c;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.pouchDB.upsert(t.id,(function(e){return e.tags=t.tags,e}));case 3:c=n.sent,a(c),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.warn("upsertDoc",err),a(!1);case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"startDiscogsLog",value:function(){this.discogsStats.startTime=(new Date).getTime(),this.discogsStats.callTimes=[]}},{key:"getDiscogsMatchesForAlbum",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=n?2:5;return new Promise(function(){var r=Object(N.a)(D.a.mark((function r(c,s){var i,o,l,u,b,d,h,f;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:Q,i=t.albumArtists.split(",")[0],o=!1,0===i.toLowerCase().indexOf("various")&&(o=!0,i=""),l=t.albumName.replace(/LP/,"").replace(/EP/,""),u=[{release_title:l,artist:i,per_page:1},{query:"".concat(l," ").concat(i),per_page:5},{query:"".concat(l),per_page:5},{query:"".concat(l.split(/\b/)[0]," ").concat(i),per_page:5},{query:"".concat(l.split(/\b/)[0]," ").concat(i.split(/\b/)[0]),per_page:5}],b=u.shift(),d=0,h=[],f=void 0;case 10:return d++,r.prev=11,r.next=14,e._doDiscogsSearch(b,n);case 14:h=r.sent,r.next=22;break;case 17:r.prev=17,r.t0=r.catch(11),console.warn("Probably exceeding API limit!!!",r.t0),h=[],f=r.t0;case 22:b=u.shift();case 23:if(!f&&d<a&&0===h.length&&b){r.next=10;break}case 24:f?s(f):(h=e._filterDiscogsResults(t,h,o),c(h));case 25:case"end":return r.stop()}}),r,null,[[11,17]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_doDiscogsSearch",value:function(e,t){var n=this;return new Promise((function(a,r){void 0!==n.discogsStats.callTimes&&n.discogsStats.callTimes.push((new Date).getTime());var c=new URL("https://api.discogs.com/database/search"),s=Object.assign(e,{type:"release",page:0,token:"zVXJkuBoXwLyxIzfZUwoxxjMIYzCiTkUYqlsQnjR"});c.search=new URLSearchParams(s).toString();fetch(c,{method:"GET",mode:"cors",headers:{}}).then(function(){var e=Object(N.a)(D.a.mark((function e(n){var r,c,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t?950:0,e.next=3,n.json();case 3:c=e.sent,s=c.results.map((function(e){var t=e.title.indexOf(" - "),n=e.title.substr(0,t),a=e.title.substr(t+3);n=(n=n.replace(/\s\(\d+\)/g,"")).replace("*","");var r=[];return e.genre&&(r=r.concat(e.genre)),e.style&&(r=r.concat(e.style)),r=r.filter((function(e,t,n){return n.indexOf(e)===t})),{uri:e.uri,title:a,artists:n,genres:r,thumb:e.thumb}})),setTimeout((function(){a(s)}),r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){r(e)}))}))}},{key:"_filterDiscogsResults",value:function(e,t,n){var a=e.albumArtists.split(",").map((function(e){return e.split(/\s/)})).flat().map((function(e){return e.toLowerCase()})),r=e.albumName.split(/\s/).map((function(e){return e.replace(/\W/g,"").toLowerCase()})),c=n?0:1,s=Math.min(3,Math.ceil(r.length/2));return t.filter((function(e){var t=!0;c>0&&(t=e.artists.split(/(?:,\s)|(?:\s&\s)/).map((function(e){return e.split(/\s/)})).flat().map((function(e){return e.toLowerCase()})).filter((function(e){return-1!==a.indexOf(e)})).length>=c);var n=e.title.split(/\s/).map((function(e){return e.replace(/\W/g,"").toLowerCase()})).filter((function(e){return-1!==r.indexOf(e)}));return t&&n.length>=s}))}},{key:"titleCaseTags",value:function(){return new Promise(function(){var t=Object(N.a)(D.a.mark((function t(n,a){var r,c,s,i;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.fetchUniqueTags();case 3:return r=t.sent,Object.keys(r).forEach((function(t){var n=e.toTitleCase(t);r[t]=n})),t.next=7,e.pouchDB.allDocs({include_docs:!0});case 7:return c=t.sent,s=[],c.rows.forEach((function(e){var t=e.doc.tags.map((function(e){return r[e]}));s.push({_id:e.doc._id,_rev:e.doc._rev,tags:t})})),t.next=12,e.pouchDB.bulkDocs(s);case 12:i=t.sent,n(i),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(0),console.warn("titleCaseTags",t.t0),n(!1);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"toTitleCase",value:function(e){return e.replace(/([^\W_]+[^\s-]*) */g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}}]),e}();ee.spotifyApi=new X.a,ee.pouchDB=void 0,ee.logDiscogsStats=!1,ee.discogsStats={startTime:void 0,callTimes:void 0};var te=ee,ne="MyAlbumsCache",ae=function(){var e=Object(a.useContext)(U),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(q.a)("(min-width:800px)");function s(e,t){return!1===o()?new Promise((function(a,r){var c=Object(L.a)(n.myAlbumsCache.albums),s=c.length;if(void 0!==e){var i=Math.min(s,e+t);c=c.slice(e,i)}a([c,s])})):te.fetchSavedAlbums(e,t,!0)}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36e5;if(n.myAlbumsCache.lastCached){var t=(new Date).getTime();return t-n.myAlbumsCache.lastCached>e}return!0}function l(){return u.apply(this,arguments)}function u(){return(u=Object(N.a)(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.fetchUniqueTagsArray();case 2:(t=e.sent).sort((function(e,t){return t.count-e.count})),r((function(e){return Object(v.a)(Object(v.a)({},e),{},{allTags:t})}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return d.apply(this,arguments)}function d(){return(d=Object(N.a)(D.a.mark((function e(t){var a,c,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],!1!==o()){e.next=9;break}return e.next=4,te.fetchDocsForTags(t);case 4:c=e.sent,s=c.map((function(e){return e._id})),a=n.myAlbumsCache.albums.filter((function(e){return-1!==s.indexOf(e.id)})),e.next=12;break;case 9:return e.next=11,te.fetchAlbumsForTags(t);case 11:a=e.sent;case 12:r((function(e){return Object(v.a)(Object(v.a)({},e),{},{currentTags:t,albumsForCurrentTags:a})}));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){-1===n.currentTags.indexOf(e)&&b([].concat(Object(L.a)(n.currentTags),[e]))}function f(e){b(n.currentTags.filter((function(t){return t!==e})))}return{setSpotifyToken:function(e){te.setSpotifyToken(e)},hasSpotifyToken:function(){return te.hasSpotifyToken()},setDatabaseName:function(e){te.setDbName(e),l()},persistentSideBar:function(){return c},sideBarWidth:function(){return 250},getMyAlbums:s,needsMyAlbumsCache:o,getMyAlbumsCache:function(){var e=JSON.parse(window.localStorage.getItem(ne));return null!==e&&console.log("got albums from localStorage"),e},setMyAlbumsCache:function(e){var t=(new Date).getTime();r((function(n){return Object(v.a)(Object(v.a)({},n),{},{myAlbumsCache:{albums:e,lastCached:t}})})),window.localStorage.setItem(ne,JSON.stringify(e))},getAlbumsForCurrentTags:function(e,t){return new Promise(function(){var a=Object(N.a)(D.a.mark((function a(r,c){var o,l,u,b,d;return D.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(l=0,!(n.currentTags.length>0)){a.next=6;break}l=n.albumsForCurrentTags.length,o=Object(L.a)(n.albumsForCurrentTags),a.next=12;break;case 6:return a.next=8,s(e,t);case 8:u=a.sent,b=Object(i.a)(u,2),o=b[0],l=b[1];case 12:void 0!==e&&(d=Math.min(l,e+t),o=o.slice(e,d)),r([o,l]);case 14:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())},setTagsForAlbum:function(e,t){if(window.localStorage.removeItem(ne),!1===o()){for(var a=-1,c=0;c<n.myAlbumsCache.albums.length;c++)if(n.myAlbumsCache.albums[c].id===e){a=c;break}if(-1!==a){var s=Object.assign({},n.myAlbumsCache.albums[a],{tags:t}),i=Object(L.a)(n.myAlbumsCache.albums);i.splice(a,1,s);var u=n.myAlbumsCache.lastCached;r((function(e){return Object(v.a)(Object(v.a)({},e),{},{myAlbumsCache:{albums:i,lastCached:u}})}))}else console.warn("setTagsForAlbum: could not find cached album!")}return new Promise((function(n,a){te.updateDoc({id:e,tags:t}).then((function(e){e?l().then((function(){return n(!0)})):n(!1)}))}))},getAlbumTracks:function(e,t){return new Promise((function(n,a){te.fetchTracksForAlbum(e,t).then((function(e){n(e)}),(function(e){console.warn("could not get album tracks",e),n([])}))}))},getAllTags:function(){return n.allTags},refreshAllTags:l,getCurrentTags:function(){return n.currentTags},setCurrentTags:b,resetCurrentTags:function(){r((function(e){return Object(v.a)(Object(v.a)({},e),{},{currentTags:Object(L.a)(e.currentTags)})}))},addCurrentTag:h,removeCurrentTag:f,toggleCurrentTag:function(e){-1===n.currentTags.indexOf(e)?h(e):f(e)},getCurrentAlbum:function(){return n.currentAlbum},setCurrentAlbum:function(e){r((function(t){return Object(v.a)(Object(v.a)({},t),{},{currentAlbum:e})}))},getPlayingAlbum:function(){return n.playingAlbum},playAlbum:function(e){n.playingAlbum!==e?r((function(t){return Object(v.a)(Object(v.a)({},t),{},{playingAlbum:e,isPlaying:!0})})):!1===n.isPlaying&&r((function(e){return Object(v.a)(Object(v.a)({},e),{},{isPlaying:!0})}))},stopPlaying:function(){r((function(e){return Object(v.a)(Object(v.a)({},e),{},{isPlaying:!1})}))},isPlaying:n.isPlaying,searchDiscogsForAlbum:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,a){te.getDiscogsMatchesForAlbum(e,t).then((function(e){e.length>0?n(e[0]):n(void 0)}),(function(e){a(e)}))}))},createPlaylistForTracks:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(function(){var r=Object(N.a)(D.a.mark((function r(c,s){var i;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,te.createPlaylist(e,t,a);case 3:return i=r.sent,r.next=6,te.addTracksToPlaylist(i,n);case 6:r.sent,c(i),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),s(r.t0);case 13:case"end":return r.stop()}}),r,null,[[0,10]])})));return function(e,t){return r.apply(this,arguments)}}())}}},re=["handleTagClick","persistent"],ce=Object(u.a)((function(e){return{root:{"&":{height:"100%",display:"flex",flexDirection:"column"},"& h6":{padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px 0 ").concat(e.spacing(2),"px")},"& .MuiBox-root":{padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px"),borderBottom:"1px solid ".concat(e.palette.grey[700])},"& .MuiBox-root > .MuiTypography-button":{padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px ").concat(e.spacing(1),"px 0")},"& .MuiList-root::-webkit-scrollbar":{width:e.scrollBar.width},"& .MuiList-root::-webkit-scrollbar-track":e.scrollBar.track,"& .MuiList-root::-webkit-scrollbar-thumb":e.scrollBar.thumb,"& .MuiList-root":{flexGrow:1,overflowY:"scroll"}}}})),se=function(e,t){return e.sort((function(e,n){if(-1===e.index&&-1===n.index){if("count"===t){var a=n.count-e.count;return 0===a?-1===e.index?1:-1===n.index?-1:e.index-n.index:a}return e.label<n.label?-1:e.label>n.label?1:0}return-1===e.index?1:-1===n.index||e.index<n.index?-1:1}))},ie=function(e){e.handleTagClick;var t=e.persistent,n=Object(k.a)(e,re),r=ae(),c=r.getAllTags,s=r.getCurrentTags,o=r.getAlbumsForCurrentTags,l=r.toggleCurrentTag,u=r.sideBarWidth,b=Object(a.useState)([]),d=Object(i.a)(b,2),h=d[0],f=d[1],p=Object(a.useState)("label"),g=Object(i.a)(p,2),m=g[0],x=g[1],O=Object(a.useRef)(null),y=function(){var e=Object(N.a)(D.a.mark((function e(){var t,n,a,r,l,u,b,d,h,p,j,g;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!((n=s()).length>0)){e.next=14;break}return a={},e.next=6,o();case 6:for(r=e.sent,l=Object(i.a)(r,2),u=l[0],l[1],u.forEach((function(e){e.tags.find((function(e){return-1!==n.indexOf(e)}))&&e.tags.forEach((function(e){void 0===a[e]&&(a[e]=0),a[e]++}))})),b=0,d=Object.entries(a);b<d.length;b++)h=Object(i.a)(d[b],2),p=h[0],j=h[1],g=n.indexOf(p),t.push({label:p,count:j,index:g});e.next=15;break;case 14:t=c().map((function(e){return Object(v.a)(Object(v.a)({},e),{},{index:-1})}));case 15:f(se(t,m));case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){O.current.scrollTop=0}),[s()]),Object(a.useEffect)((function(){y()}),[c(),s(),m]);var w=ce();return Object(C.jsxs)(_.a,Object(v.a)(Object(v.a)({},n),{},{className:w.root,style:{width:"".concat(u(),"px")},children:[!t&&Object(C.jsx)(j.a,{variant:"h6",children:"Tags"}),Object(C.jsxs)(_.a,{children:[Object(C.jsx)(j.a,{variant:"button",children:"Sort"}),Object(C.jsxs)(R.a,{children:[Object(C.jsx)(E.a,{onClick:function(){return x("label")},size:"small",variant:"label"===m?"contained":"outlined",children:"Label"}),Object(C.jsx)(E.a,{onClick:function(){return x("count")},size:"small",variant:"count"===m?"contained":"outlined",children:"Count"})]})]}),Object(C.jsxs)(B.a,{dense:t,ref:O,children:[0===h.length&&Object(C.jsx)(F.a,{children:Object(C.jsx)(z.a,{children:"Add some tags to get started"})}),h.map((function(e,t){return Object(C.jsxs)(F.a,{button:!0,selected:-1!==s().indexOf(e.label),onClick:function(){return l(e.label)},children:[Object(C.jsx)(z.a,{children:e.label}),Object(C.jsx)(I.a,{size:"small",disabled:!0,variant:"outlined",label:e.count})]},t)}))]})]}))},oe=n(55),le=n(12),ue=n(65),be=n(54),de=n(53),he=n(1),fe=n(4),pe=[{name:"VirtualTable"}],je="albumArtColumnType";var ge=function(e){Object(be.a)(n,e);var t=Object(de.a)(n);function n(){return Object(K.a)(this,n),t.apply(this,arguments)}return Object(J.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.width;return Object(C.jsxs)(he.g,{name:"AlbumArtColumn",dependencies:pe,children:[Object(C.jsx)(he.f,{name:"tableColumns",computed:function(e){return function(e,t){return[{key:je,type:je,width:t}].concat(Object(L.a)(e))}(e.tableColumns,n)}}),Object(C.jsx)(he.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type===fe.q&&t.type===je}(e.tableRow,e.tableColumn)},children:Object(C.jsx)(oe.c.Cell,{})}),Object(C.jsx)(he.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type!==fe.q&&e.type!==fe.u&&t.type===je}(e.tableRow,e.tableColumn)},children:function(e){return Object(C.jsx)(oe.c.Cell,Object(v.a)(Object(v.a)({},e),{},{row:e.tableRow.row,style:{textOverflow:"clip"},children:e.tableRow.row&&Object(C.jsx)(E.a,{variant:"text",style:{padding:"4px"},onClick:function(){return t(e.tableRow.row.id)},children:Object(C.jsx)("img",{src:e.tableRow.row.albumArt,width:"64",height:"64"})})}))}})]})}}]),n}(r.a.PureComponent);ge.defaultProps={width:96};var me=n(112),xe=n.n(me),Oe=[{name:"VirtualTable"}],ye="searchColumnType";var ve=function(e){Object(be.a)(n,e);var t=Object(de.a)(n);function n(){return Object(K.a)(this,n),t.apply(this,arguments)}return Object(J.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.width;return Object(C.jsxs)(he.g,{name:"SearchColumn",dependencies:Oe,children:[Object(C.jsx)(he.f,{name:"tableColumns",computed:function(e){return function(e,t){return[].concat(Object(L.a)(e),[{key:ye,type:ye,width:t}])}(e.tableColumns,n)}}),Object(C.jsx)(he.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type===fe.q&&t.type===ye}(e.tableRow,e.tableColumn)},children:Object(C.jsx)(oe.c.Cell,{children:" "})}),Object(C.jsx)(he.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type!==fe.q&&e.type!==fe.u&&t.type===ye}(e.tableRow,e.tableColumn)},children:function(e){return Object(C.jsx)(oe.c.Cell,Object(v.a)(Object(v.a)({},e),{},{row:e.tableRow.row,style:{textOverflow:"clip"},children:Object(C.jsx)(y.a,{onClick:function(){return t(e.tableRow.row)},size:"small",children:Object(C.jsx)(xe.a,{})})}))}})]})}}]),n}(r.a.PureComponent);ve.defaultProps={width:60};var ke=function(e){var t=e.album;return Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(j.a,{variant:"h6",noWrap:!0,style:{fontSize:"1rem",fontWeight:400},children:t.albumName}),Object(C.jsx)(j.a,{variant:"body1",noWrap:!0,style:{fontSize:".85rem",fontWeight:300},children:t.albumArtists})]})},we=function(e){return e.tags.map((function(e,t){return Object(C.jsx)(I.a,{size:"small",label:e,style:{margin:".125rem .25rem .125rem 0"}},t)}))},Ce=n(350),Te=n(175),Ae=n.n(Te),Se=n(329),Me=n(330),Pe=n(331),De=n(335),Ne=n(332),Be=n(334),Fe=n(273),ze=n(189),_e=n(333),Re=Object(u.a)((function(e){return{dialogRoot:{"&.MuiDialog-root .MuiDialogTitle-root":{backgroundColor:e.palette.primary.main}},results:{"&.MuiList-root .MuiListItemAvatar-root":{marginRight:e.spacing(1)}},genres:{"&.MuiList-root":{paddingTop:e.spacing(0),paddingBottom:e.spacing(0)},"&.MuiList-root .MuiListItem-root":{paddingTop:e.spacing(0),paddingBottom:e.spacing(0)}},add:{marginLeft:"auto"},large:{width:e.spacing(10),height:e.spacing(10)}}})),Ee=function(e){var t=e.open,n=e.onClose,c=(e.album,ae()),s=c.getCurrentAlbum,o=c.setTagsForAlbum,l=c.resetCurrentTags,u=Object(a.useState)(!1),b=Object(i.a)(u,2),d=b[0],h=b[1],f=Object(a.useState)([]),p=Object(i.a)(f,2),g=p[0],m=p[1],x=Object(a.useState)([]),O=Object(i.a)(x,2),y=O[0],v=O[1];Object(a.useEffect)((function(){if(t){var e=s();v([]),h(!0),te.getDiscogsMatchesForAlbum(e).then((function(e){m([e[0]]),h(!1)}),(function(e){h(!1)}))}}),[t]);var k=Re();return Object(C.jsxs)(Se.a,{open:t,onClose:n,fullWidth:!0,maxWidth:"xs",className:k.dialogRoot,children:[Object(C.jsx)(Me.a,{children:"Discogs Result"}),Object(C.jsxs)(Pe.a,{children:[Object(C.jsxs)(B.a,{dense:!0,className:k.results,children:[d&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsxs)(F.a,{dense:!0,children:[Object(C.jsx)(Ne.a,{children:Object(C.jsx)(_e.a,{variant:"rect",children:Object(C.jsx)(Ce.a,{variant:"square",className:k.large})})}),Object(C.jsxs)(z.a,{children:[Object(C.jsx)(_e.a,{variant:"text"}),Object(C.jsx)(_e.a,{variant:"text"})]})]}),Object(C.jsxs)(B.a,{dense:!0,subheader:Object(C.jsx)(Be.a,{children:"Genres & Styles"}),className:k.genres,children:[Object(C.jsx)(F.a,{dense:!0,children:Object(C.jsx)(z.a,{children:Object(C.jsx)(_e.a,{variant:"text"})})}),Object(C.jsx)(F.a,{dense:!0,children:Object(C.jsx)(z.a,{children:Object(C.jsx)(_e.a,{variant:"text"})})}),Object(C.jsx)(F.a,{dense:!0,children:Object(C.jsx)(z.a,{children:Object(C.jsx)(_e.a,{variant:"text"})})})]})]}),!d&&g.length>0&&g.map((function(e,t){return Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsxs)(F.a,{dense:!0,button:!0,onClick:function(){return t=e.uri,void window.open("https://discogs.com".concat(t),"discogsWindow");var t},children:[Object(C.jsx)(Ne.a,{children:Object(C.jsx)(Ce.a,{variant:"square",src:e.thumb,className:k.large})}),Object(C.jsx)(z.a,{primary:e.title,secondary:e.artists})]}),Object(C.jsx)(B.a,{dense:!0,subheader:Object(C.jsx)(Be.a,{children:"Genres & Styles"}),className:k.genres,children:e.genres.map((function(e,t){return Object(C.jsxs)(F.a,{dense:!0,button:!0,onClick:function(){return function(e){var t=y.indexOf(e),n=Object(L.a)(y);-1===t?n.push(e):n.splice(t,1),v(n)}(e)},children:[Object(C.jsx)(Fe.a,{children:Object(C.jsx)(ze.a,{checked:-1!==y.indexOf(e),disableRipple:!0})}),Object(C.jsx)(z.a,{children:e})]},t)}))})]},t)}))]}),!d&&0===g.length&&Object(C.jsx)(_.a,{style:{textAlign:"center",width:"100%",height:"100px"},children:Object(C.jsx)(j.a,{variant:"body1",style:{marginTop:"30px"},children:"No match \ud83d\ude13"})})]}),Object(C.jsx)(De.a,{children:Object(C.jsx)(E.a,{startIcon:Object(C.jsx)(Ae.a,{}),disabled:d||!d&&(0===g.length||0===y.length),onClick:function(){!function(e){var t=s(),n=Object(L.a)(e);t.tags&&(n=n.concat(t.tags)),n=n.filter((function(e,t,n){return n.indexOf(e)===t}));var a=t.id;o(a,n),l()}(y),n()},children:"Add Tags to Album"})})]})},Ie=Object(u.a)((function(e){return{root:{"&":{height:"100%"},"& table:first-of-type":{backgroundColor:e.palette.primary.dark},"& .MuiTableCell-head":{padding:e.spacing(1)},"& .MuiTable-root .MuiTableBody-root .MuiTableRow-root .MuiTableCell-body":{padding:"2px 8px"},"& > div > div::-webkit-scrollbar":{width:e.scrollBar.width},"& > div > div::-webkit-scrollbar-track":e.scrollBar.track,"& > div > div::-webkit-scrollbar-thumb":e.scrollBar.thumb},chipTag:{marginRight:e.spacing(1)},paginator:{"&.MuiPagination-root .MuiPagination-ul":{justifyContent:"center"}}}})),Le=[{name:"title",title:"Title",getCellValue:function(e){return e.albumName+" - "+e.albumArtists}},{name:"tags",title:"Tags",getCellValue:function(e){if(e.tags){var t=e.tags;return Array.isArray(t)||(t=String(t).split(/\s*,\s*/).filter((function(e){return String(e).trim().length>0}))),t}return[]}}],We=function(e){var t=e.row;return Object(C.jsx)(ke,{album:t})},Ue=function(e){return Object(C.jsx)(le.b,Object(v.a)({for:["title"],formatterComponent:We},e))},Ge=function(e){var t=e.value;return Object(C.jsx)(we,{tags:t})},qe=function(e){return Object(C.jsx)(le.b,Object(v.a)({for:["tags"],formatterComponent:Ge},e))};var Ke=function(e){return Object(C.jsx)(oe.a.Root,Object(v.a)(Object(v.a)({},e),{},{style:{height:"99%"}}))},Je=function(){var e=ae(),t=e.getAlbumsForCurrentTags,n=e.getCurrentTags,c=e.needsMyAlbumsCache,s=e.setCurrentAlbum,o=e.playAlbum,l=e.sideBarWidth,u=Object(a.useState)(!1),b=Object(i.a)(u,2),d=b[0],h=b[1],f=Object(a.useState)([]),p=Object(i.a)(f,2),j=p[0],g=p[1],m=Object(a.useState)(),x=Object(i.a)(m,2),O=x[0],y=x[1],v=function(){var e=window.innerWidth>800,t=window.innerWidth-82-40-10;e&&(t-=l());var n=Math.round(t*(t>450?.4:.6));y([{columnName:"title",width:n},{columnName:"tags",width:t-n,wordWrapEnabled:e}])};Object(a.useEffect)((function(){Object(N.a)(D.a.mark((function e(){var n,a,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==c()){e.next=8;break}return e.next=3,t();case 3:n=e.sent,a=Object(i.a)(n,2),r=a[0],a[1],g(r);case 8:case"end":return e.stop()}}),e)})))()}),[c(),n()]),Object(a.useEffect)((function(){v(),window.addEventListener("resize",Object(ue.a)(v,250))}),[]);var k=Ie();return Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)("div",{className:k.root,children:Object(C.jsxs)(oe.a,{rootComponent:Ke,rows:j,columns:Le,children:[Object(C.jsx)(le.k,{}),Object(C.jsx)(le.h,{}),Object(C.jsx)(Ue,{}),Object(C.jsx)(qe,{}),Object(C.jsx)(oe.c,{height:"auto",estimatedRowHeight:78,columnExtensions:O}),Object(C.jsx)(oe.b,{showSortingControls:!0}),Object(C.jsx)(ge,{onClick:o,width:82}),Object(C.jsx)(ve,{onClick:function(e){s(e),h(!0)},width:40})]})}),Object(C.jsx)(Ee,{open:d,onClose:function(){return h(!1)}})]})},Ve=(n(346),n(93)),Xe=n(134),Ze=n.n(Xe);Object(u.a)((function(e){return{root:{border:0,"&.MuiDataGrid-root .MuiDataGrid-cell:focus, &.MuiDataGrid-root .MuiDataGrid-cell:focus-within":{outline:"none"},height:"calc(100% - 36px)"},chipTag:{marginRight:e.spacing(1)},paginator:{"&.MuiPagination-root .MuiPagination-ul":{justifyContent:"center"}}}})),Ze.a;function He(e){return String(e).split(/\s*,\s*/).filter((function(e){return String(e).trim().length>0}))}var Ye="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("666253527bbe47a1b7abffd28c9dd851","&redirect_uri=").concat("https://ajmacdonald.github.io/tagger/","&scope=").concat(["streaming","user-read-email","user-read-private","user-read-currently-playing","user-read-playback-state","user-modify-playback-state","user-library-read","user-library-modify","playlist-read-private","playlist-modify-private","playlist-modify-public","playlist-read-collaborative"].join("%20"),"&response_type=token&show_dialog=false"),$e=function(e){return Object(C.jsx)(E.a,Object(v.a)(Object(v.a)({},e),{},{onClick:function(){return window.location.href=Ye},children:"Connect to Spotify"}))},Qe=Object(u.a)((function(e){return{box:{borderTop:"2px solid ".concat(e.palette.grey[800])}}})),et=function(e){var t=e.width,n=e.height,a=ae(),r=a.getPlayingAlbum,c=(a.playAlbum,a.stopPlaying,Qe());return Object(C.jsxs)(_.a,{children:[r()&&Object(C.jsx)("iframe",{src:"https://open.spotify.com/embed/album/".concat(r()),width:t,height:n,frameBorder:"0",allowtransparency:"true",allow:"encrypted-media"}),!r()&&Object(C.jsx)(_.a,{width:t,height:n,className:c.box,children:Object(C.jsx)("img",{style:{width:"".concat(t/2,"px"),height:"".concat(n/2,"px"),opacity:.5,position:"relative",top:"50%",transform:"translate(50%, -50%)"},src:"/tagger/spotify_icons/Spotify_Icon_RGB_Black.png"})})]})},tt=n(137),nt=n.n(tt),at=n(180),rt=n.n(at),ct=n(179),st=n.n(ct),it=n(178),ot=n.n(it),lt=n(113),ut=n.n(lt),bt=n(94),dt=n(351),ht=n(276),ft=n(277),pt=n(143),jt=n(340),gt=n(347),mt=n(176),xt=n.n(mt),Ot=n(177),yt=n.n(Ot),vt=Object(u.a)((function(e){return{tagsBar:{backgroundColor:"#58319C",minHeight:"50px"},tagIcon:{color:e.palette.primary.light,marginRight:e.spacing(1)},chipTag:{marginRight:e.spacing(1),marginTop:e.spacing(1),marginBottom:e.spacing(1)}}})),kt=function(e){var t=e.onDelete,n=ae().getCurrentTags,a=vt();return Object(C.jsxs)(p.a,{className:a.tagsBar,children:[Object(C.jsx)(xt.a,{fontSize:"large",className:a.tagIcon}),Object(C.jsx)(_.a,{children:n().map((function(e,n){return t?Object(C.jsx)(I.a,{label:e,className:a.chipTag,color:"secondary",onClick:function(){return t(e)},onDelete:function(){return t(e)},deleteIcon:Object(C.jsx)(yt.a,{})},n):Object(C.jsx)(I.a,{label:e,className:a.chipTag,color:"secondary"},n)}))})]})},wt=Object(u.a)((function(e){return{title:{marginLeft:e.spacing(2),flex:1},root:{"& .MuiPaper-root.MuiDialog-paper":{backgroundColor:e.palette.background.default},"& .MuiDialogContent-root":{padding:e.spacing(3)}},controls:{"&":{display:"flex",flexFlow:"column nowrap",justifyContent:"center",alignItems:"center",padding:e.spacing(2)},"& > *":{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginLeft:e.spacing(0)}},summary:{marginBottom:e.spacing(2)},albums:{"&.MuiDataGrid-root .MuiDataGrid-cell:focus, &.MuiDataGrid-root .MuiDataGrid-cell:focus-within":{outline:"none"},"& .custom-header":{},"& .custom-cell":{textAlign:"center"}},chart:{"&.MuiGrid-root":{height:"100%"},"&.MuiGrid-root .MuiGrid-item":{backgroundColor:e.palette.secondary.main,margin:"0 2px 0 0"}}}})),Ct=[{field:"id",headerName:"ID",hide:!0,filterable:!1,sortable:!1},{field:"albumArt",headerName:" ",width:90,filterable:!1,sortable:!1,renderCell:function(e){return r.a.createElement("img",{width:"60px",height:"60px",src:e.value})}},{field:"title",headerName:"Title",flex:1,filterable:!1,sortable:!1,headerClassName:"custom-header",renderCell:function(e){return Object(C.jsxs)(_.a,{style:{flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[Object(C.jsx)(j.a,{variant:"h6",noWrap:!0,style:{fontSize:"1rem",fontWeight:400},children:e.row.albumName}),Object(C.jsxs)(_.a,{display:"flex",style:{flexDirection:"row"},children:[Object(C.jsx)(j.a,{variant:"body1",noWrap:!0,style:{fontSize:".85rem",fontWeight:300},children:e.row.albumArtists}),Object(C.jsxs)(j.a,{variant:"body1",style:{display:"none",fontSize:".85rem",fontWeight:100},children:["\xa0\u2022\xa0",e.row.year]})]})]})}},{field:"popularityChart",headerName:"Popularity",width:200,filterable:!1,sortable:!1,headerAlign:"center",headerClassName:"custom-header",renderCell:function(e){return Object(C.jsx)(Tt,{tracks:e.row.tracks})}},{field:"tracks",headerName:"Tracks",width:90,filterable:!1,sortable:!1,headerAlign:"center",headerClassName:"custom-header",cellClassName:"custom-cell",valueFormatter:function(e){var t=e.row.tracks.length,n=e.row.tracks.filter((function(e){return e.include}));return"".concat(n.length," / ").concat(t)}}],Tt=function(e){var t=e.tracks,n=wt(),a=2*t.length,r=Math.min(8,(200-a)/t.length);return Object(C.jsx)(x.a,{container:!0,direction:"row",justifyContent:"flex-start",alignItems:"flex-end",className:n.chart,children:t.map((function(e,t){return Object(C.jsx)(x.a,{item:!0,style:{height:"".concat(e.popularity,"% "),width:"".concat(r,"px"),opacity:"".concat(e.include?1:.25)}},t)}))})},At=function(e){var t=e.open,n=e.onClose,r=ae(),c=r.getAlbumsForCurrentTags,s=r.getAlbumTracks,o=r.createPlaylistForTracks,l=Object(a.useState)(!1),u=Object(i.a)(l,2),b=u[0],d=u[1],h=Object(a.useState)(!1),g=Object(i.a)(h,2),O=g[0],v=g[1],k=Object(a.useState)([]),w=Object(i.a)(k,2),T=w[0],A=w[1],S=Object(a.useState)(0),M=Object(i.a)(S,2),P=M[0],B=M[1],F=Object(a.useState)(0),z=Object(i.a)(F,2),_=z[0],R=z[1],I=Object(a.useState)(0),W=Object(i.a)(I,2),U=W[0],G=W[1],q=Object(a.useState)(!1),K=Object(i.a)(q,2),J=K[0],V=K[1],X=Object(a.useState)(""),Z=Object(i.a)(X,2),H=Z[0],Y=Z[1],$=Object(a.useState)(""),Q=Object(i.a)($,2),ee=Q[0],te=Q[1],ne=Object(a.useState)(!1),re=Object(i.a)(ne,2),ce=re[0],se=re[1],ie=Object(a.useState)(!1),oe=Object(i.a)(ie,2),le=oe[0],ue=oe[1],be=Object(a.useState)(void 0),de=Object(i.a)(be,2),he=de[0],fe=de[1],pe=function(){var e=Object(N.a)(D.a.mark((function e(){var t,n,a,r,o,l,u,b;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:t=e.sent,n=Object(i.a)(t,2),a=n[0],r=n[1],o=0,l=0;case 8:if(!(l<a.length)){e.next=22;break}return u=a[l],e.next=12,s(u.id,!0);case 12:b=e.sent,u.tracks=b.map((function(e){return{uri:e.uri,popularity:e.popularity,include:!0}})),o+=u.tracks.length,u.averagePopularity=Math.round(je(u)),u.maxPopularity=ge(u),u.minPopularity=me(u),u.popularityRange=Math.max(1,u.maxPopularity-u.minPopularity);case 19:l++,e.next=8;break;case 22:A(a),B(r),R(o);case 26:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return e+t}))/e.tracks.length},ge=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return t>e?t:e}),0)},me=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return t<e?t:e}),200)};Object(a.useEffect)((function(){var e=Object(L.a)(T),t=0;e.forEach((function(e){!function(e,t){var n=U/100,a=Math.abs(1-n);e.tracks.forEach((function(r){if(0===e.maxPopularity)r.include=J;else if("avg"===t){var c=r.popularity/e.maxPopularity;r.include=c>=n}else if("range"===t){var s=e.maxPopularity-r.popularity;r.include=s/e.popularityRange<=a}}))}(e,"range"),t+=e.tracks.filter((function(e){return e.include})).length})),A(e),R(t)}),[U,J]),Object(a.useEffect)((function(){t?Object(N.a)(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.next=3,pe();case 3:d(!1);case 4:case"end":return e.stop()}}),e)})))():setTimeout((function(){A([]),B(0),G(0),Y(""),te(""),se(!1),ue(!1),fe(void 0)}),100)}),[t]);var xe=wt();return Object(C.jsxs)(Se.a,{open:t,onClose:n,fullScreen:!0,className:xe.root,children:[Object(C.jsxs)(f.a,{position:"relative",children:[Object(C.jsxs)(p.a,{children:[Object(C.jsx)(y.a,{edge:"start",color:"inherit",onClick:n,"aria-label":"close",children:Object(C.jsx)(ut.a,{})}),Object(C.jsx)(j.a,{variant:"h6",className:xe.title,children:"Playlist Creator"})]}),Object(C.jsx)(kt,{})]}),Object(C.jsx)(Pe.a,{children:Object(C.jsxs)(x.a,{container:!0,direction:"row",justifyContent:"center",alignItems:"flex-start",spacing:3,children:[Object(C.jsx)(x.a,{item:!0,xs:12,sm:12,md:4,lg:3,children:Object(C.jsxs)(bt.a,{className:xe.controls,children:[Object(C.jsxs)("div",{id:"popularity-slider",style:{width:"100%"},children:[Object(C.jsx)(j.a,{gutterBottom:!0,children:"Popularity Threshold"}),Object(C.jsxs)(x.a,{container:!0,spacing:2,children:[Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(ot.a,{})}),Object(C.jsx)(x.a,{item:!0,xs:!0,children:Object(C.jsx)(dt.a,{value:U,onChange:function(e,t){return G(t)},color:"secondary"})}),Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(st.a,{})})]})]}),Object(C.jsx)(ht.a,{label:"Include Albums With No Popularity Info",labelPlacement:"start",control:Object(C.jsx)(ft.a,{checked:J,onChange:function(e){return V(e.target.checked)},size:"small",color:"secondary"})}),Object(C.jsx)(pt.a,{variant:"outlined",color:"secondary",fullWidth:!0,spellCheck:!1,error:le,label:"Playlist Title",value:H,onChange:function(e){Y(e.target.value),ue(!1)}}),Object(C.jsx)(pt.a,{variant:"outlined",color:"secondary",fullWidth:!0,multiline:!0,minRows:2,maxRows:2,spellCheck:!1,label:"Playlist Description",value:ee,onChange:function(e){return te(e.target.value)}}),Object(C.jsx)(ht.a,{label:"Public Playlist",labelPlacement:"start",control:Object(C.jsx)(ft.a,{checked:ce,onChange:function(e){return se(e.target.checked)},color:"secondary"})}),Object(C.jsxs)(j.a,{className:xe.summary,children:["Total Tracks: ",_]}),Object(C.jsx)(E.a,{variant:"contained",color:"secondary",size:"large",endIcon:O?Object(C.jsx)(rt.a,{}):Object(C.jsx)(nt.a,{}),onClick:function(){0===H.length?ue(!0):Object(N.a)(D.a.mark((function e(){var t,n,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),t=Object(L.a)(T),n=[],t.map((function(e){return e.tracks.forEach((function(e){e.include&&n.push(e.uri)}))})),e.prev=4,e.next=7,o(H,ee,n,ce);case 7:a=e.sent,fe(a),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn(e.t0);case 14:v(!1);case 15:case"end":return e.stop()}}),e,null,[[4,11]])})))()},children:"Create Spotify Playlist"}),Object(C.jsx)(m.a,{style:{display:"".concat(he?"block":"none"),marginTop:"16px"},children:Object(C.jsxs)(j.a,{variant:"h6",children:["Playlist ",Object(C.jsx)(jt.a,{href:"https://open.spotify.com/playlist/".concat(he),target:"_blank",rel:"noreferrer",color:"secondary",children:H})," created!"]})})]})}),Object(C.jsx)(gt.a,{smDown:!0,children:Object(C.jsx)(x.a,{item:!0,sm:8,md:8,lg:9,style:{display:"flex",height:"calc(100vh - 170px)"},children:Object(C.jsx)("div",{style:{flexGrow:1},children:Object(C.jsx)(Ve.a,{className:xe.albums,loading:b,componentsProps:{popularityThreshold:U},rows:T,columns:Ct,rowCount:P,pageSize:P,rowHeight:60,hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0})})})})]})})]})},St=function(e){var t=ae().getCurrentTags,n=Object(a.useState)(!1),c=Object(i.a)(n,2),s=c[0],o=c[1];return Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(g.a,{title:"Create Playlist from Tags",children:Object(C.jsx)("span",{children:Object(C.jsx)(y.a,{onClick:function(){s||o(!0)},disabled:0===t().length,children:Object(C.jsx)(nt.a,{})})})}),Object(C.jsx)(At,{open:s,onClose:function(){return o(!1)}})]})},Mt=n(181),Pt=n(83),Dt=n(341),Nt=n(182),Bt=n.n(Nt),Ft=n(8),zt=function(e){Object(be.a)(n,e);var t=Object(de.a)(n);function n(e){var a;return Object(K.a)(this,n),(a=t.call(this,e)).batchSize=1,a.state={working:!1,complete:!1,progress:0,offset:0-a.batchSize,total:-1,onlyUntagged:!0,overwriteTags:!1,currentAlbum:void 0,tagged:[],unmatched:[],skipped:[]},a.toggleWorking=a.toggleWorking.bind(Object(Pt.a)(a)),a.toggleUntagged=a.toggleUntagged.bind(Object(Pt.a)(a)),a.toggleOverwrite=a.toggleOverwrite.bind(Object(Pt.a)(a)),a.handleClose=a.handleClose.bind(Object(Pt.a)(a)),a}return Object(J.a)(n,[{key:"processBatch",value:function(){var e=Object(N.a)(D.a.mark((function e(t){var n,a,r,c,s,o,l,u,b,d,h,f,p,j=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.getMyAlbums(t,this.batchSize);case 3:r=e.sent,c=Object(i.a)(r,2),n=c[0],a=c[1],e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error(e.t0);case 12:s=Object(L.a)(this.state.tagged),o=Object(L.a)(this.state.unmatched),l=Object(L.a)(this.state.skipped),u=0;case 16:if(!(u<n.length)){e.next=49;break}if(b=n[u],d=!1,(!this.state.onlyUntagged||0!==b.tags.length)&&this.state.onlyUntagged){e.next=43;break}return h=void 0,e.prev=21,e.next=24,this.props.searchDiscogsForAlbum(b,!0);case 24:h=e.sent,e.next=30;break;case 27:throw e.prev=27,e.t1=e.catch(21),new Error(e.t1);case 30:if(!h){e.next=40;break}return f=h.genres,!1===this.state.overwriteTags&&b.tags.length>0&&(b.tags.concat(f),Object(Mt.a)("tags")),b.tags=f,e.next=36,this.props.setTagsForAlbum(b.id,f);case 36:e.sent&&s.push(b),e.next=41;break;case 40:o.push(b);case 41:e.next=45;break;case 43:d=!0,l.push(b);case 45:this.setState({currentAlbum:d?void 0:b,tagged:s,unmatched:o,skipped:l},(function(){return j.forceUpdate()}));case 46:u++,e.next=16;break;case 49:this.setState({tagged:s,unmatched:o,skipped:l}),(p=Math.min(a,t+this.batchSize))>=a?(this.setState({progress:100,working:!1,currentAlbum:void 0,complete:!0}),this.props.resetCurrentTags()):this.state.working&&this.setState({offset:p,total:a});case 53:case"end":return e.stop()}}),e,this,[[0,9],[21,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"toggleWorking",value:function(){var e=this;this.state.working?this.stopWorking():this.setState({working:!0,offset:this.state.offset+this.batchSize},(function(){return e.forceUpdate()}))}},{key:"stopWorking",value:function(){this.state.working&&(this.setState({working:!1,offset:this.state.offset-this.batchSize,currentAlbum:void 0}),this.props.resetCurrentTags())}},{key:"toggleUntagged",value:function(){this.setState({onlyUntagged:!this.state.onlyUntagged})}},{key:"toggleOverwrite",value:function(){this.setState({overwriteTags:!this.state.overwriteTags})}},{key:"handleClose",value:function(){this.stopWorking(),this.props.onClose()}},{key:"normalize",value:function(e,t,n){return 100*(e-t)/(n-t)}},{key:"componentDidMount",value:function(){var e=this;this.props.getMyAlbums(0,1).then((function(t){var n=Object(i.a)(t,2),a=(n[0],n[1]);e.setState({total:a})}))}},{key:"componentDidUpdate",value:function(e,t,n){if(this.state.working&&t.offset!==this.state.offset){var a=Math.round(this.normalize(this.state.offset,0,this.state.total));this.setState({progress:a}),this.state.offset<this.state.total&&this.processBatch(this.state.offset)}else this.state.complete}},{key:"render",value:function(){var e=this,t=this.props.classes;return Object(C.jsxs)(Se.a,{open:this.props.open,onClose:this.handleClose,fullScreen:!0,className:t.root,children:[Object(C.jsx)(f.a,{position:"relative",children:Object(C.jsxs)(p.a,{children:[Object(C.jsx)(y.a,{edge:"start",color:"inherit",onClick:this.handleClose,"aria-label":"close",children:Object(C.jsx)(ut.a,{})}),Object(C.jsx)(j.a,{variant:"h6",className:t.title,children:"Auto Tagger"})]})}),Object(C.jsx)(Pe.a,{children:Object(C.jsxs)(x.a,{container:!0,direction:"row",justifyContent:"center",alignItems:"flex-start",spacing:3,children:[Object(C.jsx)(x.a,{item:!0,xs:12,md:4,lg:3,children:Object(C.jsxs)(bt.a,{className:t.controls,children:[Object(C.jsx)(ht.a,{label:"Only Untagged Albums",labelPlacement:"start",control:Object(C.jsx)(ft.a,{checked:this.state.onlyUntagged,onChange:function(t){return e.toggleUntagged(t.target.checked)},size:"small",color:"secondary"})}),Object(C.jsx)(ht.a,{label:"Overwrite Existing Tags",labelPlacement:"start",control:Object(C.jsx)(ft.a,{checked:this.state.overwriteTags,onChange:function(t){return e.toggleOverwrite(t.target.checked)},size:"small",color:"secondary"})}),Object(C.jsx)(E.a,{variant:"contained",color:"secondary",size:"large",endIcon:this.state.working?Object(C.jsx)(Bt.a,{}):Object(C.jsx)(M.a,{}),onClick:this.toggleWorking,children:this.state.working?"Stop Tagging":"Start Tagging"})]})}),Object(C.jsxs)(x.a,{item:!0,xs:12,md:8,lg:9,children:[Object(C.jsx)(j.a,{variant:"h6",children:"Stats"}),Object(C.jsxs)(j.a,{variant:"subtitle1",children:["Tagged: ",this.state.tagged.length]}),Object(C.jsxs)(j.a,{variant:"subtitle1",children:["Unmatched: ",this.state.unmatched.length]}),Object(C.jsxs)(j.a,{variant:"subtitle1",children:["Skipped: ",this.state.skipped.length]}),Object(C.jsx)(Dt.a,{className:t.progressBar,variant:"determinate",color:"secondary",value:this.state.progress}),this.state.working&&this.state.currentAlbum&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(ke,{album:this.state.currentAlbum}),Object(C.jsx)(we,{tags:this.state.currentAlbum.tags})]}),this.state.complete&&this.state.unmatched.length>0&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(j.a,{variant:"h6",children:"Unmatched Albums:"}),Object(C.jsx)(_.a,{className:t.unmatchedList,children:this.state.unmatched.map((function(e,t){return Object(C.jsx)(ke,{album:e},t)}))})]})]})]})})]})}}]),n}(r.a.Component),_t=Object(Ft.a)((function(e){return{title:{marginLeft:e.spacing(2),flex:1},root:{"& .MuiPaper-root.MuiDialog-paper":{backgroundColor:e.palette.background.default},"& .MuiDialogContent-root":{padding:e.spacing(3)}},controls:{"&":{display:"flex",flexFlow:"column nowrap",justifyContent:"center",alignItems:"center",padding:e.spacing(2)},"& > *":{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginLeft:e.spacing(0)}},progressBar:{marginTop:e.spacing(3),marginBottom:e.spacing(3)},unmatchedList:{"& h6":{marginTop:e.spacing(1)}}}}),{withTheme:!0})(zt),Rt=n(274),Et=n(278),It=function(e){Object(be.a)(n,e);var t=Object(de.a)(n);function n(e){var a;return Object(K.a)(this,n),(a=t.call(this,e)).state={working:!1,progress:0,offset:-1,total:-1,cachedAlbums:[]},a.batchSize=20,a}return Object(J.a)(n,[{key:"processBatch",value:function(){var e=Object(N.a)(D.a.mark((function e(t){var n,a,r,c,s,o,l=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.getMyAlbums(t,this.batchSize);case 3:r=e.sent,c=Object(i.a)(r,2),n=c[0],a=c[1],e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error(e.t0);case 12:s=Object(L.a)(this.state.cachedAlbums).concat(n),(o=Math.min(a,t+this.batchSize))>=a?this.setState({progress:100,working:!1},(function(){l.forceUpdate(),setTimeout((function(){l.props.setMyAlbumsCache(s)}),50)})):this.setState({cachedAlbums:s,offset:o,total:a});case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"normalize",value:function(e,t,n){return 100*(e-t)/(n-t)}},{key:"componentDidMount",value:function(){var e=this.props.getMyAlbumsCache();if(null===e)this.setState({offset:0,total:1,working:!0});else{var t=Object(L.a)(e);this.props.setMyAlbumsCache(t)}}},{key:"componentDidUpdate",value:function(e,t,n){if(this.state.working&&t.offset!==this.state.offset){var a=Math.round(this.normalize(this.state.offset,0,this.state.total));this.setState({progress:a}),this.state.offset<this.state.total&&this.processBatch(this.state.offset)}}},{key:"render",value:function(){return Object(C.jsx)(Rt.a,{className:this.props.classes.backdrop,open:this.state.working,children:Object(C.jsxs)(x.a,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",spacing:3,children:[Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(j.a,{children:"Loading Albums..."})}),Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(Lt,{size:65,value:this.state.progress})})]})})}}]),n}(r.a.Component),Lt=function(e){return Object(C.jsxs)(_.a,{position:"relative",display:"inline-flex",children:[Object(C.jsx)(Et.a,Object(v.a)({variant:"determinate"},e)),Object(C.jsx)(_.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(C.jsx)(j.a,{variant:"caption",component:"div",color:"textSecondary",children:"".concat(e.value,"%")})})]})},Wt=Object(Ft.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:e.palette.grey}}}),{withTheme:!0})(It),Ut=250,Gt=Object(l.b)({palette:{type:"dark",primary:{main:d.a[500]},secondary:{main:h.a.A400}}});Gt.scrollBar={width:8,track:{backgroundColor:"".concat(Gt.palette.background.default)},thumb:{backgroundColor:"".concat(Gt.palette.grey[600])}};var qt=Object(u.a)((function(e){return{root:{display:"flex",flexFlow:"column nowrap",height:"100vh"},title:{flexGrow:1},main:{flex:"1 1 auto",display:"flex",flexFlow:"row nowrap",overflow:"hidden"},sideBar:{borderRight:"2px solid ".concat(e.palette.grey[800])},content:{flex:"1 1 auto"}}})),Kt=window.location.hash.substring(1).split("&").reduce((function(e,t){if(t){var n=t.split("=");e[n[0]]=decodeURIComponent(n[1])}return e}),{});window.location.hash="";function Jt(){var e=ae(),t=e.setSpotifyToken,n=e.setDatabaseName,c=e.hasSpotifyToken,s=e.persistentSideBar,l=e.sideBarWidth,u=e.getMyAlbums,d=e.searchDiscogsForAlbum,h=e.setTagsForAlbum,v=(e.getCurrentTags,e.removeCurrentTag),k=e.resetCurrentTags,w=e.getMyAlbumsCache,T=e.setMyAlbumsCache,S=e.needsMyAlbumsCache,P=e.isPlaying,D=e.stopPlaying,N=Object(a.useState)(!1),B=Object(i.a)(N,2),F=B[0],z=B[1],_=Object(a.useState)(!1),R=Object(i.a)(_,2),E=R[0],I=R[1],L=function(){z(!F)},W=qt(Gt);return Object(a.useEffect)((function(){t(Kt.access_token),n("albumTags")}),[]),Object(C.jsxs)(b.a,{theme:Gt,children:[Object(C.jsx)(o.a,{}),Object(C.jsxs)("div",{className:W.root,children:[Object(C.jsxs)(f.a,{position:"static",children:[Object(C.jsxs)(p.a,{children:[Object(C.jsx)(y.a,{edge:"start",disabled:!c()||s(),onClick:L,children:Object(C.jsx)(A,{fontSize:"large"})}),Object(C.jsx)(j.a,{variant:"h6",className:W.title,children:"Tagger for Spotify"}),Object(C.jsx)(g.a,{title:"Auto Tag Albums",children:Object(C.jsx)("span",{children:Object(C.jsx)(y.a,{onClick:function(){return I(!0)},disabled:!1===c(),children:Object(C.jsx)(M.a,{})})})}),Object(C.jsx)(St,{})]}),Object(C.jsx)(kt,{onDelete:v})]}),Object(C.jsxs)("main",{className:W.main,children:[!c()&&Object(C.jsx)(m.a,{style:{marginTop:"100px",textAlign:"center"},children:Object(C.jsx)($e,{variant:"contained",color:"secondary"})}),c()&&Object(C.jsxs)(r.a.Fragment,{children:[s()&&Object(C.jsxs)(x.a,{container:!0,direction:"column",justifyContent:"flex-start",alignItems:"stretch",className:W.sideBar,style:{flex:"0 0 ".concat(l()+2,"px")},children:[Object(C.jsx)(x.a,{item:!0,style:{height:"calc(100% - ".concat(Ut,"px)")},children:Object(C.jsx)(ie,{persistent:!0})}),Object(C.jsx)(x.a,{item:!0,style:{height:"".concat(Ut,"px")},children:Object(C.jsx)(et,{albumId:"0oGzSazidykcL5XNTEuS9z",width:l(),height:Ut})})]}),!s()&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(O.a,{variant:"temporary",open:F,onClose:L,ModalProps:{keepMounted:!0},children:Object(C.jsx)(ie,{persistent:!1})}),Object(C.jsx)(O.a,{variant:"temporary",anchor:"bottom",open:P,onClose:D,ModalProps:{keepMounted:!0},children:Object(C.jsx)(et,{albumId:"0oGzSazidykcL5XNTEuS9z",width:"100%",height:Ut})})]}),Object(C.jsx)("div",{className:W.content,children:Object(C.jsx)(Je,{})}),S()&&Object(C.jsx)(Wt,{getMyAlbums:u,getMyAlbumsCache:w,setMyAlbumsCache:T}),Object(C.jsx)(_t,{open:E,onClose:function(){return I(!1)},getMyAlbums:u,searchDiscogsForAlbum:d,setTagsForAlbum:h,resetCurrentTags:k})]})]})]})]})}s.a.render(Object(C.jsx)(G,{children:Object(C.jsx)(Jt,{})}),document.getElementById("root"))}},[[266,1,2]]]);