(this.webpackJsonpspotifytagger=this.webpackJsonpspotifytagger||[]).push([[0],{236:function(e,t){},253:function(e,t){},263:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(16),s=n.n(c),i=n(9),o=n(336),l=n(76),u=n(158),b=n(328),h=n(334),d=n(335),f=n(330),j=n(320),p=n(81),g=n(138),m=n(331),x=n(329),O=n(343),y=n(86),v=n(17),w=n(114),k=n(180),C=n(4),T=["tagColor","barColor"],A=function(e){var t=e.tagColor,n=void 0===t?"#1de9b6":t,a=e.barColor,r=void 0===a?"#303030":a,c=Object(w.a)(e,T);return Object(C.jsxs)(k.a,Object(v.a)(Object(v.a)({},c),{},{viewBox:"0 0 400 400",children:[Object(C.jsx)("path",{stroke:"null",fill:n,d:"m310.75011,69.83626c-7.60697,-10.77654 -20.28526,-17.7496 -34.44268,-17.7496l-232.43525,0.21131c-23.24352,0 -42.26096,18.80613 -42.26096,42.04965l0,211.30478c0,23.24352 19.01743,42.04965 42.26096,42.04965l232.43525,0.21131c14.15742,0 26.83571,-6.97306 34.44268,-17.7496l83.67669,-117.90806c5.28262,-7.39567 5.28262,-17.11569 0,-24.51136l-83.67669,-117.90806l0,-0.00001z"}),Object(C.jsx)("path",{stroke:"null",fill:r,d:"M275.75 137.75C275.75 137.75 275.75 137.75 275.75 137.75C275.75 148.11 267.36 156.5 257 156.5C215.75 156.5 110.75 156.5 69.5 156.5C59.14 156.5 50.75 148.11 50.75 137.75C50.75 137.75 50.75 137.75 50.75 137.75C50.75 137.75 50.75 137.75 50.75 137.75C50.75 127.39 59.14 119 69.5 119C110.75 119 215.75 119 257 119C267.36 119 275.75 127.39 275.75 137.75C275.75 137.75 275.75 137.75 275.75 137.75Z"}),Object(C.jsx)("path",{stroke:"null",fill:r,d:"M313.25 201C313.25 201 313.25 201 313.25 201C313.25 211.36 304.86 219.75 294.5 219.75C245.75 219.75 118.25 219.75 69.5 219.75C59.14 219.75 50.75 211.36 50.75 201C50.75 201 50.75 201 50.75 201C50.75 201 50.75 201 50.75 201C50.75 190.64 59.14 182.25 69.5 182.25C118.25 182.25 245.75 182.25 294.5 182.25C304.86 182.25 313.25 190.64 313.25 201C313.25 201 313.25 201 313.25 201Z"}),Object(C.jsx)("path",{stroke:"null",fill:r,d:"M275.75 263.25C275.75 263.25 275.75 263.25 275.75 263.25C275.75 273.61 267.36 282 257 282C215.75 282 110.75 282 69.5 282C59.14 282 50.75 273.61 50.75 263.25C50.75 263.25 50.75 263.25 50.75 263.25C50.75 263.25 50.75 263.25 50.75 263.25C50.75 252.89 59.14 244.5 69.5 244.5C110.75 244.5 215.75 244.5 257 244.5C267.36 244.5 275.75 252.89 275.75 263.25C275.75 263.25 275.75 263.25 275.75 263.25Z"})]}))},S=n(113),P=n.n(S),M=n(15),D=n.n(M),N=n(24),F=n(265),B=n(266),z=n(316),_=n(339),E=n(18),R={allTags:[],currentTags:[],myAlbumsCache:{lastCached:void 0,albums:[]},albumsForCurrentTags:[],currentAlbum:void 0,currentSearch:{query:void 0,tags:[]},playingAlbum:void 0,isPlaying:!1},I=r.a.createContext([{},function(){}]),U=function(e){var t=Object(a.useState)(R),n=Object(i.a)(t,2),r=n[0],c=n[1];return Object(C.jsx)(I.Provider,{value:[r,c],children:e.children})},W=n(315),L=n(41),q=n(42),G=n(163),K=n.n(G),J=n(115),V=n(179),X=n(164),Y=n.n(X);J.a.plugin(V.a),J.a.plugin(Y.a);var Z=!1,H=function(){function e(){Object(L.a)(this,e)}return Object(q.a)(e,null,[{key:"hasSpotifyToken",value:function(){return void 0!==e.spotifyApi.getAccessToken()}},{key:"setSpotifyToken",value:function(t){e.spotifyApi.setAccessToken(t)}},{key:"setDbName",value:function(t){e.pouchDB=new J.a(t)}},{key:"fetchSavedAlbums",value:function(t,n){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise(function(){var r=Object(N.a)(D.a.mark((function r(c,s){var i,o,l,u,b;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.spotifyApi.getMySavedAlbums({limit:n,offset:t});case 3:if(i=r.sent,o=i.body.total,l=i.body.items.map((function(t,n){return e._formatSpotifyAlbum(t.album)})),!a){r.next=12;break}return u=l.map((function(e){return e.id})),r.next=10,e.fetchTagsForAlbumKeys(u);case 10:b=r.sent,l.forEach((function(e){e.tags=b[e.id]||[]}));case 12:c([l,o]),r.next=19;break;case 15:r.prev=15,r.t0=r.catch(0),console.warn("fetchSavedAlbums",r.t0),c([[],0]);case 19:case 20:case"end":return r.stop()}}),r,null,[[0,15]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"fetchAlbumsByKey",value:function(t){return new Promise(function(){var n=Object(N.a)(D.a.mark((function n(a,r){var c,s,i;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=21;break}c=[];case 2:if(!(t.length>0)){n.next=18;break}return s=t.splice(0,20),n.prev=4,n.next=7,e.spotifyApi.getAlbums(s);case 7:i=n.sent,c=c.concat(i.body.albums.map((function(t,n){return e._formatSpotifyAlbum(t)}))),n.next=16;break;case 11:return n.prev=11,n.t0=n.catch(4),console.warn("fetchAlbumsByKey",n.t0),a([]),n.abrupt("break",18);case 16:n.next=2;break;case 18:a(c),n.next=23;break;case 21:console.warn("fetchAlbumsByKey: no keys!"),a([]);case 23:case"end":return n.stop()}}),n,null,[[4,11]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"fetchTracksForAlbum",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var a=Object(N.a)(D.a.mark((function a(r,c){var s,i;return D.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,e.spotifyApi.getAlbumTracks(t);case 3:if(s=a.sent,i=s.body.items,!n){a.next=10;break}return a.next=8,e.spotifyApi.getTracks(i.map((function(e){return e.id})));case 8:a.sent.body.tracks.forEach((function(e){i.find((function(t){return t.id===e.id})).popularity=e.popularity}));case 10:r(i),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(0),c(a.t0);case 16:case 17:case"end":return a.stop()}}),a,null,[[0,13]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"createPlaylist",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(r,c){e.spotifyApi.createPlaylist(t,{description:n,public:a}).then((function(e){r(e.body.id)}),(function(e){c(e)}))}))}},{key:"addTracksToPlaylist",value:function(t,n){return new Promise(function(){var a=Object(N.a)(D.a.mark((function a(r,c){var s,i;return D.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s="";case 1:if(!(n.length>0)){a.next=16;break}return i=n.splice(0,100),a.prev=3,a.next=6,e.spotifyApi.addTracksToPlaylist(t,i);case 6:s=a.sent,console.log(s),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(3),console.warn("addTracksToPlaylist",a.t0),c(a.t0);case 14:a.next=1;break;case 16:r(s);case 17:case"end":return a.stop()}}),a,null,[[3,10]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"_formatSpotifyAlbum",value:function(e){return{id:e.id,albumArtists:e.artists.map((function(e){return e.name})).join(", "),albumName:e.name,albumArt:e.images[2].url,year:e.release_date.split("-")[0],tags:[]}}},{key:"fetchTagsForAlbumKeys",value:function(t){return new Promise((function(n,a){e.pouchDB.allDocs({keys:t,include_docs:!0}).then((function(e){var t={};e.rows.filter((function(e){return!e.error})).forEach((function(e){e.doc?t[e.id]=e.doc.tags:console.warn("no doc for",e)})),n(t)}),(function(e){console.warn("fetchTagsForAlbumKeys",e),n({})}))}))}},{key:"fetchDocsForTags",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(a,r){var c={};c=n?{tags:{$all:t}}:{tags:{$in:t}},e.pouchDB.find({selector:c,fields:["_id","tags"]}).then((function(e){a(e.docs)}),(function(e){console.warn("fetchDocsForTags",e),a([])}))}))}},{key:"fetchAlbumsForTags",value:function(t){return new Promise(function(){var n=Object(N.a)(D.a.mark((function n(a,r){var c,s,i;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.fetchDocsForTags(t);case 3:return c=n.sent,s=c.map((function(e){return e._id})),n.next=7,e.fetchAlbumsByKey(s);case 7:(i=n.sent).forEach((function(e){var t=c.find((function(t){return t._id===e.id}));t&&(e.tags=t.tags)})),a(i),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(0),console.warn("fetchAlbumsForTags",n.t0),a([]);case 16:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"fetchUniqueTags",value:function(){return new Promise((function(t,n){e.pouchDB.allDocs({include_docs:!0}).then((function(n){var a={};n.rows.forEach((function(t){t.doc.tags&&Array.isArray(t.doc.tags)?t.doc.tags.forEach((function(e){void 0===a[e]&&(a[e]=0),a[e]++})):(console.warn("doc is messed up so delete it",t),e.pouchDB.remove(t.doc))})),t(a)}),(function(e){console.warn("fetchUniqueTags",e),t({})}))}))}},{key:"fetchUniqueTagsArray",value:function(){return new Promise((function(t,n){e.fetchUniqueTags().then((function(e){for(var n=[],a=0,r=Object.entries(e);a<r.length;a++){var c=Object(i.a)(r[a],2),s=c[0],o=c[1];n.push({label:s,count:o})}t(n)}),(function(e){console.warn("fetchUniqueTagsArray",e),t([])}))}))}},{key:"updateDoc",value:function(t){return new Promise(function(){var n=Object(N.a)(D.a.mark((function n(a,r){var c;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.pouchDB.upsert(t.id,(function(e){return e.tags=t.tags,e}));case 3:c=n.sent,a(c),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.warn("upsertDoc",err),a(!1);case 11:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"startDiscogsLog",value:function(){this.discogsStats.startTime=(new Date).getTime(),this.discogsStats.callTimes=[]}},{key:"getDiscogsMatchesForAlbum",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=n?2:5;return new Promise(function(){var r=Object(N.a)(D.a.mark((function r(c,s){var i,o,l,u,b,h,d,f;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:Z,i=t.albumArtists.split(",")[0],o=!1,0===i.toLowerCase().indexOf("various")&&(o=!0,i=""),l=t.albumName.replace(/LP/,"").replace(/EP/,""),u=[{release_title:l,artist:i,per_page:1},{query:"".concat(l," ").concat(i),per_page:5},{query:"".concat(l),per_page:5},{query:"".concat(l.split(/\b/)[0]," ").concat(i),per_page:5},{query:"".concat(l.split(/\b/)[0]," ").concat(i.split(/\b/)[0]),per_page:5}],b=u.shift(),h=0,d=[],f=void 0;case 10:return h++,r.prev=11,r.next=14,e._doDiscogsSearch(b,n);case 14:d=r.sent,r.next=22;break;case 17:r.prev=17,r.t0=r.catch(11),console.warn("Probably exceeding API limit!!!",r.t0),d=[],f=r.t0;case 22:b=u.shift();case 23:if(!f&&h<a&&0===d.length&&b){r.next=10;break}case 24:f?s(f):(d=e._filterDiscogsResults(t,d,o),c(d));case 25:case"end":return r.stop()}}),r,null,[[11,17]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_doDiscogsSearch",value:function(e,t){var n=this;return new Promise((function(a,r){void 0!==n.discogsStats.callTimes&&n.discogsStats.callTimes.push((new Date).getTime());var c=new URL("https://api.discogs.com/database/search"),s=Object.assign(e,{type:"release",page:0,token:"zVXJkuBoXwLyxIzfZUwoxxjMIYzCiTkUYqlsQnjR"});c.search=new URLSearchParams(s).toString();fetch(c,{method:"GET",mode:"cors",headers:{}}).then(function(){var e=Object(N.a)(D.a.mark((function e(n){var r,c,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t?950:0,e.next=3,n.json();case 3:c=e.sent,s=c.results.map((function(e){var t=e.title.indexOf(" - "),n=e.title.substr(0,t),a=e.title.substr(t+3);n=(n=n.replace(/\s\(\d+\)/g,"")).replace("*","");var r=[];return e.genre&&(r=r.concat(e.genre)),e.style&&(r=r.concat(e.style)),r=r.filter((function(e,t,n){return n.indexOf(e)===t})),{uri:e.uri,title:a,artists:n,genres:r,thumb:e.thumb}})),setTimeout((function(){a(s)}),r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){r(e)}))}))}},{key:"_filterDiscogsResults",value:function(e,t,n){var a=e.albumArtists.split(",").map((function(e){return e.split(/\s/)})).flat().map((function(e){return e.toLowerCase()})),r=e.albumName.split(/\s/).map((function(e){return e.replace(/\W/g,"").toLowerCase()})),c=n?0:1,s=Math.min(3,Math.ceil(r.length/2));return t.filter((function(e){var t=!0;c>0&&(t=e.artists.split(/(?:,\s)|(?:\s&\s)/).map((function(e){return e.split(/\s/)})).flat().map((function(e){return e.toLowerCase()})).filter((function(e){return-1!==a.indexOf(e)})).length>=c);var n=e.title.split(/\s/).map((function(e){return e.replace(/\W/g,"").toLowerCase()})).filter((function(e){return-1!==r.indexOf(e)}));return t&&n.length>=s}))}},{key:"titleCaseTags",value:function(){return new Promise(function(){var t=Object(N.a)(D.a.mark((function t(n,a){var r,c,s,i;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.fetchUniqueTags();case 3:return r=t.sent,Object.keys(r).forEach((function(t){var n=e.toTitleCase(t);r[t]=n})),t.next=7,e.pouchDB.allDocs({include_docs:!0});case 7:return c=t.sent,s=[],c.rows.forEach((function(e){var t=e.doc.tags.map((function(e){return r[e]}));s.push({_id:e.doc._id,_rev:e.doc._rev,tags:t})})),t.next=12,e.pouchDB.bulkDocs(s);case 12:i=t.sent,n(i),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(0),console.warn("titleCaseTags",t.t0),n(!1);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"toTitleCase",value:function(e){return e.replace(/([^\W_]+[^\s-]*) */g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}}]),e}();H.spotifyApi=new K.a,H.pouchDB=void 0,H.logDiscogsStats=!1,H.discogsStats={startTime:void 0,callTimes:void 0};var $=H,Q="MyAlbumsCache",ee=function(){var e=Object(a.useContext)(I),t=Object(i.a)(e,2),n=t[0],r=t[1],c=Object(W.a)("(min-width:800px)");function s(e,t){return!1===o()?new Promise((function(a,r){var c=Object(E.a)(n.myAlbumsCache.albums),s=c.length;if(void 0!==e){var i=Math.min(s,e+t);c=c.slice(e,i)}a([c,s])})):$.fetchSavedAlbums(e,t,!0)}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36e5;if(n.myAlbumsCache.lastCached){var t=(new Date).getTime();return t-n.myAlbumsCache.lastCached>e}return!0}function l(){return u.apply(this,arguments)}function u(){return(u=Object(N.a)(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.fetchUniqueTagsArray();case 2:(t=e.sent).sort((function(e,t){return t.count-e.count})),r((function(e){return Object(v.a)(Object(v.a)({},e),{},{allTags:t})}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return h.apply(this,arguments)}function h(){return(h=Object(N.a)(D.a.mark((function e(t){var a,c,s;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],!1!==o()){e.next=9;break}return e.next=4,$.fetchDocsForTags(t);case 4:c=e.sent,s=c.map((function(e){return e._id})),a=n.myAlbumsCache.albums.filter((function(e){return-1!==s.indexOf(e.id)})),e.next=12;break;case 9:return e.next=11,$.fetchAlbumsForTags(t);case 11:a=e.sent;case 12:r((function(e){return Object(v.a)(Object(v.a)({},e),{},{currentTags:t,albumsForCurrentTags:a})}));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){-1===n.currentTags.indexOf(e)&&b([].concat(Object(E.a)(n.currentTags),[e]))}function f(e){b(n.currentTags.filter((function(t){return t!==e})))}return{setSpotifyToken:function(e){$.setSpotifyToken(e)},hasSpotifyToken:function(){return $.hasSpotifyToken()},setDatabaseName:function(e){$.setDbName(e),l()},persistentSideBar:function(){return c},sideBarWidth:function(){return 250},getMyAlbums:s,needsMyAlbumsCache:o,getMyAlbumsCache:function(){var e=JSON.parse(window.localStorage.getItem(Q));return null!==e&&console.log("got albums from localStorage"),e},setMyAlbumsCache:function(e){var t=(new Date).getTime();r((function(n){return Object(v.a)(Object(v.a)({},n),{},{myAlbumsCache:{albums:e,lastCached:t}})})),window.localStorage.setItem(Q,JSON.stringify(e))},getAlbumsForCurrentTags:function(e,t){return new Promise(function(){var a=Object(N.a)(D.a.mark((function a(r,c){var o,l,u,b,h;return D.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(l=0,!(n.currentTags.length>0)){a.next=6;break}l=n.albumsForCurrentTags.length,o=Object(E.a)(n.albumsForCurrentTags),a.next=12;break;case 6:return a.next=8,s(e,t);case 8:u=a.sent,b=Object(i.a)(u,2),o=b[0],l=b[1];case 12:void 0!==e&&(h=Math.min(l,e+t),o=o.slice(e,h)),r([o,l]);case 14:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())},setTagsForAlbum:function(e,t){if(window.localStorage.removeItem(Q),!1===o()){for(var a=-1,c=0;c<n.myAlbumsCache.albums.length;c++)if(n.myAlbumsCache.albums[c].id===e){a=c;break}if(-1!==a){var s=Object.assign({},n.myAlbumsCache.albums[a],{tags:t}),i=Object(E.a)(n.myAlbumsCache.albums);i.splice(a,1,s);var l=n.myAlbumsCache.lastCached;r((function(e){return Object(v.a)(Object(v.a)({},e),{},{myAlbumsCache:{albums:i,lastCached:l}})}))}else console.warn("setTagsForAlbum: could not find cached album!")}return $.updateDoc({id:e,tags:t})},getAlbumTracks:function(e,t){return new Promise((function(n,a){$.fetchTracksForAlbum(e,t).then((function(e){n(e)}),(function(e){console.warn("could not get album tracks",e),n([])}))}))},getAllTags:function(){return n.allTags},refreshAllTags:l,getCurrentTags:function(){return n.currentTags},setCurrentTags:b,addCurrentTag:d,removeCurrentTag:f,toggleCurrentTag:function(e){-1===n.currentTags.indexOf(e)?d(e):f(e)},getCurrentAlbum:function(){return n.currentAlbum},setCurrentAlbum:function(e){r((function(t){return Object(v.a)(Object(v.a)({},t),{},{currentAlbum:e})}))},getPlayingAlbum:function(){return n.playingAlbum},playAlbum:function(e){n.playingAlbum!==e?r((function(t){return Object(v.a)(Object(v.a)({},t),{},{playingAlbum:e,isPlaying:!0})})):!1===n.isPlaying&&r((function(e){return Object(v.a)(Object(v.a)({},e),{},{isPlaying:!0})}))},stopPlaying:function(){r((function(e){return Object(v.a)(Object(v.a)({},e),{},{isPlaying:!1})}))},isPlaying:n.isPlaying,searchDiscogsForAlbum:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,a){$.getDiscogsMatchesForAlbum(e,t).then((function(e){e.length>0?n(e[0]):n(void 0)}),(function(e){a(e)}))}))},createPlaylistForTracks:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(function(){var r=Object(N.a)(D.a.mark((function r(c,s){var i;return D.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,$.createPlaylist(e,t,a);case 3:return i=r.sent,r.next=6,$.addTracksToPlaylist(i,n);case 6:r.sent,c(i),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),s(r.t0);case 13:case"end":return r.stop()}}),r,null,[[0,10]])})));return function(e,t){return r.apply(this,arguments)}}())}}},te=["handleTagClick"],ne=Object(u.a)((function(e){return{root:{"&::-webkit-scrollbar":{width:e.scrollBar.width},"&::-webkit-scrollbar-track":e.scrollBar.track,"&::-webkit-scrollbar-thumb":e.scrollBar.thumb}}})),ae=function(e){e.handleTagClick;var t=Object(w.a)(e,te),n=ee(),r=n.getAllTags,c=n.getCurrentTags,s=n.getAlbumsForCurrentTags,o=n.toggleCurrentTag,l=Object(a.useState)([]),u=Object(i.a)(l,2),b=u[0],h=u[1],d=function(){var e=Object(N.a)(D.a.mark((function e(){var t,n,a,o,l,u,b,d,f,j,p,g;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=c()).length>0)){e.next=16;break}return n={},e.next=5,s();case 5:for(a=e.sent,o=Object(i.a)(a,2),l=o[0],o[1],l.forEach((function(e){e.tags.find((function(e){return-1!==t.indexOf(e)}))&&e.tags.forEach((function(e){void 0===n[e]&&(n[e]=0),n[e]++}))})),u=[],b=0,d=Object.entries(n);b<d.length;b++)f=Object(i.a)(d[b],2),j=f[0],p=f[1],g=t.indexOf(j),u.push({label:j,count:p,index:g});u.sort((function(e,t){if(-1===e.index&&-1===!t.index)return 1;if(-1===t.index&&-1===!e.index)return-1;var n=t.count-e.count;return 0===n?-1===e.index?1:-1===t.index?-1:e.index-t.index:n})),h(u),e.next=17;break;case 16:h(r());case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){d()}),[r(),c()]);var f=ne();return Object(C.jsxs)(F.a,Object(v.a)(Object(v.a)({},t),{},{className:f.root,children:[0===b.length&&Object(C.jsx)(B.a,{children:Object(C.jsx)(z.a,{children:"No Tags!"})}),b.map((function(e,t){return Object(C.jsxs)(B.a,{button:!0,selected:-1!==c().indexOf(e.label),onClick:function(){return o(e.label)},children:[Object(C.jsx)(z.a,{children:e.label}),Object(C.jsx)(_.a,{size:"small",disabled:!0,variant:"outlined",label:e.count})]},t)}))]}))},re=n(55),ce=n(12),se=n(64),ie=n(54),oe=n(53),le=n(1),ue=n(3),be=n(82),he=[{name:"VirtualTable"}],de="albumArtColumnType";var fe=function(e){Object(ie.a)(n,e);var t=Object(oe.a)(n);function n(){return Object(L.a)(this,n),t.apply(this,arguments)}return Object(q.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.width;return Object(C.jsxs)(le.g,{name:"AlbumArtColumn",dependencies:he,children:[Object(C.jsx)(le.f,{name:"tableColumns",computed:function(e){return function(e,t){return[{key:de,type:de,width:t}].concat(Object(E.a)(e))}(e.tableColumns,n)}}),Object(C.jsx)(le.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type===ue.q&&t.type===de}(e.tableRow,e.tableColumn)},children:Object(C.jsx)(re.c.Cell,{})}),Object(C.jsx)(le.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type!==ue.q&&e.type!==ue.u&&t.type===de}(e.tableRow,e.tableColumn)},children:function(e){return Object(C.jsx)(re.c.Cell,Object(v.a)(Object(v.a)({},e),{},{row:e.tableRow.row,children:e.tableRow.row&&Object(C.jsx)(be.a,{variant:"text",style:{padding:"4px"},onClick:function(){return t(e.tableRow.row.id)},children:Object(C.jsx)("img",{src:e.tableRow.row.albumArt,width:"64",height:"64"})})}))}})]})}}]),n}(r.a.PureComponent);fe.defaultProps={width:96};var je=n(111),pe=n.n(je),ge=[{name:"VirtualTable"}],me="searchColumnType";var xe=function(e){Object(ie.a)(n,e);var t=Object(oe.a)(n);function n(){return Object(L.a)(this,n),t.apply(this,arguments)}return Object(q.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.width;return Object(C.jsxs)(le.g,{name:"SearchColumn",dependencies:ge,children:[Object(C.jsx)(le.f,{name:"tableColumns",computed:function(e){return function(e,t){return[].concat(Object(E.a)(e),[{key:me,type:me,width:t}])}(e.tableColumns,n)}}),Object(C.jsx)(le.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type===ue.q&&t.type===me}(e.tableRow,e.tableColumn)},children:Object(C.jsx)(re.c.Cell,{children:" "})}),Object(C.jsx)(le.k,{name:"tableCell",predicate:function(e){return function(e,t){return e.type!==ue.q&&e.type!==ue.u&&t.type===me}(e.tableRow,e.tableColumn)},children:function(e){return Object(C.jsx)(re.c.Cell,Object(v.a)(Object(v.a)({},e),{},{row:e.tableRow.row,style:{textOverflow:"clip"},children:Object(C.jsx)(y.a,{onClick:function(){return t(e.tableRow.row)},children:Object(C.jsx)(pe.a,{})})}))}})]})}}]),n}(r.a.PureComponent);xe.defaultProps={width:60};var Oe=n(337),ye=function(e){var t=e.album;return Object(C.jsxs)(Oe.a,{style:{flexDirection:"column",alignItems:"flex-start"},children:[Object(C.jsx)(p.a,{variant:"h6",noWrap:!0,style:{fontSize:"1rem",fontWeight:400},children:t.albumName}),Object(C.jsx)(p.a,{variant:"body1",noWrap:!0,style:{fontSize:".85rem",fontWeight:300},children:t.albumArtists})]})},ve=function(e){return e.tags.map((function(e,t){return Object(C.jsx)(_.a,{size:"small",label:e,style:{margin:".125rem .25rem .125rem 0"}},t)}))},we=n(341),ke=n(173),Ce=n.n(ke),Te=n(321),Ae=n(322),Se=n(323),Pe=n(327),Me=n(324),De=n(326),Ne=n(270),Fe=n(185),Be=n(325),ze=Object(u.a)((function(e){return{dialogRoot:{"&.MuiDialog-root .MuiDialogTitle-root":{backgroundColor:e.palette.primary.main}},results:{"&.MuiList-root .MuiListItemAvatar-root":{marginRight:e.spacing(1)}},genres:{"&.MuiList-root":{paddingTop:e.spacing(0),paddingBottom:e.spacing(0)},"&.MuiList-root .MuiListItem-root":{paddingTop:e.spacing(0),paddingBottom:e.spacing(0)}},add:{marginLeft:"auto"},large:{width:e.spacing(10),height:e.spacing(10)}}})),_e=function(e){var t=e.open,n=e.onClose,c=(e.album,ee()),s=c.getCurrentAlbum,o=c.setTagsForAlbum,l=Object(a.useState)(!1),u=Object(i.a)(l,2),b=u[0],h=u[1],d=Object(a.useState)([]),f=Object(i.a)(d,2),j=f[0],g=f[1],m=Object(a.useState)([]),x=Object(i.a)(m,2),O=x[0],y=x[1];Object(a.useEffect)((function(){if(t){var e=s();y([]),h(!0),$.getDiscogsMatchesForAlbum(e).then((function(e){g(e),h(!1)}),(function(e){h(!1)}))}}),[t]);var v=ze();return Object(C.jsxs)(Te.a,{open:t,onClose:n,fullWidth:!0,maxWidth:"xs",className:v.dialogRoot,children:[Object(C.jsx)(Ae.a,{children:"Discogs Result"}),Object(C.jsxs)(Se.a,{children:[Object(C.jsxs)(F.a,{dense:!0,className:v.results,children:[b&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsxs)(B.a,{dense:!0,children:[Object(C.jsx)(Me.a,{children:Object(C.jsx)(Be.a,{variant:"rect",children:Object(C.jsx)(we.a,{variant:"square",className:v.large})})}),Object(C.jsxs)(z.a,{children:[Object(C.jsx)(Be.a,{variant:"text"}),Object(C.jsx)(Be.a,{variant:"text"})]})]}),Object(C.jsxs)(F.a,{dense:!0,subheader:Object(C.jsx)(De.a,{children:"Genres & Styles"}),className:v.genres,children:[Object(C.jsx)(B.a,{dense:!0,children:Object(C.jsx)(z.a,{children:Object(C.jsx)(Be.a,{variant:"text"})})}),Object(C.jsx)(B.a,{dense:!0,children:Object(C.jsx)(z.a,{children:Object(C.jsx)(Be.a,{variant:"text"})})}),Object(C.jsx)(B.a,{dense:!0,children:Object(C.jsx)(z.a,{children:Object(C.jsx)(Be.a,{variant:"text"})})})]})]}),!b&&j.length>0&&j.map((function(e,t){return Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsxs)(B.a,{dense:!0,button:!0,onClick:function(){return t=e.uri,void window.open("https://discogs.com".concat(t),"discogsWindow");var t},children:[Object(C.jsx)(Me.a,{children:Object(C.jsx)(we.a,{variant:"square",src:e.thumb,className:v.large})}),Object(C.jsx)(z.a,{primary:e.title,secondary:e.artists})]}),Object(C.jsx)(F.a,{dense:!0,subheader:Object(C.jsx)(De.a,{children:"Genres & Styles"}),className:v.genres,children:e.genres.map((function(e,t){return Object(C.jsxs)(B.a,{dense:!0,button:!0,onClick:function(){return function(e){var t=O.indexOf(e),n=Object(E.a)(O);-1===t?n.push(e):n.splice(t,1),y(n)}(e)},children:[Object(C.jsx)(Ne.a,{children:Object(C.jsx)(Fe.a,{checked:-1!==O.indexOf(e),disableRipple:!0})}),Object(C.jsx)(z.a,{children:e})]},t)}))})]},t)}))]}),!b&&0===j.length&&Object(C.jsx)(Oe.a,{style:{textAlign:"center",width:"100%",height:"100px"},children:Object(C.jsx)(p.a,{variant:"body1",style:{marginTop:"30px"},children:"No match \ud83d\ude13"})})]}),Object(C.jsx)(Pe.a,{children:Object(C.jsx)(be.a,{startIcon:Object(C.jsx)(Ce.a,{}),disabled:b||!b&&(0===j.length||0===O.length),onClick:function(){!function(e){var t=s(),n=Object(E.a)(e);t.tags&&(n=n.concat(t.tags)),n=n.filter((function(e,t,n){return n.indexOf(e)===t}));var a=t.id;o(a,n)}(O),n()},children:"Add Tags to Album"})})]})},Ee=Object(u.a)((function(e){return{root:{"&":{height:"100%"},"& table:first-of-type":{backgroundColor:e.palette.primary.dark},"& .MuiTableCell-head":{padding:e.spacing(1)},"& .MuiTable-root .MuiTableBody-root .MuiTableRow-root .MuiTableCell-body":{padding:"2px 8px"},"& > div > div::-webkit-scrollbar":{width:e.scrollBar.width},"& > div > div::-webkit-scrollbar-track":e.scrollBar.track,"& > div > div::-webkit-scrollbar-thumb":e.scrollBar.thumb},chipTag:{marginRight:e.spacing(1)},paginator:{"&.MuiPagination-root .MuiPagination-ul":{justifyContent:"center"}}}})),Re=[{name:"title",title:"Title",getCellValue:function(e){return e.albumName+" - "+e.albumArtists}},{name:"tags",title:"Tags",getCellValue:function(e){if(e.tags){var t=e.tags;return Array.isArray(t)||(t=String(t).split(/\s*,\s*/).filter((function(e){return String(e).trim().length>0}))),t}return[]}}],Ie=function(e){var t=e.row;return Object(C.jsx)(ye,{album:t})},Ue=function(e){return Object(C.jsx)(ce.b,Object(v.a)({for:["title"],formatterComponent:Ie},e))},We=function(e){var t=e.value;return Object(C.jsx)(ve,{tags:t})},Le=function(e){return Object(C.jsx)(ce.b,Object(v.a)({for:["tags"],formatterComponent:We},e))};var qe=function(e){return Object(C.jsx)(re.a.Root,Object(v.a)(Object(v.a)({},e),{},{style:{height:"100%"}}))},Ge=function(){var e=ee(),t=e.getAlbumsForCurrentTags,n=e.getCurrentTags,c=e.needsMyAlbumsCache,s=e.setCurrentAlbum,o=e.playAlbum,l=(e.persistentSideBar,e.sideBarWidth),u=Object(a.useState)(!1),b=Object(i.a)(u,2),h=b[0],d=b[1],f=Object(a.useState)([]),j=Object(i.a)(f,2),p=j[0],g=j[1],m=Object(a.useState)(),x=Object(i.a)(m,2),O=x[0],y=x[1],v=function(){var e=window.innerWidth>800,t=window.innerWidth-96-60-10;e&&(t-=l());var n=Math.floor(.4*t),a=Math.floor(.6*t);y([{columnName:"title",width:n},{columnName:"tags",width:a,wordWrapEnabled:e}])};Object(a.useEffect)((function(){Object(N.a)(D.a.mark((function e(){var n,a,r;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==c()){e.next=8;break}return e.next=3,t();case 3:n=e.sent,a=Object(i.a)(n,2),r=a[0],a[1],g(r);case 8:case"end":return e.stop()}}),e)})))()}),[c(),n()]),Object(a.useEffect)((function(){v(),window.addEventListener("resize",Object(se.a)(v,250))}),[]);var w=Ee();return Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)("div",{className:w.root,children:Object(C.jsxs)(re.a,{rootComponent:qe,rows:p,columns:Re,children:[Object(C.jsx)(ce.k,{}),Object(C.jsx)(ce.h,{}),Object(C.jsx)(Ue,{}),Object(C.jsx)(Le,{}),Object(C.jsx)(re.c,{height:"auto",estimatedRowHeight:78,columnExtensions:O}),Object(C.jsx)(re.b,{showSortingControls:!0}),Object(C.jsx)(fe,{onClick:o,width:96}),Object(C.jsx)(xe,{onClick:function(e){s(e),d(!0)},width:60})]})}),Object(C.jsx)(_e,{open:h,onClose:function(){return d(!1)}})]})},Ke=(n(338),n(92)),Je=n(133),Ve=n.n(Je);Object(u.a)((function(e){return{root:{border:0,"&.MuiDataGrid-root .MuiDataGrid-cell:focus, &.MuiDataGrid-root .MuiDataGrid-cell:focus-within":{outline:"none"},height:"calc(100% - 36px)"},chipTag:{marginRight:e.spacing(1)},paginator:{"&.MuiPagination-root .MuiPagination-ul":{justifyContent:"center"}}}})),Ve.a;function Xe(e){return String(e).split(/\s*,\s*/).filter((function(e){return String(e).trim().length>0}))}var Ye="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("666253527bbe47a1b7abffd28c9dd851","&redirect_uri=").concat("https://ajmacdonald.github.io/tagger/","&scope=").concat(["streaming","user-read-email","user-read-private","user-read-currently-playing","user-read-playback-state","user-modify-playback-state","user-library-read","user-library-modify","playlist-read-private","playlist-modify-private","playlist-modify-public","playlist-read-collaborative"].join("%20"),"&response_type=token&show_dialog=false"),Ze=function(e){return Object(C.jsx)(be.a,Object(v.a)(Object(v.a)({},e),{},{onClick:function(){return window.location.href=Ye},children:"Connect to Spotify"}))},He=function(e){var t=e.width,n=e.height,a=ee(),r=a.getPlayingAlbum;a.playAlbum,a.stopPlaying;return Object(C.jsxs)(Oe.a,{children:[r()&&Object(C.jsx)("iframe",{src:"https://open.spotify.com/embed/album/".concat(r()),width:t,height:n,frameBorder:"0",allowtransparency:"true",allow:"encrypted-media"}),!r()&&Object(C.jsx)(Oe.a,{width:t,height:n,style:{borderTop:"2px solid #424242"},children:Object(C.jsx)("img",{style:{width:"".concat(t/2,"px"),height:"".concat(n/2,"px"),opacity:.5,position:"relative",top:"50%",transform:"translate(50%, -50%)"},src:"/tagger/spotify_icons/Spotify_Icon_RGB_Black.png"})})]})},$e=n(136),Qe=n.n($e),et=n(176),tt=n.n(et),nt=n(175),at=n.n(nt),rt=n(174),ct=n.n(rt),st=n(112),it=n.n(st),ot=n(93),lt=n(342),ut=n(273),bt=n(274),ht=n(142),dt=n(332),ft=Object(u.a)((function(e){return{chipTag:{marginRight:e.spacing(1)}}})),jt=function(){var e=ee().getCurrentTags,t=ft();return Object(C.jsx)(r.a.Fragment,{children:e().map((function(e,n){return Object(C.jsx)(_.a,{label:e,className:t.chipTag,color:"secondary"},n)}))})},pt=Object(u.a)((function(e){return{title:{marginLeft:e.spacing(2),flex:1},root:{"& .MuiPaper-root.MuiDialog-paper":{backgroundColor:e.palette.background.default},"& .MuiDialogContent-root":{padding:e.spacing(3)}},controls:{"&":{display:"flex",flexFlow:"column nowrap",justifyContent:"center",alignItems:"center",padding:e.spacing(2)},"& > *":{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginLeft:e.spacing(0)}},summary:{marginBottom:e.spacing(2)},albums:{"&.MuiDataGrid-root .MuiDataGrid-cell:focus, &.MuiDataGrid-root .MuiDataGrid-cell:focus-within":{outline:"none"},"& .custom-header":{},"& .custom-cell":{textAlign:"center"}},chart:{"&.MuiGrid-root":{height:"100%"},"&.MuiGrid-root .MuiGrid-item":{backgroundColor:e.palette.secondary.main,margin:"0 2px 0 0"}}}})),gt=[{field:"id",headerName:"ID",hide:!0,filterable:!1,sortable:!1},{field:"albumArt",headerName:" ",width:90,filterable:!1,sortable:!1,renderCell:function(e){return r.a.createElement("img",{width:"60px",height:"60px",src:e.value})}},{field:"title",headerName:"Title",flex:1,filterable:!1,sortable:!1,headerClassName:"custom-header",renderCell:function(e){return Object(C.jsxs)(Oe.a,{style:{flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[Object(C.jsx)(p.a,{variant:"h6",noWrap:!0,style:{fontSize:"1rem",fontWeight:400},children:e.row.albumName}),Object(C.jsxs)(Oe.a,{display:"flex",style:{flexDirection:"row"},children:[Object(C.jsx)(p.a,{variant:"body1",noWrap:!0,style:{fontSize:".85rem",fontWeight:300},children:e.row.albumArtists}),Object(C.jsxs)(p.a,{variant:"body1",style:{display:"none",fontSize:".85rem",fontWeight:100},children:["\xa0\u2022\xa0",e.row.year]})]})]})}},{field:"popularityChart",headerName:"Popularity",width:200,filterable:!1,sortable:!1,headerAlign:"center",headerClassName:"custom-header",renderCell:function(e){return Object(C.jsx)(mt,{tracks:e.row.tracks})}},{field:"tracks",headerName:"Tracks",width:90,filterable:!1,sortable:!1,headerAlign:"center",headerClassName:"custom-header",cellClassName:"custom-cell",valueFormatter:function(e){var t=e.row.tracks.length,n=e.row.tracks.filter((function(e){return e.include}));return"".concat(n.length," / ").concat(t)}}],mt=function(e){var t=e.tracks,n=pt(),a=2*t.length,r=Math.min(8,(200-a)/t.length);return Object(C.jsx)(x.a,{container:!0,direction:"row",justifyContent:"flex-start",alignItems:"flex-end",className:n.chart,children:t.map((function(e,t){return Object(C.jsx)(x.a,{item:!0,style:{height:"".concat(e.popularity,"% "),width:"".concat(r,"px"),opacity:"".concat(e.include?1:.25)}},t)}))})},xt=function(e){var t=e.open,n=e.onClose,r=ee(),c=r.getAlbumsForCurrentTags,s=r.getAlbumTracks,o=r.createPlaylistForTracks,l=Object(a.useState)(!1),u=Object(i.a)(l,2),b=u[0],h=u[1],d=Object(a.useState)(!1),g=Object(i.a)(d,2),O=g[0],v=g[1],w=Object(a.useState)([]),k=Object(i.a)(w,2),T=k[0],A=k[1],S=Object(a.useState)(0),P=Object(i.a)(S,2),M=P[0],F=P[1],B=Object(a.useState)(0),z=Object(i.a)(B,2),_=z[0],R=z[1],I=Object(a.useState)(0),U=Object(i.a)(I,2),W=U[0],L=U[1],q=Object(a.useState)(!1),G=Object(i.a)(q,2),K=G[0],J=G[1],V=Object(a.useState)(""),X=Object(i.a)(V,2),Y=X[0],Z=X[1],H=Object(a.useState)(""),$=Object(i.a)(H,2),Q=$[0],te=$[1],ne=Object(a.useState)(!1),ae=Object(i.a)(ne,2),re=ae[0],ce=ae[1],se=Object(a.useState)(!1),ie=Object(i.a)(se,2),oe=ie[0],le=ie[1],ue=Object(a.useState)(void 0),he=Object(i.a)(ue,2),de=he[0],fe=he[1],je=function(){var e=Object(N.a)(D.a.mark((function e(){var t,n,a,r,o,l,u,b;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:t=e.sent,n=Object(i.a)(t,2),a=n[0],r=n[1],o=0,l=0;case 8:if(!(l<a.length)){e.next=22;break}return u=a[l],e.next=12,s(u.id,!0);case 12:b=e.sent,u.tracks=b.map((function(e){return{uri:e.uri,popularity:e.popularity,include:!0}})),o+=u.tracks.length,u.averagePopularity=Math.round(pe(u)),u.maxPopularity=ge(u),u.minPopularity=me(u),u.popularityRange=Math.max(1,u.maxPopularity-u.minPopularity);case 19:l++,e.next=8;break;case 22:A(a),F(r),R(o);case 26:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pe=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return e+t}))/e.tracks.length},ge=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return t>e?t:e}),0)},me=function(e){return e.tracks.map((function(e){return e.popularity})).reduce((function(e,t){return t<e?t:e}),200)};Object(a.useEffect)((function(){var e=Object(E.a)(T),t=0;e.forEach((function(e){!function(e,t){var n=W/100,a=Math.abs(1-n);e.tracks.forEach((function(r){if(0===e.maxPopularity)r.include=K;else if("avg"===t){var c=r.popularity/e.maxPopularity;r.include=c>=n}else if("range"===t){var s=e.maxPopularity-r.popularity;r.include=s/e.popularityRange<=a}}))}(e,"range"),t+=e.tracks.filter((function(e){return e.include})).length})),A(e),R(t)}),[W,K]),Object(a.useEffect)((function(){t?Object(N.a)(D.a.mark((function e(){return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.next=3,je();case 3:h(!1);case 4:case"end":return e.stop()}}),e)})))():setTimeout((function(){A([]),F(0),L(0),Z(""),te(""),ce(!1),le(!1),fe(void 0)}),100)}),[t]);var xe=pt();return Object(C.jsxs)(Te.a,{open:t,onClose:n,fullScreen:!0,className:xe.root,children:[Object(C.jsx)(f.a,{position:"relative",children:Object(C.jsxs)(j.a,{children:[Object(C.jsx)(y.a,{edge:"start",color:"inherit",onClick:n,"aria-label":"close",children:Object(C.jsx)(it.a,{})}),Object(C.jsx)(p.a,{variant:"h6",className:xe.title,children:"Playlist Creator"}),Object(C.jsx)(jt,{})]})}),Object(C.jsx)(Se.a,{children:Object(C.jsxs)(x.a,{container:!0,direction:"row",justifyContent:"center",alignItems:"flex-start",spacing:3,children:[Object(C.jsxs)(x.a,{item:!0,xs:12,sm:5,md:4,lg:3,children:[Object(C.jsxs)(ot.a,{className:xe.controls,children:[Object(C.jsxs)("div",{id:"popularity-slider",style:{width:"100%"},children:[Object(C.jsx)(p.a,{gutterBottom:!0,children:"Popularity Threshold"}),Object(C.jsxs)(x.a,{container:!0,spacing:2,children:[Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(ct.a,{})}),Object(C.jsx)(x.a,{item:!0,xs:!0,children:Object(C.jsx)(lt.a,{value:W,onChange:function(e,t){return L(t)},color:"secondary"})}),Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(at.a,{})})]})]}),Object(C.jsx)(ut.a,{label:"Include Albums With No Popularity Info",labelPlacement:"start",control:Object(C.jsx)(bt.a,{checked:K,onChange:function(e){return J(e.target.checked)},size:"small",color:"secondary"})}),Object(C.jsx)(ht.a,{variant:"outlined",color:"secondary",fullWidth:!0,spellCheck:!1,error:oe,label:"Playlist Title",value:Y,onChange:function(e){Z(e.target.value),le(!1)}}),Object(C.jsx)(ht.a,{variant:"outlined",color:"secondary",fullWidth:!0,multiline:!0,minRows:2,maxRows:2,spellCheck:!1,label:"Playlist Description",value:Q,onChange:function(e){return te(e.target.value)}}),Object(C.jsx)(ut.a,{label:"Public Playlist",labelPlacement:"start",control:Object(C.jsx)(bt.a,{checked:re,onChange:function(e){return ce(e.target.checked)},color:"secondary"})}),Object(C.jsxs)(p.a,{className:xe.summary,children:["Total Tracks: ",_]}),Object(C.jsx)(be.a,{variant:"contained",color:"secondary",size:"large",endIcon:O?Object(C.jsx)(tt.a,{}):Object(C.jsx)(Qe.a,{}),onClick:function(){0===Y.length?le(!0):Object(N.a)(D.a.mark((function e(){var t,n,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),t=Object(E.a)(T),n=[],t.map((function(e){return e.tracks.forEach((function(e){e.include&&n.push(e.uri)}))})),e.prev=4,e.next=7,o(Y,Q,n,re);case 7:a=e.sent,fe(a),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn(e.t0);case 14:v(!1);case 15:case"end":return e.stop()}}),e,null,[[4,11]])})))()},children:"Create Spotify Playlist"})]}),Object(C.jsx)(m.a,{style:{display:"".concat(de?"block":"none"),marginTop:"16px"},children:Object(C.jsxs)(p.a,{children:["Playlist ",Object(C.jsx)(dt.a,{href:"https://open.spotify.com/playlist/".concat(de),target:"_blank",rel:"noreferrer",color:"secondary",children:Y})," created!"]})})]}),Object(C.jsx)(x.a,{item:!0,xs:12,sm:7,md:8,lg:9,style:{display:"flex",height:"calc(100vh - 110px)"},children:Object(C.jsx)("div",{style:{flexGrow:1},children:Object(C.jsx)(Ke.a,{className:xe.albums,loading:b,componentsProps:{popularityThreshold:W},rows:T,columns:gt,rowCount:M,pageSize:M,rowHeight:60,hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0})})})]})})]})},Ot=function(e){var t=ee().getCurrentTags,n=Object(a.useState)(!1),c=Object(i.a)(n,2),s=c[0],o=c[1];return Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(g.a,{title:"Create Playlist from Tags",children:Object(C.jsx)("span",{children:Object(C.jsx)(y.a,{onClick:function(){s||o(!0)},disabled:0===t().length,children:Object(C.jsx)(Qe.a,{})})})}),Object(C.jsx)(xt,{open:s,onClose:function(){return o(!1)}})]})},yt=n(177),vt=n(80),wt=n(333),kt=n(178),Ct=n.n(kt),Tt=n(8),At=function(e){Object(ie.a)(n,e);var t=Object(oe.a)(n);function n(e){var a;return Object(L.a)(this,n),(a=t.call(this,e)).batchSize=1,a.state={working:!1,complete:!1,progress:0,offset:0-a.batchSize,total:-1,onlyUntagged:!0,overwriteTags:!1,currentAlbum:void 0,tagged:[],unmatched:[],skipped:[]},a.toggleWorking=a.toggleWorking.bind(Object(vt.a)(a)),a.toggleUntagged=a.toggleUntagged.bind(Object(vt.a)(a)),a.toggleOverwrite=a.toggleOverwrite.bind(Object(vt.a)(a)),a.handleClose=a.handleClose.bind(Object(vt.a)(a)),a}return Object(q.a)(n,[{key:"processBatch",value:function(){var e=Object(N.a)(D.a.mark((function e(t){var n,a,r,c,s,o,l,u,b,h,d,f,j=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.getMyAlbums(t,this.batchSize);case 3:r=e.sent,c=Object(i.a)(r,2),n=c[0],a=c[1],e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error(e.t0);case 12:s=Object(E.a)(this.state.tagged),o=Object(E.a)(this.state.unmatched),l=Object(E.a)(this.state.skipped),u=0;case 16:if(!(u<n.length)){e.next=46;break}if(b=n[u],(!this.state.onlyUntagged||0!==b.tags.length)&&this.state.onlyUntagged){e.next=41;break}return h=void 0,e.prev=20,e.next=23,this.props.searchDiscogsForAlbum(b,!0);case 23:h=e.sent,e.next=29;break;case 26:throw e.prev=26,e.t1=e.catch(20),new Error(e.t1);case 29:if(!h){e.next=38;break}return d=h.genres,!1===this.state.overwriteTags&&b.tags.length>0&&(b.tags.concat(d),Object(yt.a)("tags")),e.next=34,this.props.setTagsForAlbum(b.id,d);case 34:e.sent&&s.push(b),e.next=39;break;case 38:o.push(b);case 39:e.next=42;break;case 41:l.push(b);case 42:this.setState({currentAlbum:b,tagged:s,unmatched:o,skipped:l},(function(){return j.forceUpdate()}));case 43:u++,e.next=16;break;case 46:this.setState({tagged:s,unmatched:o,skipped:l}),(f=Math.min(a,t+this.batchSize))>=a?this.setState({progress:100,working:!1,currentAlbum:void 0,complete:!0}):this.setState({offset:f,total:a});case 50:case"end":return e.stop()}}),e,this,[[0,9],[20,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"toggleWorking",value:function(){var e=this;this.state.working?this.setState({working:!1,offset:this.state.offset-this.batchSize,currentAlbum:void 0}):this.setState({working:!0,offset:this.state.offset+this.batchSize},(function(){return e.forceUpdate()}))}},{key:"toggleUntagged",value:function(){this.setState({onlyUntagged:!this.state.onlyUntagged})}},{key:"toggleOverwrite",value:function(){this.setState({overwriteTags:!this.state.overwriteTags})}},{key:"handleClose",value:function(){this.setState({working:!1,offset:this.state.offset-this.batchSize,currentAlbum:void 0}),this.props.onClose()}},{key:"normalize",value:function(e,t,n){return 100*(e-t)/(n-t)}},{key:"componentDidMount",value:function(){var e=this;this.props.getMyAlbums(0,1).then((function(t){var n=Object(i.a)(t,2),a=(n[0],n[1]);e.setState({total:a})}))}},{key:"componentDidUpdate",value:function(e,t,n){if(this.state.working&&t.offset!==this.state.offset){var a=Math.round(this.normalize(this.state.offset,0,this.state.total));this.setState({progress:a}),this.state.offset<this.state.total&&this.processBatch(this.state.offset)}else this.state.complete}},{key:"render",value:function(){var e=this,t=this.props.classes;return Object(C.jsxs)(Te.a,{open:this.props.open,onClose:this.handleClose,fullScreen:!0,className:t.root,children:[Object(C.jsx)(f.a,{position:"relative",children:Object(C.jsxs)(j.a,{children:[Object(C.jsx)(y.a,{edge:"start",color:"inherit",onClick:this.handleClose,"aria-label":"close",children:Object(C.jsx)(it.a,{})}),Object(C.jsx)(p.a,{variant:"h6",className:t.title,children:"Auto Tagger"})]})}),Object(C.jsx)(Se.a,{children:Object(C.jsxs)(x.a,{container:!0,direction:"row",justifyContent:"center",alignItems:"flex-start",spacing:3,children:[Object(C.jsx)(x.a,{item:!0,xs:12,md:4,lg:3,children:Object(C.jsxs)(ot.a,{className:t.controls,children:[Object(C.jsx)(ut.a,{label:"Only Untagged Albums",labelPlacement:"start",control:Object(C.jsx)(bt.a,{checked:this.state.onlyUntagged,onChange:function(t){return e.toggleUntagged(t.target.checked)},size:"small",color:"secondary"})}),Object(C.jsx)(ut.a,{label:"Overwrite Existing Tags",labelPlacement:"start",control:Object(C.jsx)(bt.a,{checked:this.state.overwriteTags,onChange:function(t){return e.toggleOverwrite(t.target.checked)},size:"small",color:"secondary"})}),Object(C.jsx)(be.a,{variant:"contained",color:"secondary",size:"large",endIcon:this.state.working?Object(C.jsx)(Ct.a,{}):Object(C.jsx)(P.a,{}),onClick:this.toggleWorking,children:this.state.working?"Stop Tagging":"Start Tagging"})]})}),Object(C.jsxs)(x.a,{item:!0,container:!0,direction:"column",justifyContent:"flex-start",alignItems:"stretch",spacing:3,xs:12,md:8,lg:9,children:[Object(C.jsxs)(x.a,{item:!0,children:[Object(C.jsx)(p.a,{variant:"h6",children:"Stats"}),Object(C.jsxs)(p.a,{variant:"subtitle1",children:["Tagged: ",this.state.tagged.length]}),Object(C.jsxs)(p.a,{variant:"subtitle1",children:["Unmatched: ",this.state.unmatched.length]}),Object(C.jsxs)(p.a,{variant:"subtitle1",children:["Skipped: ",this.state.skipped.length]}),Object(C.jsx)(wt.a,{className:t.progressBar,variant:"determinate",color:"secondary",value:this.state.progress}),this.state.currentAlbum&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(ye,{album:this.state.currentAlbum}),Object(C.jsx)(ve,{tags:this.state.currentAlbum.tags})]})]}),Object(C.jsx)(x.a,{item:!0,children:this.state.complete&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(p.a,{variant:"h6",children:"Unmatched Albums:"}),Object(C.jsx)(F.a,{className:t.unmatchedList,dense:!0,children:this.state.unmatched.map((function(e,t){return Object(C.jsx)(B.a,{children:Object(C.jsx)(ye,{album:e})},t)}))})]})})]})]})})]})}}]),n}(r.a.Component),St=Object(Tt.a)((function(e){return{title:{marginLeft:e.spacing(2),flex:1},root:{"& .MuiPaper-root.MuiDialog-paper":{backgroundColor:e.palette.background.default},"& .MuiDialogContent-root":{padding:e.spacing(3)}},controls:{"&":{display:"flex",flexFlow:"column nowrap",justifyContent:"center",alignItems:"center",padding:e.spacing(2)},"& > *":{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginLeft:e.spacing(0)}},progressBar:{marginTop:e.spacing(3),marginBottom:e.spacing(3)},unmatchedList:{}}}),{withTheme:!0})(At),Pt=n(271),Mt=n(275),Dt=function(e){Object(ie.a)(n,e);var t=Object(oe.a)(n);function n(e){var a;return Object(L.a)(this,n),(a=t.call(this,e)).state={working:!1,progress:0,offset:-1,total:-1,cachedAlbums:[]},a.batchSize=20,a}return Object(q.a)(n,[{key:"processBatch",value:function(){var e=Object(N.a)(D.a.mark((function e(t){var n,a,r,c,s,o,l=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.getMyAlbums(t,this.batchSize);case 3:r=e.sent,c=Object(i.a)(r,2),n=c[0],a=c[1],e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error(e.t0);case 12:s=Object(E.a)(this.state.cachedAlbums).concat(n),(o=Math.min(a,t+this.batchSize))>=a?this.setState({progress:100,working:!1},(function(){l.forceUpdate(),setTimeout((function(){l.props.setMyAlbumsCache(s)}),50)})):this.setState({cachedAlbums:s,offset:o,total:a});case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"normalize",value:function(e,t,n){return 100*(e-t)/(n-t)}},{key:"componentDidMount",value:function(){var e=this.props.getMyAlbumsCache();if(null===e)this.setState({offset:0,total:1,working:!0});else{var t=Object(E.a)(e);this.props.setMyAlbumsCache(t)}}},{key:"componentDidUpdate",value:function(e,t,n){if(this.state.working&&t.offset!==this.state.offset){var a=Math.round(this.normalize(this.state.offset,0,this.state.total));this.setState({progress:a}),this.state.offset<this.state.total&&this.processBatch(this.state.offset)}}},{key:"render",value:function(){return Object(C.jsx)(Pt.a,{className:this.props.classes.backdrop,open:this.state.working,children:Object(C.jsxs)(x.a,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",spacing:3,children:[Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(p.a,{children:"Loading Albums..."})}),Object(C.jsx)(x.a,{item:!0,children:Object(C.jsx)(Nt,{size:65,value:this.state.progress})})]})})}}]),n}(r.a.Component),Nt=function(e){return Object(C.jsxs)(Oe.a,{position:"relative",display:"inline-flex",children:[Object(C.jsx)(Mt.a,Object(v.a)({variant:"determinate"},e)),Object(C.jsx)(Oe.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(C.jsx)(p.a,{variant:"caption",component:"div",color:"textSecondary",children:"".concat(e.value,"%")})})]})},Ft=Object(Tt.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:e.palette.grey}}}),{withTheme:!0})(Dt),Bt=250,zt=Object(l.b)({palette:{type:"dark",primary:{main:h.a[500]},secondary:{main:d.a.A400}}});zt.scrollBar={width:8,track:{backgroundColor:"".concat(zt.palette.background.default)},thumb:{backgroundColor:"".concat(zt.palette.grey[600])}};var _t=Object(u.a)((function(e){return{root:{display:"flex",flexFlow:"column nowrap",height:"100vh"},title:{flexGrow:1},toolbar:e.mixins.toolbar,main:{flex:"1 1 auto",height:"calc(100vh - 64px)",display:"flex",flexFlow:"row nowrap",overflow:"hidden"},sideBar:{borderRight:"2px solid #424242"},content:{flex:"1 1 auto"}}})),Et=window.location.hash.substring(1).split("&").reduce((function(e,t){if(t){var n=t.split("=");e[n[0]]=decodeURIComponent(n[1])}return e}),{});window.location.hash="";function Rt(){var e=ee(),t=e.setSpotifyToken,n=e.setDatabaseName,c=e.hasSpotifyToken,s=e.persistentSideBar,l=e.sideBarWidth,u=e.getMyAlbums,h=e.searchDiscogsForAlbum,d=e.setTagsForAlbum,v=e.getMyAlbumsCache,w=e.setMyAlbumsCache,k=e.needsMyAlbumsCache,T=e.isPlaying,S=e.stopPlaying,M=Object(a.useState)(!1),D=Object(i.a)(M,2),N=D[0],F=D[1],B=Object(a.useState)(!1),z=Object(i.a)(B,2),_=z[0],E=z[1],R=function(){F(!N)},I=_t(zt);return Object(a.useEffect)((function(){t(Et.access_token),n("albumTags")}),[]),Object(C.jsxs)(b.a,{theme:zt,children:[Object(C.jsx)(o.a,{}),Object(C.jsxs)("div",{className:I.root,children:[Object(C.jsx)(f.a,{position:"static",children:Object(C.jsxs)(j.a,{children:[Object(C.jsx)(y.a,{edge:"start",disabled:!c()||s(),onClick:R,children:Object(C.jsx)(A,{fontSize:"large"})}),Object(C.jsx)(p.a,{variant:"h6",className:I.title,children:"Tagger for Spotify"}),Object(C.jsx)(jt,{}),Object(C.jsx)(g.a,{title:"Auto Tag Albums",children:Object(C.jsx)("span",{children:Object(C.jsx)(y.a,{onClick:function(){return E(!0)},disabled:!1===c(),children:Object(C.jsx)(P.a,{})})})}),Object(C.jsx)(Ot,{})]})}),Object(C.jsxs)("main",{className:I.main,children:[!c()&&Object(C.jsx)(m.a,{style:{marginTop:"100px",textAlign:"center"},children:Object(C.jsx)(Ze,{variant:"contained",color:"secondary"})}),c()&&Object(C.jsxs)(r.a.Fragment,{children:[s()&&Object(C.jsxs)(x.a,{container:!0,direction:"column",justifyContent:"flex-start",alignItems:"stretch",className:I.sideBar,style:{flex:"0 0 ".concat(l()+2,"px")},children:[Object(C.jsx)(x.a,{item:!0,style:{height:"calc(100% - ".concat(Bt,"px)")},children:Object(C.jsx)(ae,{dense:!0,style:{height:"100%",overflowY:"scroll"}})}),Object(C.jsx)(x.a,{item:!0,style:{height:"".concat(Bt,"px")},children:Object(C.jsx)(He,{albumId:"0oGzSazidykcL5XNTEuS9z",width:l(),height:Bt})})]}),!s()&&Object(C.jsxs)(r.a.Fragment,{children:[Object(C.jsx)(O.a,{variant:"temporary",open:N,onClose:R,ModalProps:{keepMounted:!0},children:Object(C.jsx)(ae,{dense:!0,style:{width:"".concat(l(),"px"),height:"100%",overflowY:"scroll"}})}),Object(C.jsx)(O.a,{variant:"temporary",anchor:"bottom",open:T,onClose:S,ModalProps:{keepMounted:!0},children:Object(C.jsx)(He,{albumId:"0oGzSazidykcL5XNTEuS9z",width:"100%",height:Bt})})]}),Object(C.jsx)("div",{className:I.content,children:Object(C.jsx)(Ge,{})}),k()&&Object(C.jsx)(Ft,{getMyAlbums:u,getMyAlbumsCache:v,setMyAlbumsCache:w}),Object(C.jsx)(St,{open:_,onClose:function(){return E(!1)},getMyAlbums:u,searchDiscogsForAlbum:h,setTagsForAlbum:d})]})]})]})]})}s.a.render(Object(C.jsx)(U,{children:Object(C.jsx)(Rt,{})}),document.getElementById("root"))}},[[263,1,2]]]);